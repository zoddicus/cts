{"version":3,"file":"fragment_state.spec.js","names":["description","makeTestGroup","range","kBlendFactors","kBlendOperations","kMaxColorAttachments","kTextureFormats","kRenderableColorTextureFormats","kTextureFormatInfo","getFragmentShaderCodeWithOutput","getPlainTypeInfo","kDefaultFragmentShaderCode","kTexelRepresentationInfo","CreateRenderPipelineValidationTest","g","values","test","desc","params","u","combine","fn","t","isAsync","goodDescriptor","getDescriptor","targets","format","doCreateRenderPipelineTest","badDescriptor","beforeAllSubcases","info","selectDeviceOrSkipTestCase","feature","descriptor","colorRender","targetsLength","i","writeMask","fragmentShaderCode","device","limits","maxColorAttachments","beginSubcases","attachmentCount","shouldError","undefined","byteCost","maxColorAttachmentBytesPerSample","combineWithParams","formats","_success","map","f","hasBlend","blend","color","alpha","type","component","srcFactor","dstFactor","operation","defaultBlendComponent","blendComponentToTest","expand","p","shaderOutput","selectDeviceForTextureFormatOrSkipTestCase","depthStencil","depthWriteEnabled","depthCompare","plainType","scalar","componentCount","count","success","componentOrder","length","sampleType","colorSrcFactor","colorDstFactor","alphaSrcFactor","alphaDstFactor","colorBlendReadsSrcAlpha","includes","meetsExtraBlendingRequirement"],"sources":["../../../../../src/webgpu/api/validation/render_pipeline/fragment_state.spec.ts"],"sourcesContent":["export const description = `\nThis test dedicatedly tests validation of GPUFragmentState of createRenderPipeline.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { range } from '../../../../common/util/util.js';\nimport { kBlendFactors, kBlendOperations, kMaxColorAttachments } from '../../../capability_info.js';\nimport {\n  kTextureFormats,\n  kRenderableColorTextureFormats,\n  kTextureFormatInfo,\n} from '../../../format_info.js';\nimport {\n  getFragmentShaderCodeWithOutput,\n  getPlainTypeInfo,\n  kDefaultFragmentShaderCode,\n} from '../../../util/shader.js';\nimport { kTexelRepresentationInfo } from '../../../util/texture/texel_data.js';\n\nimport { CreateRenderPipelineValidationTest } from './common.js';\n\nexport const g = makeTestGroup(CreateRenderPipelineValidationTest);\n\nconst values = [0, 1, 0, 1];\n\ng.test('color_target_exists')\n  .desc(`Tests creating a complete render pipeline requires at least one color target state.`)\n  .params(u => u.combine('isAsync', [false, true]))\n  .fn(t => {\n    const { isAsync } = t.params;\n\n    const goodDescriptor = t.getDescriptor({\n      targets: [{ format: 'rgba8unorm' }],\n    });\n\n    // Control case\n    t.doCreateRenderPipelineTest(isAsync, true, goodDescriptor);\n\n    // Fail because lack of color states\n    const badDescriptor = t.getDescriptor({\n      targets: [],\n    });\n\n    t.doCreateRenderPipelineTest(isAsync, false, badDescriptor);\n  });\n\ng.test('targets_format_renderable')\n  .desc(`Tests that color target state format must have RENDER_ATTACHMENT capability.`)\n  .params(u => u.combine('isAsync', [false, true]).combine('format', kTextureFormats))\n  .beforeAllSubcases(t => {\n    const { format } = t.params;\n    const info = kTextureFormatInfo[format];\n    t.selectDeviceOrSkipTestCase(info.feature);\n  })\n  .fn(t => {\n    const { isAsync, format } = t.params;\n    const info = kTextureFormatInfo[format];\n\n    const descriptor = t.getDescriptor({ targets: [{ format }] });\n\n    t.doCreateRenderPipelineTest(isAsync, !!info.colorRender, descriptor);\n  });\n\ng.test('limits,maxColorAttachments')\n  .desc(\n    `Tests that color state targets length must not be larger than device.limits.maxColorAttachments.`\n  )\n  .params(u => u.combine('isAsync', [false, true]).combine('targetsLength', [8, 9]))\n  .fn(t => {\n    const { isAsync, targetsLength } = t.params;\n\n    const descriptor = t.getDescriptor({\n      targets: range(targetsLength, i => {\n        // Set writeMask to 0 for attachments without fragment output\n        return { format: 'rg8unorm', writeMask: i === 0 ? 0xf : 0 };\n      }),\n      fragmentShaderCode: kDefaultFragmentShaderCode,\n    });\n\n    t.doCreateRenderPipelineTest(\n      isAsync,\n      targetsLength <= t.device.limits.maxColorAttachments,\n      descriptor\n    );\n  });\n\ng.test('limits,maxColorAttachmentBytesPerSample,aligned')\n  .desc(\n    `\n  Tests that the total color attachment bytes per sample must not be larger than\n  maxColorAttachmentBytesPerSample when using the same format for multiple attachments.\n  `\n  )\n  .params(u =>\n    u\n      .combine('format', kRenderableColorTextureFormats)\n      .beginSubcases()\n      .combine(\n        'attachmentCount',\n        range(kMaxColorAttachments, i => i + 1)\n      )\n      .combine('isAsync', [false, true])\n  )\n  .fn(t => {\n    const { format, attachmentCount, isAsync } = t.params;\n    const info = kTextureFormatInfo[format];\n\n    const descriptor = t.getDescriptor({\n      targets: range(attachmentCount, () => {\n        return { format, writeMask: 0 };\n      }),\n    });\n    const shouldError =\n      info.colorRender === undefined ||\n      info.colorRender.byteCost * attachmentCount >\n        t.device.limits.maxColorAttachmentBytesPerSample;\n\n    t.doCreateRenderPipelineTest(isAsync, !shouldError, descriptor);\n  });\n\ng.test('limits,maxColorAttachmentBytesPerSample,unaligned')\n  .desc(\n    `\n  Tests that the total color attachment bytes per sample must not be larger than\n  maxColorAttachmentBytesPerSample when using various sets of (potentially) unaligned formats.\n  `\n  )\n  .params(u =>\n    u\n      .combineWithParams([\n        // Alignment causes the first 1 byte R8Unorm to become 4 bytes. So even though\n        // 1+4+8+16+1 < 32, the 4 byte alignment requirement of R32Float makes the first R8Unorm\n        // become 4 and 4+4+8+16+1 > 32. Re-ordering this so the R8Unorm's are at the end, however\n        // is allowed: 4+8+16+1+1 < 32.\n        {\n          formats: [\n            'r8unorm',\n            'r32float',\n            'rgba8unorm',\n            'rgba32float',\n            'r8unorm',\n          ] as GPUTextureFormat[],\n          _success: false,\n        },\n        {\n          formats: [\n            'r32float',\n            'rgba8unorm',\n            'rgba32float',\n            'r8unorm',\n            'r8unorm',\n          ] as GPUTextureFormat[],\n          _success: true,\n        },\n      ])\n      .beginSubcases()\n      .combine('isAsync', [false, true])\n  )\n  .fn(t => {\n    const { formats, _success, isAsync } = t.params;\n\n    const descriptor = t.getDescriptor({\n      targets: formats.map(f => {\n        return { format: f, writeMask: 0 };\n      }),\n    });\n\n    t.doCreateRenderPipelineTest(isAsync, _success, descriptor);\n  });\n\ng.test('targets_format_filterable')\n  .desc(\n    `\n  Tests that color target state format must be filterable if blend is not undefined.\n\n  TODO: info.colorRender.blend now directly says whether the format is blendable. Use that.`\n  )\n  .params(u =>\n    u\n      .combine('isAsync', [false, true])\n      .combine('format', kRenderableColorTextureFormats)\n      .beginSubcases()\n      .combine('hasBlend', [false, true])\n  )\n  .beforeAllSubcases(t => {\n    const { format } = t.params;\n    const info = kTextureFormatInfo[format];\n    t.selectDeviceOrSkipTestCase(info.feature);\n  })\n  .fn(t => {\n    const { isAsync, format, hasBlend } = t.params;\n    const info = kTextureFormatInfo[format];\n\n    const descriptor = t.getDescriptor({\n      targets: [\n        {\n          format,\n          blend: hasBlend ? { color: {}, alpha: {} } : undefined,\n        },\n      ],\n    });\n\n    t.doCreateRenderPipelineTest(isAsync, !hasBlend || info.color.type === 'float', descriptor);\n  });\n\ng.test('targets_blend')\n  .desc(\n    `\n  For the blend components on either GPUBlendState.color or GPUBlendState.alpha:\n  - Tests if the combination of 'srcFactor', 'dstFactor' and 'operation' is valid (if the blend\n    operation is \"min\" or \"max\", srcFactor and dstFactor must be \"one\").\n  `\n  )\n  .params(u =>\n    u\n      .combine('isAsync', [false, true])\n      .combine('component', ['color', 'alpha'] as const)\n      .beginSubcases()\n      .combine('srcFactor', kBlendFactors)\n      .combine('dstFactor', kBlendFactors)\n      .combine('operation', kBlendOperations)\n  )\n  .fn(t => {\n    const { isAsync, component, srcFactor, dstFactor, operation } = t.params;\n\n    const defaultBlendComponent: GPUBlendComponent = {\n      srcFactor: 'src-alpha',\n      dstFactor: 'dst-alpha',\n      operation: 'add',\n    };\n    const blendComponentToTest: GPUBlendComponent = {\n      srcFactor,\n      dstFactor,\n      operation,\n    };\n    const format = 'rgba8unorm';\n\n    const descriptor = t.getDescriptor({\n      targets: [\n        {\n          format,\n          blend: {\n            color: component === 'color' ? blendComponentToTest : defaultBlendComponent,\n            alpha: component === 'alpha' ? blendComponentToTest : defaultBlendComponent,\n          },\n        },\n      ],\n    });\n\n    if (operation === 'min' || operation === 'max') {\n      const _success = srcFactor === 'one' && dstFactor === 'one';\n      t.doCreateRenderPipelineTest(isAsync, _success, descriptor);\n    } else {\n      t.doCreateRenderPipelineTest(isAsync, true, descriptor);\n    }\n  });\n\ng.test('targets_write_mask')\n  .desc(`Tests that color target state write mask must be < 16.`)\n  .params(u => u.combine('isAsync', [false, true]).combine('writeMask', [0, 0xf, 0x10, 0x80000001]))\n  .fn(t => {\n    const { isAsync, writeMask } = t.params;\n\n    const descriptor = t.getDescriptor({\n      targets: [\n        {\n          format: 'rgba8unorm',\n          writeMask,\n        },\n      ],\n    });\n\n    t.doCreateRenderPipelineTest(isAsync, writeMask < 16, descriptor);\n  });\n\ng.test('pipeline_output_targets')\n  .desc(\n    `Pipeline fragment output types must be compatible with target color state format\n  - The scalar type (f32, i32, or u32) must match the sample type of the format.\n  - The componentCount of the fragment output (e.g. f32, vec2, vec3, vec4) must not have fewer\n    channels than that of the color attachment texture formats. Extra components are allowed and are discarded.\n\n  Otherwise, color state write mask must be 0.`\n  )\n  .params(u =>\n    u\n      .combine('isAsync', [false, true])\n      .combine('format', [undefined, ...kRenderableColorTextureFormats] as const)\n      .beginSubcases()\n      .combine('shaderOutput', [\n        undefined,\n        ...u.combine('scalar', ['f32', 'u32', 'i32'] as const).combine('count', [1, 2, 3, 4]),\n      ])\n      // We only care about testing writeMask if there is an attachment but no shader output.\n      .expand('writeMask', p =>\n        p.format !== undefined && p.shaderOutput !== undefined ? [0, 0x1, 0x2, 0x4, 0x8] : [0xf]\n      )\n  )\n  .beforeAllSubcases(t => {\n    t.selectDeviceForTextureFormatOrSkipTestCase(t.params.format);\n  })\n  .fn(t => {\n    const { isAsync, format, writeMask, shaderOutput } = t.params;\n\n    const descriptor = t.getDescriptor({\n      targets: format ? [{ format, writeMask }] : [],\n      // To have a dummy depthStencil attachment to avoid having no attachment at all which is invalid\n      depthStencil: { format: 'depth24plus', depthWriteEnabled: false, depthCompare: 'always' },\n      fragmentShaderCode: getFragmentShaderCodeWithOutput(\n        shaderOutput\n          ? [{ values, plainType: shaderOutput.scalar, componentCount: shaderOutput.count }]\n          : []\n      ),\n    });\n\n    let success = true;\n    if (format) {\n      // There is a color target\n      if (shaderOutput) {\n        // The shader outputs to the color target\n        const info = kTextureFormatInfo[format];\n        success =\n          shaderOutput.scalar === getPlainTypeInfo(info.color.type) &&\n          shaderOutput.count >= kTexelRepresentationInfo[format].componentOrder.length;\n      } else {\n        // The shader does not output to the color target\n        success = writeMask === 0;\n      }\n    }\n\n    t.doCreateRenderPipelineTest(isAsync, success, descriptor);\n  });\n\ng.test('pipeline_output_targets,blend')\n  .desc(\n    `On top of requirements from pipeline_output_targets, when blending is enabled and alpha channel is read indicated by any blend factor, an extra requirement is added:\n  - fragment output must be vec4.\n  `\n  )\n  .params(u =>\n    u\n      .combine('isAsync', [false, true])\n      .combine('format', ['r8unorm', 'rg8unorm', 'rgba8unorm', 'bgra8unorm'] as const)\n      .combine('componentCount', [1, 2, 3, 4])\n      .beginSubcases()\n      // The default srcFactor and dstFactor are 'one' and 'zero'. Override just one at a time.\n      .combineWithParams([\n        ...u.combine('colorSrcFactor', kBlendFactors),\n        ...u.combine('colorDstFactor', kBlendFactors),\n        ...u.combine('alphaSrcFactor', kBlendFactors),\n        ...u.combine('alphaDstFactor', kBlendFactors),\n      ] as const)\n  )\n  .beforeAllSubcases(t => {\n    const { format } = t.params;\n    const info = kTextureFormatInfo[format];\n    t.selectDeviceOrSkipTestCase(info.feature);\n  })\n  .fn(t => {\n    const sampleType = 'float';\n    const {\n      isAsync,\n      format,\n      componentCount,\n      colorSrcFactor,\n      colorDstFactor,\n      alphaSrcFactor,\n      alphaDstFactor,\n    } = t.params;\n    const info = kTextureFormatInfo[format];\n\n    const descriptor = t.getDescriptor({\n      targets: [\n        {\n          format,\n          blend: {\n            color: { srcFactor: colorSrcFactor, dstFactor: colorDstFactor },\n            alpha: { srcFactor: alphaSrcFactor, dstFactor: alphaDstFactor },\n          },\n        },\n      ],\n      fragmentShaderCode: getFragmentShaderCodeWithOutput([\n        { values, plainType: getPlainTypeInfo(sampleType), componentCount },\n      ]),\n    });\n\n    const colorBlendReadsSrcAlpha =\n      colorSrcFactor?.includes('src-alpha') || colorDstFactor?.includes('src-alpha');\n    const meetsExtraBlendingRequirement = !colorBlendReadsSrcAlpha || componentCount === 4;\n    const _success =\n      info.color.type === sampleType &&\n      componentCount >= kTexelRepresentationInfo[format].componentOrder.length &&\n      meetsExtraBlendingRequirement;\n    t.doCreateRenderPipelineTest(isAsync, _success, descriptor);\n  });\n"],"mappings":"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"}