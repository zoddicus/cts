{"version":3,"file":"maxComputeWorkgroupsPerDimension.spec.js","names":["kMaximumLimitBaseParams","makeLimitTestGroup","limit","g","description","kCreateComputePipelineTypes","createComputePipeline","device","descriptor","pipelineType","createComputePipelineAsync","test","desc","params","combine","fn","t","limitTest","testValueName","axis","testDeviceWithRequestedMaximumLimits","testValue","shouldError","counts","buffer","createBuffer","size","usage","GPUBufferUsage","STORAGE","module","createShaderModule","code","pipeline","layout","compute","entryPoint","encoder","createCommandEncoder","pass","beginComputePass","setPipeline","dispatchWorkgroups","end","expectValidationError","finish","destroy","adapter","defaultLimit","adapterLimit","defaultMaxComputeWorkgroupSizeProduct","getDefaultLimit","maxComputeWorkgroupSizeProduct","limits","maxComputeWorkgroupSizeX","maxComputeWorkgroupSizeY","maxComputeWorkgroupSizeZ","expect"],"sources":["../../../../../../src/webgpu/api/validation/capability_checks/limits/maxComputeWorkgroupsPerDimension.spec.ts"],"sourcesContent":["import { kMaximumLimitBaseParams, makeLimitTestGroup } from './limit_utils.js';\n\nconst limit = 'maxComputeWorkgroupsPerDimension';\nexport const { g, description } = makeLimitTestGroup(limit);\n\nconst kCreateComputePipelineTypes = [\n  'createComputePipeline',\n  'createComputePipelineAsync',\n] as const;\ntype CreateComputePipelineType = typeof kCreateComputePipelineTypes[number];\n\nasync function createComputePipeline(\n  device: GPUDevice,\n  descriptor: GPUComputePipelineDescriptor,\n  pipelineType: CreateComputePipelineType\n) {\n  switch (pipelineType) {\n    case 'createComputePipeline':\n      return device.createComputePipeline(descriptor);\n    case 'createComputePipelineAsync':\n      return await device.createComputePipelineAsync(descriptor);\n  }\n}\n\n// Note: dispatchWorkgroupsIndirect is not tested because it's not a validation error if that exceeds the limits\ng.test('dispatchWorkgroups,at_over')\n  .desc(`Test using dispatchWorkgroups at and over ${limit} limit`)\n  .params(\n    kMaximumLimitBaseParams\n      .combine('pipelineType', kCreateComputePipelineTypes)\n      .combine('axis', [0, 1, 2])\n  )\n  .fn(async t => {\n    const { limitTest, testValueName, pipelineType, axis } = t.params;\n    await t.testDeviceWithRequestedMaximumLimits(\n      limitTest,\n      testValueName,\n      async ({ device, testValue, shouldError }) => {\n        const counts = [1, 1, 1];\n        counts[axis] = testValue;\n\n        const buffer = device.createBuffer({\n          size: 16,\n          usage: GPUBufferUsage.STORAGE,\n        });\n\n        const module = device.createShaderModule({\n          code: `\n          @compute @workgroup_size(1) fn main() {\n          }\n          `,\n        });\n\n        const pipeline = await createComputePipeline(\n          device,\n          {\n            layout: 'auto',\n            compute: {\n              module,\n              entryPoint: 'main',\n            },\n          },\n          pipelineType\n        );\n\n        const encoder = device.createCommandEncoder();\n        const pass = encoder.beginComputePass();\n        pass.setPipeline(pipeline);\n        pass.dispatchWorkgroups(counts[0], counts[1], counts[2]);\n        pass.end();\n\n        await t.expectValidationError(() => {\n          encoder.finish();\n        }, shouldError);\n\n        buffer.destroy();\n      }\n    );\n  });\n\ng.test('validate')\n  .desc(\n    `Test that ${limit} <= maxComputeWorkgroupSizeX x maxComputeWorkgroupSizeY x maxComputeWorkgroupSizeZ`\n  )\n  .fn(t => {\n    const { adapter, defaultLimit, adapterLimit } = t;\n    const defaultMaxComputeWorkgroupSizeProduct =\n      t.getDefaultLimit('maxComputeWorkgroupSizeX') *\n      t.getDefaultLimit('maxComputeWorkgroupSizeY') *\n      t.getDefaultLimit('maxComputeWorkgroupSizeZ');\n    const maxComputeWorkgroupSizeProduct =\n      adapter.limits.maxComputeWorkgroupSizeX *\n      adapter.limits.maxComputeWorkgroupSizeY *\n      adapter.limits.maxComputeWorkgroupSizeZ;\n    t.expect(defaultLimit <= defaultMaxComputeWorkgroupSizeProduct);\n    t.expect(adapterLimit <= maxComputeWorkgroupSizeProduct);\n  });\n"],"mappings":"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"}