{"version":3,"file":"maxVertexBuffers.spec.js","names":["kRenderEncoderTypes","kMaximumLimitBaseParams","makeLimitTestGroup","getPipelineDescriptor","device","testValue","module","createShaderModule","code","buffers","Array","arrayStride","attributes","shaderLocation","offset","format","layout","vertex","depthStencil","depthWriteEnabled","depthCompare","limit","g","description","test","desc","params","combine","fn","t","limitTest","testValueName","async","testDeviceWithRequestedMaximumLimits","shouldError","actualLimit","pipelineDescriptor","lastIndex","testCreateRenderPipeline","encoderType","buffer","createBufferTracked","size","usage","GPUBufferUsage","VERTEX","testGPURenderAndBindingCommandsMixin","passEncoder","setVertexBuffer","destroy","adapter","defaultLimit","adapterLimit","expect","getDefaultLimit","limits","maxBindGroupsPlusVertexBuffers"],"sources":["../../../../../../src/webgpu/api/validation/capability_checks/limits/maxVertexBuffers.spec.ts"],"sourcesContent":["import { kRenderEncoderTypes, kMaximumLimitBaseParams, makeLimitTestGroup } from './limit_utils.js';\n\nfunction getPipelineDescriptor(device: GPUDevice, testValue: number): GPURenderPipelineDescriptor {\n  const module = device.createShaderModule({\n    code: `\n      @vertex fn vs(@location(0) p: vec4f) -> @builtin(position) vec4f {\n        return p;\n      }`,\n  });\n  const buffers = new Array<GPUVertexBufferLayout>(testValue);\n  buffers[testValue - 1] = {\n    arrayStride: 16,\n    attributes: [{ shaderLocation: 0, offset: 0, format: 'float32' }],\n  };\n\n  return {\n    layout: 'auto',\n    vertex: {\n      module,\n      buffers,\n    },\n    depthStencil: { format: 'depth32float', depthWriteEnabled: true, depthCompare: 'always' },\n  };\n}\n\nconst limit = 'maxVertexBuffers';\nexport const { g, description } = makeLimitTestGroup(limit);\n\ng.test('createRenderPipeline,at_over')\n  .desc(`Test using at and over ${limit} limit in createRenderPipeline(Async)`)\n  .params(kMaximumLimitBaseParams.combine('async', [false, true]))\n  .fn(async t => {\n    const { limitTest, testValueName, async } = t.params;\n    await t.testDeviceWithRequestedMaximumLimits(\n      limitTest,\n      testValueName,\n      async ({ device, testValue, shouldError, actualLimit }) => {\n        const pipelineDescriptor = getPipelineDescriptor(device, testValue);\n        const lastIndex = testValue - 1;\n\n        await t.testCreateRenderPipeline(\n          pipelineDescriptor,\n          async,\n          shouldError,\n          `lastIndex: ${lastIndex}, actualLimit: ${actualLimit}, shouldError: ${shouldError}`\n        );\n      }\n    );\n  });\n\ng.test('setVertexBuffer,at_over')\n  .desc(`Test using at and over ${limit} limit in setVertexBuffer`)\n  .params(kMaximumLimitBaseParams.combine('encoderType', kRenderEncoderTypes))\n  .fn(async t => {\n    const { limitTest, testValueName, encoderType } = t.params;\n    await t.testDeviceWithRequestedMaximumLimits(\n      limitTest,\n      testValueName,\n      async ({ testValue, shouldError, actualLimit }) => {\n        const lastIndex = testValue - 1;\n\n        const buffer = t.createBufferTracked({\n          size: 16,\n          usage: GPUBufferUsage.VERTEX,\n        });\n\n        await t.testGPURenderAndBindingCommandsMixin(\n          encoderType,\n          ({ passEncoder }) => {\n            passEncoder.setVertexBuffer(lastIndex, buffer);\n          },\n          shouldError,\n          `lastIndex: ${lastIndex}, actualLimit: ${actualLimit}, shouldError: ${shouldError}`\n        );\n\n        buffer.destroy();\n      }\n    );\n  });\n\ng.test('validate,maxBindGroupsPlusVertexBuffers')\n  .desc(`Test that ${limit} <= maxBindGroupsPlusVertexBuffers`)\n  .fn(t => {\n    const { adapter, defaultLimit, adapterLimit } = t;\n    t.expect(defaultLimit <= t.getDefaultLimit('maxBindGroupsPlusVertexBuffers'));\n    t.expect(adapterLimit <= adapter.limits.maxBindGroupsPlusVertexBuffers);\n  });\n"],"mappings":"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"}