{"version":3,"file":"maxTextureDimension2D.spec.js","names":["getGPU","kAllCanvasTypes","createCanvas","kMaximumLimitBaseParams","makeLimitTestGroup","limit","g","description","test","desc","params","fn","t","limitTest","testValueName","testDeviceWithRequestedMaximumLimits","shouldError","testValue","actualLimit","dimensionIndex","size","testForValidationErrorWithPossibleOutOfMemoryError","texture","createTextureTracked","format","usage","GPUTextureUsage","TEXTURE_BINDING","destroy","combine","canvasType","device","canvas","context","getContext","expect","configure","rec","getPreferredCanvasFormat","width","height","getCurrentTexture"],"sources":["../../../../../../src/webgpu/api/validation/capability_checks/limits/maxTextureDimension2D.spec.ts"],"sourcesContent":["import { getGPU } from '../../../../../common/util/navigator_gpu.js';\nimport { kAllCanvasTypes, createCanvas } from '../../../../util/create_elements.js';\n\nimport { kMaximumLimitBaseParams, makeLimitTestGroup } from './limit_utils.js';\n\nconst limit = 'maxTextureDimension2D';\nexport const { g, description } = makeLimitTestGroup(limit);\n\ng.test('createTexture,at_over')\n  .desc(`Test using at and over ${limit} limit`)\n  .params(kMaximumLimitBaseParams)\n  .fn(async t => {\n    const { limitTest, testValueName } = t.params;\n    await t.testDeviceWithRequestedMaximumLimits(\n      limitTest,\n      testValueName,\n      async ({ shouldError, testValue, actualLimit }) => {\n        for (let dimensionIndex = 0; dimensionIndex < 2; ++dimensionIndex) {\n          const size = [1, 1, 1];\n          size[dimensionIndex] = testValue;\n\n          await t.testForValidationErrorWithPossibleOutOfMemoryError(\n            () => {\n              const texture = t.createTextureTracked({\n                size,\n                format: 'rgba8unorm',\n                usage: GPUTextureUsage.TEXTURE_BINDING,\n              });\n\n              // MAINTENANCE_TODO: Remove this 'if' once the bug in chrome is fixed\n              // This 'if' is only here because of a bug in Chrome\n              // that generates an error calling destroy on an invalid texture.\n              // This doesn't affect the test but the 'if' should be removed\n              // once the Chrome bug is fixed.\n              if (!shouldError) {\n                texture.destroy();\n              }\n            },\n            shouldError,\n            `size: ${size}, actualLimit: ${actualLimit}`\n          );\n        }\n      }\n    );\n  });\n\ng.test('configure,at_over')\n  .desc(`Test using at and over ${limit} limit`)\n  .params(kMaximumLimitBaseParams.combine('canvasType', kAllCanvasTypes))\n  .fn(async t => {\n    const { limitTest, testValueName, canvasType } = t.params;\n    await t.testDeviceWithRequestedMaximumLimits(\n      limitTest,\n      testValueName,\n      async ({ device, shouldError, testValue, actualLimit }) => {\n        for (let dimensionIndex = 0; dimensionIndex < 2; ++dimensionIndex) {\n          const size = [1, 1];\n          size[dimensionIndex] = testValue;\n\n          // This should not fail, even if the size is too large but it might fail\n          // if we're in a worker and HTMLCanvasElement does not exist.\n          const canvas = createCanvas(t, canvasType, size[0], size[1])!;\n          if (canvas) {\n            const context = canvas.getContext('webgpu') as GPUCanvasContext;\n            t.expect(!!context, 'should not fail to create context even if size is too large');\n\n            await t.testForValidationErrorWithPossibleOutOfMemoryError(\n              () => {\n                context.configure({\n                  device,\n                  format: getGPU(t.rec).getPreferredCanvasFormat(),\n                });\n              },\n              shouldError,\n              `size: ${size}, actualLimit: ${actualLimit}`\n            );\n          }\n        }\n      }\n    );\n  });\n\ng.test('getCurrentTexture,at_over')\n  .desc(`Test using at and over ${limit} limit`)\n  .params(kMaximumLimitBaseParams.combine('canvasType', kAllCanvasTypes))\n  .fn(async t => {\n    const { limitTest, testValueName, canvasType } = t.params;\n    await t.testDeviceWithRequestedMaximumLimits(\n      limitTest,\n      testValueName,\n      async ({ device, shouldError, testValue, actualLimit }) => {\n        for (let dimensionIndex = 0; dimensionIndex < 2; ++dimensionIndex) {\n          const size = [1, 1];\n          size[dimensionIndex] = testValue;\n\n          // Start with a small size so configure will succeed.\n          // This should not fail, even if the size is too large but it might fail\n          // if we're in a worker and HTMLCanvasElement does not exist.\n          const canvas = createCanvas(t, canvasType, 1, 1)!;\n          if (canvas) {\n            const context = canvas.getContext('webgpu') as GPUCanvasContext;\n            t.expect(!!context, 'should not fail to create context even if size is too large');\n\n            context.configure({\n              device,\n              format: getGPU(t.rec).getPreferredCanvasFormat(),\n            });\n\n            if (canvas) {\n              await t.testForValidationErrorWithPossibleOutOfMemoryError(\n                () => {\n                  canvas.width = size[0];\n                  canvas.height = size[1];\n                  const texture = context.getCurrentTexture();\n\n                  // MAINTENANCE_TODO: Remove this 'if' once the bug in chrome is fixed\n                  // This 'if' is only here because of a bug in Chrome\n                  // that generates an error calling destroy on an invalid texture.\n                  // This doesn't affect the test but the 'if' should be removed\n                  // once the Chrome bug is fixed.\n                  if (!shouldError) {\n                    texture.destroy();\n                  }\n                },\n                shouldError,\n                `size: ${size}, actualLimit: ${actualLimit}`\n              );\n            }\n          }\n        }\n      }\n    );\n  });\n"],"mappings":";;GAAA,SAASA,MAAM,QAAQ,6CAA6C,CACpE,SAASC,eAAe,EAAEC,YAAY,QAAQ,qCAAqC;AAEnF,SAASC,uBAAuB,EAAEC,kBAAkB,QAAQ,kBAAkB;;AAE9E,MAAMC,KAAK,GAAG,uBAAuB;AACrC,OAAO,MAAM,EAAEC,CAAC,EAAEC,WAAW,CAAC,CAAC,GAAGH,kBAAkB,CAACC,KAAK,CAAC;;AAE3DC,CAAC,CAACE,IAAI,CAAC,uBAAuB,CAAC;AAC5BC,IAAI,CAAE,0BAAyBJ,KAAM,QAAO,CAAC;AAC7CK,MAAM,CAACP,uBAAuB,CAAC;AAC/BQ,EAAE,CAAC,OAAMC,CAAC,KAAI;EACb,MAAM,EAAEC,SAAS,EAAEC,aAAa,CAAC,CAAC,GAAGF,CAAC,CAACF,MAAM;EAC7C,MAAME,CAAC,CAACG,oCAAoC;IAC1CF,SAAS;IACTC,aAAa;IACb,OAAO,EAAEE,WAAW,EAAEC,SAAS,EAAEC,WAAW,CAAC,CAAC,KAAK;MACjD,KAAK,IAAIC,cAAc,GAAG,CAAC,EAAEA,cAAc,GAAG,CAAC,EAAE,EAAEA,cAAc,EAAE;QACjE,MAAMC,IAAI,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;QACtBA,IAAI,CAACD,cAAc,CAAC,GAAGF,SAAS;;QAEhC,MAAML,CAAC,CAACS,kDAAkD;UACxD,MAAM;YACJ,MAAMC,OAAO,GAAGV,CAAC,CAACW,oBAAoB,CAAC;cACrCH,IAAI;cACJI,MAAM,EAAE,YAAY;cACpBC,KAAK,EAAEC,eAAe,CAACC;YACzB,CAAC,CAAC;;YAEF;YACA;YACA;YACA;YACA;YACA,IAAI,CAACX,WAAW,EAAE;cAChBM,OAAO,CAACM,OAAO,CAAC,CAAC;YACnB;UACF,CAAC;UACDZ,WAAW;UACV,SAAQI,IAAK,kBAAiBF,WAAY;QAC7C,CAAC;MACH;IACF;EACF,CAAC;AACH,CAAC,CAAC;;AAEJZ,CAAC,CAACE,IAAI,CAAC,mBAAmB,CAAC;AACxBC,IAAI,CAAE,0BAAyBJ,KAAM,QAAO,CAAC;AAC7CK,MAAM,CAACP,uBAAuB,CAAC0B,OAAO,CAAC,YAAY,EAAE5B,eAAe,CAAC,CAAC;AACtEU,EAAE,CAAC,OAAMC,CAAC,KAAI;EACb,MAAM,EAAEC,SAAS,EAAEC,aAAa,EAAEgB,UAAU,CAAC,CAAC,GAAGlB,CAAC,CAACF,MAAM;EACzD,MAAME,CAAC,CAACG,oCAAoC;IAC1CF,SAAS;IACTC,aAAa;IACb,OAAO,EAAEiB,MAAM,EAAEf,WAAW,EAAEC,SAAS,EAAEC,WAAW,CAAC,CAAC,KAAK;MACzD,KAAK,IAAIC,cAAc,GAAG,CAAC,EAAEA,cAAc,GAAG,CAAC,EAAE,EAAEA,cAAc,EAAE;QACjE,MAAMC,IAAI,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;QACnBA,IAAI,CAACD,cAAc,CAAC,GAAGF,SAAS;;QAEhC;QACA;QACA,MAAMe,MAAM,GAAG9B,YAAY,CAACU,CAAC,EAAEkB,UAAU,EAAEV,IAAI,CAAC,CAAC,CAAC,EAAEA,IAAI,CAAC,CAAC,CAAC,CAAE;QAC7D,IAAIY,MAAM,EAAE;UACV,MAAMC,OAAO,GAAGD,MAAM,CAACE,UAAU,CAAC,QAAQ,CAAqB;UAC/DtB,CAAC,CAACuB,MAAM,CAAC,CAAC,CAACF,OAAO,EAAE,6DAA6D,CAAC;;UAElF,MAAMrB,CAAC,CAACS,kDAAkD;YACxD,MAAM;cACJY,OAAO,CAACG,SAAS,CAAC;gBAChBL,MAAM;gBACNP,MAAM,EAAExB,MAAM,CAACY,CAAC,CAACyB,GAAG,CAAC,CAACC,wBAAwB,CAAC;cACjD,CAAC,CAAC;YACJ,CAAC;YACDtB,WAAW;YACV,SAAQI,IAAK,kBAAiBF,WAAY;UAC7C,CAAC;QACH;MACF;IACF;EACF,CAAC;AACH,CAAC,CAAC;;AAEJZ,CAAC,CAACE,IAAI,CAAC,2BAA2B,CAAC;AAChCC,IAAI,CAAE,0BAAyBJ,KAAM,QAAO,CAAC;AAC7CK,MAAM,CAACP,uBAAuB,CAAC0B,OAAO,CAAC,YAAY,EAAE5B,eAAe,CAAC,CAAC;AACtEU,EAAE,CAAC,OAAMC,CAAC,KAAI;EACb,MAAM,EAAEC,SAAS,EAAEC,aAAa,EAAEgB,UAAU,CAAC,CAAC,GAAGlB,CAAC,CAACF,MAAM;EACzD,MAAME,CAAC,CAACG,oCAAoC;IAC1CF,SAAS;IACTC,aAAa;IACb,OAAO,EAAEiB,MAAM,EAAEf,WAAW,EAAEC,SAAS,EAAEC,WAAW,CAAC,CAAC,KAAK;MACzD,KAAK,IAAIC,cAAc,GAAG,CAAC,EAAEA,cAAc,GAAG,CAAC,EAAE,EAAEA,cAAc,EAAE;QACjE,MAAMC,IAAI,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC;QACnBA,IAAI,CAACD,cAAc,CAAC,GAAGF,SAAS;;QAEhC;QACA;QACA;QACA,MAAMe,MAAM,GAAG9B,YAAY,CAACU,CAAC,EAAEkB,UAAU,EAAE,CAAC,EAAE,CAAC,CAAE;QACjD,IAAIE,MAAM,EAAE;UACV,MAAMC,OAAO,GAAGD,MAAM,CAACE,UAAU,CAAC,QAAQ,CAAqB;UAC/DtB,CAAC,CAACuB,MAAM,CAAC,CAAC,CAACF,OAAO,EAAE,6DAA6D,CAAC;;UAElFA,OAAO,CAACG,SAAS,CAAC;YAChBL,MAAM;YACNP,MAAM,EAAExB,MAAM,CAACY,CAAC,CAACyB,GAAG,CAAC,CAACC,wBAAwB,CAAC;UACjD,CAAC,CAAC;;UAEF,IAAIN,MAAM,EAAE;YACV,MAAMpB,CAAC,CAACS,kDAAkD;cACxD,MAAM;gBACJW,MAAM,CAACO,KAAK,GAAGnB,IAAI,CAAC,CAAC,CAAC;gBACtBY,MAAM,CAACQ,MAAM,GAAGpB,IAAI,CAAC,CAAC,CAAC;gBACvB,MAAME,OAAO,GAAGW,OAAO,CAACQ,iBAAiB,CAAC,CAAC;;gBAE3C;gBACA;gBACA;gBACA;gBACA;gBACA,IAAI,CAACzB,WAAW,EAAE;kBAChBM,OAAO,CAACM,OAAO,CAAC,CAAC;gBACnB;cACF,CAAC;cACDZ,WAAW;cACV,SAAQI,IAAK,kBAAiBF,WAAY;YAC7C,CAAC;UACH;QACF;MACF;IACF;EACF,CAAC;AACH,CAAC,CAAC"}