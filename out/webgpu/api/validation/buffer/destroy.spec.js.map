{"version":3,"file":"destroy.spec.js","names":["description","makeTestGroup","kBufferUsages","GPUConst","ValidationTest","g","test","desc","paramsSubcasesOnly","u","combine","fn","t","usage","params","buf","device","createBuffer","size","destroy","getErrorBuffer","combineWithParams","BufferUsage","COPY_SRC","MAP_WRITE","COPY_DST","MAP_READ","mapMode","MapMode","WRITE","READ","unless","p","mappedAtCreation","undefined","unmapBeforeDestroy","unmap","mapAsync"],"sources":["../../../../../src/webgpu/api/validation/buffer/destroy.spec.ts"],"sourcesContent":["export const description = `\nValidation tests for GPUBuffer.destroy.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { kBufferUsages } from '../../../capability_info.js';\nimport { GPUConst } from '../../../constants.js';\nimport { ValidationTest } from '../validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('all_usages')\n  .desc('Test destroying buffers of every usage type.')\n  .paramsSubcasesOnly(u =>\n    u //\n      .combine('usage', kBufferUsages)\n  )\n  .fn(t => {\n    const { usage } = t.params;\n    const buf = t.device.createBuffer({\n      size: 4,\n      usage,\n    });\n\n    buf.destroy();\n  });\n\ng.test('error_buffer')\n  .desc('Test that error buffers may be destroyed without generating validation errors.')\n  .fn(t => {\n    const buf = t.getErrorBuffer();\n    buf.destroy();\n  });\n\ng.test('twice')\n  .desc(\n    `Test that destroying a buffer more than once is allowed.\n      - Tests buffers which are mapped at creation or not\n      - Tests buffers with various usages`\n  )\n  .paramsSubcasesOnly(u =>\n    u //\n      .combine('mappedAtCreation', [false, true])\n      .combineWithParams([\n        { size: 4, usage: GPUConst.BufferUsage.COPY_SRC },\n        { size: 4, usage: GPUConst.BufferUsage.MAP_WRITE | GPUConst.BufferUsage.COPY_SRC },\n        { size: 4, usage: GPUConst.BufferUsage.COPY_DST | GPUConst.BufferUsage.MAP_READ },\n      ])\n  )\n  .fn(t => {\n    const buf = t.device.createBuffer(t.params);\n\n    buf.destroy();\n    buf.destroy();\n  });\n\ng.test('while_mapped')\n  .desc(\n    `Test destroying buffers while mapped or after being unmapped.\n      - Tests {mappable, unmappable mapAtCreation, mappable mapAtCreation}\n      - Tests while {mapped, mapped at creation, unmapped}`\n  )\n  .paramsSubcasesOnly(u =>\n    u //\n      .combine('mappedAtCreation', [false, true])\n      .combine('unmapBeforeDestroy', [false, true])\n      .combineWithParams([\n        { usage: GPUConst.BufferUsage.COPY_SRC },\n        { usage: GPUConst.BufferUsage.MAP_WRITE | GPUConst.BufferUsage.COPY_SRC },\n        { usage: GPUConst.BufferUsage.COPY_DST | GPUConst.BufferUsage.MAP_READ },\n        {\n          usage: GPUConst.BufferUsage.MAP_WRITE | GPUConst.BufferUsage.COPY_SRC,\n          mapMode: GPUConst.MapMode.WRITE,\n        },\n        {\n          usage: GPUConst.BufferUsage.COPY_DST | GPUConst.BufferUsage.MAP_READ,\n          mapMode: GPUConst.MapMode.READ,\n        },\n      ])\n      .unless(p => p.mappedAtCreation === false && p.mapMode === undefined)\n  )\n  .fn(async t => {\n    const { usage, mapMode, mappedAtCreation, unmapBeforeDestroy } = t.params;\n    const buf = t.device.createBuffer({\n      size: 4,\n      usage,\n      mappedAtCreation,\n    });\n\n    if (mapMode !== undefined) {\n      if (mappedAtCreation) {\n        buf.unmap();\n      }\n      await buf.mapAsync(mapMode);\n    }\n    if (unmapBeforeDestroy) {\n      buf.unmap();\n    }\n\n    buf.destroy();\n  });\n"],"mappings":"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"}