{"version":3,"file":"beginComputePass.spec.js","names":["description","makeTestGroup","kQueryTypes","ValidationTest","F","tryComputePass","success","descriptor","encoder","device","createCommandEncoder","computePass","beginComputePass","end","expectValidationError","finish","g","test","desc","params","u","combine","beforeAllSubcases","t","selectDeviceForQueryTypeOrSkipTestCase","queryType","fn","isValid","timestampWrites","querySet","createQuerySetTracked","type","count","beginningOfPassWriteIndex","endOfPassWriteIndex","selectDeviceOrSkipTestCase","querySetState","createQuerySetWithState","paramsSubcasesOnly","undefined","querySetCount","selectMismatchedDeviceOrSkipTestCase","mismatched","sourceDevice","mismatchedDevice","timestampQuerySet","trackForCleanup","createQuerySet"],"sources":["../../../../../src/webgpu/api/validation/encoding/beginComputePass.spec.ts"],"sourcesContent":["export const description = `\nTests for validation in beginComputePass and GPUComputePassDescriptor as its optional descriptor.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { kQueryTypes } from '../../../capability_info.js';\nimport { ValidationTest } from '../validation_test.js';\n\nclass F extends ValidationTest {\n  tryComputePass(success: boolean, descriptor: GPUComputePassDescriptor): void {\n    const encoder = this.device.createCommandEncoder();\n    const computePass = encoder.beginComputePass(descriptor);\n    computePass.end();\n\n    this.expectValidationError(() => {\n      encoder.finish();\n    }, !success);\n  }\n}\n\nexport const g = makeTestGroup(F);\n\ng.test('timestampWrites,query_set_type')\n  .desc(\n    `\n  Test that all entries of the timestampWrites must have type 'timestamp'. If all query types are\n  not 'timestamp' in GPUComputePassDescriptor, a validation error should be generated.\n  `\n  )\n  .params(u =>\n    u //\n      .combine('queryType', kQueryTypes)\n  )\n  .beforeAllSubcases(t => {\n    t.selectDeviceForQueryTypeOrSkipTestCase(['timestamp', t.params.queryType]);\n  })\n  .fn(t => {\n    const { queryType } = t.params;\n\n    const isValid = queryType === 'timestamp';\n\n    const timestampWrites = {\n      querySet: t.createQuerySetTracked({ type: queryType, count: 2 }),\n      beginningOfPassWriteIndex: 0,\n      endOfPassWriteIndex: 1,\n    };\n\n    const descriptor = {\n      timestampWrites,\n    };\n\n    t.tryComputePass(isValid, descriptor);\n  });\n\ng.test('timestampWrites,invalid_query_set')\n  .desc(`Tests that timestampWrite that has an invalid query set generates a validation error.`)\n  .params(u => u.combine('querySetState', ['valid', 'invalid'] as const))\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase(['timestamp-query']);\n  })\n  .fn(t => {\n    const { querySetState } = t.params;\n\n    const querySet = t.createQuerySetWithState(querySetState, {\n      type: 'timestamp',\n      count: 1,\n    });\n\n    const timestampWrites = {\n      querySet,\n      beginningOfPassWriteIndex: 0,\n    };\n\n    const descriptor = {\n      timestampWrites,\n    };\n\n    t.tryComputePass(querySetState === 'valid', descriptor);\n  });\n\ng.test('timestampWrites,query_index')\n  .desc(\n    `Test that querySet.count should be greater than timestampWrite.queryIndex, and that the\n         query indexes are unique.`\n  )\n  .paramsSubcasesOnly(u =>\n    u //\n      .combine('beginningOfPassWriteIndex', [undefined, 0, 1, 2, 3] as const)\n      .combine('endOfPassWriteIndex', [undefined, 0, 1, 2, 3] as const)\n  )\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase(['timestamp-query']);\n  })\n  .fn(t => {\n    const { beginningOfPassWriteIndex, endOfPassWriteIndex } = t.params;\n\n    const querySetCount = 2;\n\n    const timestampWrites = {\n      querySet: t.createQuerySetTracked({ type: 'timestamp', count: querySetCount }),\n      beginningOfPassWriteIndex,\n      endOfPassWriteIndex,\n    };\n\n    const isValid =\n      beginningOfPassWriteIndex !== endOfPassWriteIndex &&\n      (beginningOfPassWriteIndex === undefined || beginningOfPassWriteIndex < querySetCount) &&\n      (endOfPassWriteIndex === undefined || endOfPassWriteIndex < querySetCount);\n\n    const descriptor = {\n      timestampWrites,\n    };\n\n    t.tryComputePass(isValid, descriptor);\n  });\n\ng.test('timestamp_query_set,device_mismatch')\n  .desc(\n    `\n  Tests beginComputePass cannot be called with a timestamp query set created from another device.\n  `\n  )\n  .paramsSubcasesOnly(u => u.combine('mismatched', [true, false]))\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase(['timestamp-query']);\n    t.selectMismatchedDeviceOrSkipTestCase('timestamp-query');\n  })\n  .fn(t => {\n    const { mismatched } = t.params;\n    const sourceDevice = mismatched ? t.mismatchedDevice : t.device;\n\n    const timestampQuerySet = t.trackForCleanup(\n      sourceDevice.createQuerySet({\n        type: 'timestamp',\n        count: 1,\n      })\n    );\n\n    const timestampWrites = {\n      querySet: timestampQuerySet,\n      beginningOfPassWriteIndex: 0,\n    };\n\n    const descriptor = {\n      timestampWrites,\n    };\n\n    t.tryComputePass(!mismatched, descriptor);\n  });\n"],"mappings":"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"}