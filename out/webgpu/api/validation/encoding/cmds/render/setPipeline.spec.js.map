{"version":3,"file":"setPipeline.spec.js","names":["description","makeTestGroup","kRenderEncodeTypes","ValidationTest","kRenderEncodeTypeParams","g","test","desc","paramsSubcasesOnly","u","combine","fn","t","encoderType","state","params","pipeline","createRenderPipelineWithState","encoder","validateFinish","createEncoder","setPipeline","beforeAllSubcases","selectMismatchedDeviceOrSkipTestCase","undefined","mismatched","sourceDevice","mismatchedDevice","device","createRenderPipeline","layout","vertex","module","createShaderModule","code","entryPoint","fragment","targets","format","writeMask","primitive","topology"],"sources":["../../../../../../../src/webgpu/api/validation/encoding/cmds/render/setPipeline.spec.ts"],"sourcesContent":["export const description = `\nValidation tests for setPipeline on render pass and render bundle.\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { kRenderEncodeTypes } from '../../../../../util/command_buffer_maker.js';\nimport { ValidationTest } from '../../../validation_test.js';\n\nimport { kRenderEncodeTypeParams } from './render.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('invalid_pipeline')\n  .desc(\n    `\nTests setPipeline should generate an error iff using an 'invalid' pipeline.\n  `\n  )\n  .paramsSubcasesOnly(u =>\n    u.combine('encoderType', kRenderEncodeTypes).combine('state', ['valid', 'invalid'] as const)\n  )\n  .fn(t => {\n    const { encoderType, state } = t.params;\n    const pipeline = t.createRenderPipelineWithState(state);\n\n    const { encoder, validateFinish } = t.createEncoder(encoderType);\n    encoder.setPipeline(pipeline);\n    validateFinish(state !== 'invalid');\n  });\n\ng.test('pipeline,device_mismatch')\n  .desc('Tests setPipeline cannot be called with a render pipeline created from another device')\n  .paramsSubcasesOnly(kRenderEncodeTypeParams.combine('mismatched', [true, false]))\n  .beforeAllSubcases(t => {\n    t.selectMismatchedDeviceOrSkipTestCase(undefined);\n  })\n  .fn(t => {\n    const { encoderType, mismatched } = t.params;\n    const sourceDevice = mismatched ? t.mismatchedDevice : t.device;\n\n    const pipeline = sourceDevice.createRenderPipeline({\n      layout: 'auto',\n      vertex: {\n        module: sourceDevice.createShaderModule({\n          code: `@vertex fn main() -> @builtin(position) vec4<f32> { return vec4<f32>(); }`,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        module: sourceDevice.createShaderModule({\n          code: '@fragment fn main() {}',\n        }),\n        entryPoint: 'main',\n        targets: [{ format: 'rgba8unorm', writeMask: 0 }],\n      },\n      primitive: { topology: 'triangle-list' },\n    });\n\n    const { encoder, validateFinish } = t.createEncoder(encoderType);\n    encoder.setPipeline(pipeline);\n    validateFinish(!mismatched);\n  });\n"],"mappings":";AAAA;AAAA,GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA,CAAC,CAED,SAASC,aAAa,QAAQ,kDAAkD;AAChF,SAASC,kBAAkB,QAAQ,6CAA6C;AAChF,SAASC,cAAc,QAAQ,6BAA6B;;AAE5D,SAASC,uBAAuB,QAAQ,aAAa;;AAErD,OAAO,MAAMC,CAAC,GAAGJ,aAAa,CAACE,cAAc,CAAC;;AAE9CE,CAAC,CAACC,IAAI,CAAC,kBAAkB,CAAC;AACvBC,IAAI;AACF;AACL;AACA,GAAG,CACA;;AACAC,kBAAkB,CAAC,CAAAC,CAAC;AACnBA,CAAC,CAACC,OAAO,CAAC,aAAa,EAAER,kBAAkB,CAAC,CAACQ,OAAO,CAAC,OAAO,EAAE,CAAC,OAAO,EAAE,SAAS,CAAC,CAAU,CAC7F;;AACAC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAM,EAAEC,WAAW,EAAEC,KAAK,CAAC,CAAC,GAAGF,CAAC,CAACG,MAAM;EACvC,MAAMC,QAAQ,GAAGJ,CAAC,CAACK,6BAA6B,CAACH,KAAK,CAAC;;EAEvD,MAAM,EAAEI,OAAO,EAAEC,cAAc,CAAC,CAAC,GAAGP,CAAC,CAACQ,aAAa,CAACP,WAAW,CAAC;EAChEK,OAAO,CAACG,WAAW,CAACL,QAAQ,CAAC;EAC7BG,cAAc,CAACL,KAAK,KAAK,SAAS,CAAC;AACrC,CAAC,CAAC;;AAEJT,CAAC,CAACC,IAAI,CAAC,0BAA0B,CAAC;AAC/BC,IAAI,CAAC,uFAAuF,CAAC;AAC7FC,kBAAkB,CAACJ,uBAAuB,CAACM,OAAO,CAAC,YAAY,EAAE,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC;AAChFY,iBAAiB,CAAC,CAAAV,CAAC,KAAI;EACtBA,CAAC,CAACW,oCAAoC,CAACC,SAAS,CAAC;AACnD,CAAC,CAAC;AACDb,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAM,EAAEC,WAAW,EAAEY,UAAU,CAAC,CAAC,GAAGb,CAAC,CAACG,MAAM;EAC5C,MAAMW,YAAY,GAAGD,UAAU,GAAGb,CAAC,CAACe,gBAAgB,GAAGf,CAAC,CAACgB,MAAM;;EAE/D,MAAMZ,QAAQ,GAAGU,YAAY,CAACG,oBAAoB,CAAC;IACjDC,MAAM,EAAE,MAAM;IACdC,MAAM,EAAE;MACNC,MAAM,EAAEN,YAAY,CAACO,kBAAkB,CAAC;QACtCC,IAAI,EAAG;MACT,CAAC,CAAC;MACFC,UAAU,EAAE;IACd,CAAC;IACDC,QAAQ,EAAE;MACRJ,MAAM,EAAEN,YAAY,CAACO,kBAAkB,CAAC;QACtCC,IAAI,EAAE;MACR,CAAC,CAAC;MACFC,UAAU,EAAE,MAAM;MAClBE,OAAO,EAAE,CAAC,EAAEC,MAAM,EAAE,YAAY,EAAEC,SAAS,EAAE,CAAC,CAAC,CAAC;IAClD,CAAC;IACDC,SAAS,EAAE,EAAEC,QAAQ,EAAE,eAAe,CAAC;EACzC,CAAC,CAAC;;EAEF,MAAM,EAAEvB,OAAO,EAAEC,cAAc,CAAC,CAAC,GAAGP,CAAC,CAACQ,aAAa,CAACP,WAAW,CAAC;EAChEK,OAAO,CAACG,WAAW,CAACL,QAAQ,CAAC;EAC7BG,cAAc,CAAC,CAACM,UAAU,CAAC;AAC7B,CAAC,CAAC"}