{"version":3,"file":"query_set.spec.js","names":["description","makeTestGroup","ValidationTest","g","test","desc","paramsSubcasesOnly","u","combine","fn","t","occlusionQuerySet","createQuerySetWithState","params","querySetState","encoder","createEncoder","beginOcclusionQuery","endOcclusionQuery","validateFinishAndSubmitGivenState","beginSubcases","beforeAllSubcases","selectDeviceOrSkipTestCase","querySet","type","count","writeTimestamp","ex","skipIf","TypeError","buffer","device","createBuffer","size","usage","GPUBufferUsage","QUERY_RESOLVE","resolveQuerySet"],"sources":["../../../../../../src/webgpu/api/validation/queue/destroyed/query_set.spec.ts"],"sourcesContent":["export const description = `\nTests using a destroyed query set on a queue.\n`;\n\nimport { makeTestGroup } from '../../../../../common/framework/test_group.js';\nimport { ValidationTest } from '../../validation_test.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('beginOcclusionQuery')\n  .desc(\n    `\nTests that use a destroyed query set in occlusion query on render pass encoder.\n- x= {destroyed, not destroyed (control case)}\n  `\n  )\n  .paramsSubcasesOnly(u => u.combine('querySetState', ['valid', 'destroyed'] as const))\n  .fn(t => {\n    const occlusionQuerySet = t.createQuerySetWithState(t.params.querySetState);\n\n    const encoder = t.createEncoder('render pass', { occlusionQuerySet });\n    encoder.encoder.beginOcclusionQuery(0);\n    encoder.encoder.endOcclusionQuery();\n    encoder.validateFinishAndSubmitGivenState(t.params.querySetState);\n  });\n\ng.test('writeTimestamp')\n  .desc(\n    `\nTests that use a destroyed query set in writeTimestamp on {non-pass, compute, render} encoder.\n- x= {destroyed, not destroyed (control case)}\n\n  TODO: writeTimestamp is removed from the spec so it's skipped if it TypeErrors.\n  `\n  )\n  .params(u => u.beginSubcases().combine('querySetState', ['valid', 'destroyed'] as const))\n  .beforeAllSubcases(t => t.selectDeviceOrSkipTestCase('timestamp-query'))\n  .fn(t => {\n    const querySet = t.createQuerySetWithState(t.params.querySetState, {\n      type: 'timestamp',\n      count: 2,\n    });\n\n    const encoder = t.createEncoder('non-pass');\n    try {\n      encoder.encoder.writeTimestamp(querySet, 0);\n    } catch (ex) {\n      t.skipIf(ex instanceof TypeError, 'writeTimestamp is actually not available');\n    }\n    encoder.validateFinishAndSubmitGivenState(t.params.querySetState);\n  });\n\ng.test('resolveQuerySet')\n  .desc(\n    `\nTests that use a destroyed query set in resolveQuerySet.\n- x= {destroyed, not destroyed (control case)}\n  `\n  )\n  .paramsSubcasesOnly(u => u.combine('querySetState', ['valid', 'destroyed'] as const))\n  .fn(t => {\n    const querySet = t.createQuerySetWithState(t.params.querySetState);\n\n    const buffer = t.device.createBuffer({ size: 8, usage: GPUBufferUsage.QUERY_RESOLVE });\n\n    const encoder = t.createEncoder('non-pass');\n    encoder.encoder.resolveQuerySet(querySet, 0, 1, buffer, 0);\n    encoder.validateFinishAndSubmitGivenState(t.params.querySetState);\n  });\n"],"mappings":"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"}