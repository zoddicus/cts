{"version":3,"file":"storeop2.spec.js","names":["description","makeTestGroup","GPUTest","g","test","desc","paramsSimple","storeOp","_expected","fn","t","renderTexture","device","createTexture","size","width","height","depthOrArrayLayers","format","usage","GPUTextureUsage","COPY_SRC","RENDER_ATTACHMENT","renderPipeline","createRenderPipeline","layout","vertex","module","createShaderModule","code","entryPoint","fragment","targets","primitive","topology","encoder","createCommandEncoder","pass","beginRenderPass","colorAttachments","view","createView","params","clearValue","r","b","a","loadOp","setPipeline","draw","end","queue","submit","finish","expectSingleColor","exp","R"],"sources":["../../../../../src/webgpu/api/operation/render_pass/storeop2.spec.ts"],"sourcesContent":["export const description = `\nrenderPass store op test that drawn quad is either stored or cleared based on storeop\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { GPUTest } from '../../../gpu_test.js';\n\nexport const g = makeTestGroup(GPUTest);\n\ng.test('storeOp_controls_whether_1x1_drawn_quad_is_stored')\n  .desc(\n    `\nTODO: is this duplicated with api,operation,render_pass,storeOp?\nTODO: needs review and rename\n`\n  )\n  .paramsSimple([\n    { storeOp: 'store', _expected: 1 }, //\n    { storeOp: 'discard', _expected: 0 },\n  ] as const)\n  .fn(t => {\n    const renderTexture = t.device.createTexture({\n      size: { width: 1, height: 1, depthOrArrayLayers: 1 },\n      format: 'r8unorm',\n      usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.RENDER_ATTACHMENT,\n    });\n\n    // create render pipeline\n    const renderPipeline = t.device.createRenderPipeline({\n      layout: 'auto',\n      vertex: {\n        module: t.device.createShaderModule({\n          code: `\n            @vertex fn main(\n              @builtin(vertex_index) VertexIndex : u32\n              ) -> @builtin(position) vec4<f32> {\n              var pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(\n                  vec2<f32>( 1.0, -1.0),\n                  vec2<f32>( 1.0,  1.0),\n                  vec2<f32>(-1.0,  1.0));\n              return vec4<f32>(pos[VertexIndex], 0.0, 1.0);\n            }\n            `,\n        }),\n        entryPoint: 'main',\n      },\n      fragment: {\n        module: t.device.createShaderModule({\n          code: `\n            @fragment fn main() -> @location(0) vec4<f32> {\n              return vec4<f32>(1.0, 0.0, 0.0, 1.0);\n            }\n            `,\n        }),\n        entryPoint: 'main',\n        targets: [{ format: 'r8unorm' }],\n      },\n      primitive: { topology: 'triangle-list' },\n    });\n\n    // encode pass and submit\n    const encoder = t.device.createCommandEncoder();\n    const pass = encoder.beginRenderPass({\n      colorAttachments: [\n        {\n          view: renderTexture.createView(),\n          storeOp: t.params.storeOp,\n          clearValue: { r: 0.0, g: 0.0, b: 0.0, a: 0.0 },\n          loadOp: 'clear',\n        },\n      ],\n    });\n    pass.setPipeline(renderPipeline);\n    pass.draw(3);\n    pass.end();\n    t.device.queue.submit([encoder.finish()]);\n\n    // expect the buffer to be clear\n    t.expectSingleColor(renderTexture, 'r8unorm', {\n      size: [1, 1, 1],\n      exp: { R: t.params._expected },\n    });\n  });\n"],"mappings":";AAAA;AAAA,GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA,CAAC,CAED,SAASC,aAAa,QAAQ,4CAA4C;AAC1E,SAASC,OAAO,QAAQ,sBAAsB;;AAE9C,OAAO,MAAMC,CAAC,GAAGF,aAAa,CAACC,OAAO,CAAC;;AAEvCC,CAAC,CAACC,IAAI,CAAC,mDAAmD,CAAC;AACxDC,IAAI;AACF;AACL;AACA;AACA,CAAC,CACE;;AACAC,YAAY,CAAC;AACZ,EAAEC,OAAO,EAAE,OAAO,EAAEC,SAAS,EAAE,CAAC,CAAC,CAAC,EAAE;AACpC,EAAED,OAAO,EAAE,SAAS,EAAEC,SAAS,EAAE,CAAC,CAAC,CAAC,CACrC,CAAU;;AACVC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAMC,aAAa,GAAGD,CAAC,CAACE,MAAM,CAACC,aAAa,CAAC;IAC3CC,IAAI,EAAE,EAAEC,KAAK,EAAE,CAAC,EAAEC,MAAM,EAAE,CAAC,EAAEC,kBAAkB,EAAE,CAAC,CAAC,CAAC;IACpDC,MAAM,EAAE,SAAS;IACjBC,KAAK,EAAEC,eAAe,CAACC,QAAQ,GAAGD,eAAe,CAACE;EACpD,CAAC,CAAC;;EAEF;EACA,MAAMC,cAAc,GAAGb,CAAC,CAACE,MAAM,CAACY,oBAAoB,CAAC;IACnDC,MAAM,EAAE,MAAM;IACdC,MAAM,EAAE;MACNC,MAAM,EAAEjB,CAAC,CAACE,MAAM,CAACgB,kBAAkB,CAAC;QAClCC,IAAI,EAAG;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACQ,CAAC,CAAC;MACFC,UAAU,EAAE;IACd,CAAC;IACDC,QAAQ,EAAE;MACRJ,MAAM,EAAEjB,CAAC,CAACE,MAAM,CAACgB,kBAAkB,CAAC;QAClCC,IAAI,EAAG;AACjB;AACA;AACA;AACA;MACQ,CAAC,CAAC;MACFC,UAAU,EAAE,MAAM;MAClBE,OAAO,EAAE,CAAC,EAAEd,MAAM,EAAE,SAAS,CAAC,CAAC;IACjC,CAAC;IACDe,SAAS,EAAE,EAAEC,QAAQ,EAAE,eAAe,CAAC;EACzC,CAAC,CAAC;;EAEF;EACA,MAAMC,OAAO,GAAGzB,CAAC,CAACE,MAAM,CAACwB,oBAAoB,EAAE;EAC/C,MAAMC,IAAI,GAAGF,OAAO,CAACG,eAAe,CAAC;IACnCC,gBAAgB,EAAE;IAChB;MACEC,IAAI,EAAE7B,aAAa,CAAC8B,UAAU,EAAE;MAChClC,OAAO,EAAEG,CAAC,CAACgC,MAAM,CAACnC,OAAO;MACzBoC,UAAU,EAAE,EAAEC,CAAC,EAAE,GAAG,EAAEzC,CAAC,EAAE,GAAG,EAAE0C,CAAC,EAAE,GAAG,EAAEC,CAAC,EAAE,GAAG,CAAC,CAAC;MAC9CC,MAAM,EAAE;IACV,CAAC;;EAEL,CAAC,CAAC;EACFV,IAAI,CAACW,WAAW,CAACzB,cAAc,CAAC;EAChCc,IAAI,CAACY,IAAI,CAAC,CAAC,CAAC;EACZZ,IAAI,CAACa,GAAG,EAAE;EACVxC,CAAC,CAACE,MAAM,CAACuC,KAAK,CAACC,MAAM,CAAC,CAACjB,OAAO,CAACkB,MAAM,EAAE,CAAC,CAAC;;EAEzC;EACA3C,CAAC,CAAC4C,iBAAiB,CAAC3C,aAAa,EAAE,SAAS,EAAE;IAC5CG,IAAI,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC;IACfyC,GAAG,EAAE,EAAEC,CAAC,EAAE9C,CAAC,CAACgC,MAAM,CAAClC,SAAS,CAAC;EAC/B,CAAC,CAAC;AACJ,CAAC,CAAC"}