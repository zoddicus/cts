{"version":3,"file":"texture_zero.spec.js","names":["description","kUnitCaseParamsBuilder","makeTestGroup","assert","unreachable","kTextureAspects","kTextureDimensions","GPUConst","kTextureFormatInfo","kUncompressedTextureFormats","textureDimensionAndFormatCompatible","GPUTest","virtualMipSize","createTextureUploadBuffer","SubresourceRange","kTexelRepresentationInfo","UninitializeMethod","kUninitializeMethods","Object","keys","ReadMethod","kMipLevelCounts","kUninitializedMipRangesToTest","begin","end","kSampleCounts","kUninitializedLayerRangesToTest","InitializedState","initializedStateAsFloat","Zero","Canary","initializedStateAsUint","initializedStateAsSint","initializedStateAsColor","state","format","value","indexOf","initializedStateAsDepth","initializedStateAsStencil","getRequiredTextureUsage","sampleCount","uninitializeMethod","readMethod","usage","TextureUsage","COPY_DST","Creation","StoreOpClear","RENDER_ATTACHMENT","CopyToBuffer","CopyToTexture","COPY_SRC","Sample","TEXTURE_BINDING","Storage","STORAGE_BINDING","DepthTest","StencilTest","ColorBlending","copyDst","renderable","TextureZeroInitTest","constructor","sharedState","rec","params","p","stateToTexelComponents","R","G","B","A","Depth","Stencil","textureWidth","width","mipLevelCount","nonPowerOfTwo","textureHeight","dimension","height","textureDepth","textureDepthOrArrayLayers","layerCount","iterateUninitializedSubresources","mipRange","layerRange","iterateInitializedSubresources","uninitialized","Array","level","length","subresources","layer","each","count","generateTextureViewDescriptorsForRendering","aspect","subresourceRange","viewDescriptor","undefined","baseMipLevel","baseArrayLayer","arrayLayerCount","initializeWithStoreOp","texture","commandEncoder","device","createCommandEncoder","pushDebugGroup","color","beginRenderPass","colorAttachments","view","createView","storeOp","clearValue","loadOp","depthStencilAttachment","depth","depthClearValue","depthLoadOp","depthStoreOp","stencil","stencilClearValue","stencilLoadOp","stencilStoreOp","popDebugGroup","queue","submit","finish","initializeWithCopy","firstSubresource","next","largestWidth","largestHeight","largestDepth","rep","texelData","Uint8Array","pack","encode","buffer","bytesPerRow","rowsPerImage","copyBufferToTexture","mipLevel","origin","x","y","z","depthOrArrayLayers","destroy","initializeTexture","discardTexture","desc","kTestParams","combine","filter","beginSubcases","unless","info","formatInfo","expandWithParams","storage","multisample","canaryOnCreation","canInitialize","checkContentsByBufferCopy","checkContentsByTextureCopy","checkContentsByDepthTest","checkContentsByStencilTest","checkContentsBySampling","checkContentsImpl","t","skip","g","test","beforeAllSubcases","skipIfTextureFormatNotSupported","selectDeviceOrSkipTestCase","feature","fn","createTexture","size","trackForCleanup"],"sources":["../../../../../src/webgpu/api/operation/resource_init/texture_zero.spec.ts"],"sourcesContent":["export const description = `\nTest uninitialized textures are initialized to zero when read.\n\nTODO:\n- test by sampling depth/stencil [1]\n- test by copying out of stencil [2]\n- test compressed texture formats [3]\n`;\n\n// MAINTENANCE_TODO: This is a test file, it probably shouldn't export anything.\n// Everything that's exported should be moved to another file.\n\nimport { TestCaseRecorder, TestParams } from '../../../../common/framework/fixture.js';\nimport {\n  kUnitCaseParamsBuilder,\n  ParamTypeOf,\n} from '../../../../common/framework/params_builder.js';\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { assert, unreachable } from '../../../../common/util/util.js';\nimport { kTextureAspects, kTextureDimensions } from '../../../capability_info.js';\nimport { GPUConst } from '../../../constants.js';\nimport {\n  kTextureFormatInfo,\n  kUncompressedTextureFormats,\n  textureDimensionAndFormatCompatible,\n  UncompressedTextureFormat,\n  EncodableTextureFormat,\n} from '../../../format_info.js';\nimport { GPUTest, GPUTestSubcaseBatchState } from '../../../gpu_test.js';\nimport { virtualMipSize } from '../../../util/texture/base.js';\nimport { createTextureUploadBuffer } from '../../../util/texture/layout.js';\nimport { BeginEndRange, SubresourceRange } from '../../../util/texture/subresource.js';\nimport { PerTexelComponent, kTexelRepresentationInfo } from '../../../util/texture/texel_data.js';\n\nexport enum UninitializeMethod {\n  Creation = 'Creation', // The texture was just created. It is uninitialized.\n  StoreOpClear = 'StoreOpClear', // The texture was rendered to with GPUStoreOp \"clear\"\n}\nconst kUninitializeMethods = Object.keys(UninitializeMethod) as UninitializeMethod[];\n\nexport const enum ReadMethod {\n  Sample = 'Sample', // The texture is sampled from\n  CopyToBuffer = 'CopyToBuffer', // The texture is copied to a buffer\n  CopyToTexture = 'CopyToTexture', // The texture is copied to another texture\n  DepthTest = 'DepthTest', // The texture is read as a depth buffer\n  StencilTest = 'StencilTest', // The texture is read as a stencil buffer\n  ColorBlending = 'ColorBlending', // Read the texture by blending as a color attachment\n  Storage = 'Storage', // Read the texture as a storage texture\n}\n\n// Test with these mip level counts\ntype MipLevels = 1 | 5;\nconst kMipLevelCounts: MipLevels[] = [1, 5];\n\n// For each mip level count, define the mip ranges to leave uninitialized.\nconst kUninitializedMipRangesToTest: { [k in MipLevels]: BeginEndRange[] } = {\n  1: [{ begin: 0, end: 1 }], // Test the only mip\n  5: [\n    { begin: 0, end: 2 },\n    { begin: 3, end: 4 },\n  ], // Test a range and a single mip\n};\n\n// Test with these sample counts.\nconst kSampleCounts: number[] = [1, 4];\n\n// Test with these layer counts.\ntype LayerCounts = 1 | 7;\n\n// For each layer count, define the layers to leave uninitialized.\nconst kUninitializedLayerRangesToTest: { [k in LayerCounts]: BeginEndRange[] } = {\n  1: [{ begin: 0, end: 1 }], // Test the only layer\n  7: [\n    { begin: 2, end: 4 },\n    { begin: 6, end: 7 },\n  ], // Test a range and a single layer\n};\n\n// Enums to abstract over color / depth / stencil values in textures. Depending on the texture format,\n// the data for each value may have a different representation. These enums are converted to a\n// representation such that their values can be compared. ex.) An integer is needed to upload to an\n// unsigned normalized format, but its value is read as a float in the shader.\nexport const enum InitializedState {\n  Canary, // Set on initialized subresources. It should stay the same. On discarded resources, we should observe zero.\n  Zero, // We check that uninitialized subresources are in this state when read back.\n}\n\nconst initializedStateAsFloat = {\n  [InitializedState.Zero]: 0,\n  [InitializedState.Canary]: 1,\n};\n\nconst initializedStateAsUint = {\n  [InitializedState.Zero]: 0,\n  [InitializedState.Canary]: 1,\n};\n\nconst initializedStateAsSint = {\n  [InitializedState.Zero]: 0,\n  [InitializedState.Canary]: -1,\n};\n\nfunction initializedStateAsColor(\n  state: InitializedState,\n  format: GPUTextureFormat\n): [number, number, number, number] {\n  let value;\n  if (format.indexOf('uint') !== -1) {\n    value = initializedStateAsUint[state];\n  } else if (format.indexOf('sint') !== -1) {\n    value = initializedStateAsSint[state];\n  } else {\n    value = initializedStateAsFloat[state];\n  }\n  return [value, value, value, value];\n}\n\nconst initializedStateAsDepth = {\n  [InitializedState.Zero]: 0,\n  [InitializedState.Canary]: 0.8,\n};\n\nconst initializedStateAsStencil = {\n  [InitializedState.Zero]: 0,\n  [InitializedState.Canary]: 42,\n};\n\nfunction getRequiredTextureUsage(\n  format: UncompressedTextureFormat,\n  sampleCount: number,\n  uninitializeMethod: UninitializeMethod,\n  readMethod: ReadMethod\n): GPUTextureUsageFlags {\n  let usage: GPUTextureUsageFlags = GPUConst.TextureUsage.COPY_DST;\n\n  switch (uninitializeMethod) {\n    case UninitializeMethod.Creation:\n      break;\n    case UninitializeMethod.StoreOpClear:\n      usage |= GPUConst.TextureUsage.RENDER_ATTACHMENT;\n      break;\n    default:\n      unreachable();\n  }\n\n  switch (readMethod) {\n    case ReadMethod.CopyToBuffer:\n    case ReadMethod.CopyToTexture:\n      usage |= GPUConst.TextureUsage.COPY_SRC;\n      break;\n    case ReadMethod.Sample:\n      usage |= GPUConst.TextureUsage.TEXTURE_BINDING;\n      break;\n    case ReadMethod.Storage:\n      usage |= GPUConst.TextureUsage.STORAGE_BINDING;\n      break;\n    case ReadMethod.DepthTest:\n    case ReadMethod.StencilTest:\n    case ReadMethod.ColorBlending:\n      usage |= GPUConst.TextureUsage.RENDER_ATTACHMENT;\n      break;\n    default:\n      unreachable();\n  }\n\n  if (sampleCount > 1) {\n    // Copies to multisampled textures are not allowed. We need OutputAttachment to initialize\n    // canary data in multisampled textures.\n    usage |= GPUConst.TextureUsage.RENDER_ATTACHMENT;\n  }\n\n  if (!kTextureFormatInfo[format].copyDst) {\n    // Copies are not possible. We need OutputAttachment to initialize\n    // canary data.\n    assert(kTextureFormatInfo[format].renderable);\n    usage |= GPUConst.TextureUsage.RENDER_ATTACHMENT;\n  }\n\n  return usage;\n}\n\nexport class TextureZeroInitTest extends GPUTest {\n  readonly stateToTexelComponents: { [k in InitializedState]: PerTexelComponent<number> };\n\n  private p: TextureZeroParams;\n  constructor(sharedState: GPUTestSubcaseBatchState, rec: TestCaseRecorder, params: TestParams) {\n    super(sharedState, rec, params);\n    this.p = params as TextureZeroParams;\n\n    const stateToTexelComponents = (state: InitializedState) => {\n      const [R, G, B, A] = initializedStateAsColor(state, this.p.format);\n      return {\n        R,\n        G,\n        B,\n        A,\n        Depth: initializedStateAsDepth[state],\n        Stencil: initializedStateAsStencil[state],\n      };\n    };\n\n    this.stateToTexelComponents = {\n      [InitializedState.Zero]: stateToTexelComponents(InitializedState.Zero),\n      [InitializedState.Canary]: stateToTexelComponents(InitializedState.Canary),\n    };\n  }\n\n  get textureWidth(): number {\n    let width = 1 << this.p.mipLevelCount;\n    if (this.p.nonPowerOfTwo) {\n      width = 2 * width - 1;\n    }\n    return width;\n  }\n\n  get textureHeight(): number {\n    if (this.p.dimension === '1d') {\n      return 1;\n    }\n\n    let height = 1 << this.p.mipLevelCount;\n    if (this.p.nonPowerOfTwo) {\n      height = 2 * height - 1;\n    }\n    return height;\n  }\n\n  get textureDepth(): number {\n    return this.p.dimension === '3d' ? 11 : 1;\n  }\n\n  get textureDepthOrArrayLayers(): number {\n    return this.p.dimension === '2d' ? this.p.layerCount : this.textureDepth;\n  }\n\n  // Used to iterate subresources and check that their uninitialized contents are zero when accessed\n  *iterateUninitializedSubresources(): Generator<SubresourceRange> {\n    for (const mipRange of kUninitializedMipRangesToTest[this.p.mipLevelCount]) {\n      for (const layerRange of kUninitializedLayerRangesToTest[this.p.layerCount]) {\n        yield new SubresourceRange({ mipRange, layerRange });\n      }\n    }\n  }\n\n  // Used to iterate and initialize other subresources not checked for zero-initialization.\n  // Zero-initialization of uninitialized subresources should not have side effects on already\n  // initialized subresources.\n  *iterateInitializedSubresources(): Generator<SubresourceRange> {\n    const uninitialized: boolean[][] = new Array(this.p.mipLevelCount);\n    for (let level = 0; level < uninitialized.length; ++level) {\n      uninitialized[level] = new Array(this.p.layerCount);\n    }\n    for (const subresources of this.iterateUninitializedSubresources()) {\n      for (const { level, layer } of subresources.each()) {\n        uninitialized[level][layer] = true;\n      }\n    }\n    for (let level = 0; level < uninitialized.length; ++level) {\n      for (let layer = 0; layer < uninitialized[level].length; ++layer) {\n        if (!uninitialized[level][layer]) {\n          yield new SubresourceRange({\n            mipRange: { begin: level, count: 1 },\n            layerRange: { begin: layer, count: 1 },\n          });\n        }\n      }\n    }\n  }\n\n  *generateTextureViewDescriptorsForRendering(\n    aspect: GPUTextureAspect,\n    subresourceRange?: SubresourceRange\n  ): Generator<GPUTextureViewDescriptor> {\n    const viewDescriptor: GPUTextureViewDescriptor = {\n      dimension: '2d',\n      aspect,\n    };\n\n    if (subresourceRange === undefined) {\n      return viewDescriptor;\n    }\n\n    for (const { level, layer } of subresourceRange.each()) {\n      yield {\n        ...viewDescriptor,\n        baseMipLevel: level,\n        mipLevelCount: 1,\n        baseArrayLayer: layer,\n        arrayLayerCount: 1,\n      };\n    }\n  }\n\n  private initializeWithStoreOp(\n    state: InitializedState,\n    texture: GPUTexture,\n    subresourceRange?: SubresourceRange\n  ): void {\n    const commandEncoder = this.device.createCommandEncoder();\n    commandEncoder.pushDebugGroup('initializeWithStoreOp');\n\n    for (const viewDescriptor of this.generateTextureViewDescriptorsForRendering(\n      'all',\n      subresourceRange\n    )) {\n      if (kTextureFormatInfo[this.p.format].color) {\n        commandEncoder\n          .beginRenderPass({\n            colorAttachments: [\n              {\n                view: texture.createView(viewDescriptor),\n                storeOp: 'store',\n                clearValue: initializedStateAsColor(state, this.p.format),\n                loadOp: 'clear',\n              },\n            ],\n          })\n          .end();\n      } else {\n        const depthStencilAttachment: GPURenderPassDepthStencilAttachment = {\n          view: texture.createView(viewDescriptor),\n        };\n        if (kTextureFormatInfo[this.p.format].depth) {\n          depthStencilAttachment.depthClearValue = initializedStateAsDepth[state];\n          depthStencilAttachment.depthLoadOp = 'clear';\n          depthStencilAttachment.depthStoreOp = 'store';\n        }\n        if (kTextureFormatInfo[this.p.format].stencil) {\n          depthStencilAttachment.stencilClearValue = initializedStateAsStencil[state];\n          depthStencilAttachment.stencilLoadOp = 'clear';\n          depthStencilAttachment.stencilStoreOp = 'store';\n        }\n        commandEncoder\n          .beginRenderPass({\n            colorAttachments: [],\n            depthStencilAttachment,\n          })\n          .end();\n      }\n    }\n\n    commandEncoder.popDebugGroup();\n    this.queue.submit([commandEncoder.finish()]);\n  }\n\n  private initializeWithCopy(\n    texture: GPUTexture,\n    state: InitializedState,\n    subresourceRange: SubresourceRange\n  ): void {\n    assert(this.p.format in kTextureFormatInfo);\n    const format = this.p.format as EncodableTextureFormat;\n\n    const firstSubresource = subresourceRange.each().next().value;\n    assert(typeof firstSubresource !== 'undefined');\n\n    const [largestWidth, largestHeight, largestDepth] = virtualMipSize(\n      this.p.dimension,\n      [this.textureWidth, this.textureHeight, this.textureDepth],\n      firstSubresource.level\n    );\n\n    const rep = kTexelRepresentationInfo[format];\n    const texelData = new Uint8Array(rep.pack(rep.encode(this.stateToTexelComponents[state])));\n    const { buffer, bytesPerRow, rowsPerImage } = createTextureUploadBuffer(\n      texelData,\n      this.device,\n      format,\n      this.p.dimension,\n      [largestWidth, largestHeight, largestDepth]\n    );\n\n    const commandEncoder = this.device.createCommandEncoder();\n\n    for (const { level, layer } of subresourceRange.each()) {\n      const [width, height, depth] = virtualMipSize(\n        this.p.dimension,\n        [this.textureWidth, this.textureHeight, this.textureDepth],\n        level\n      );\n\n      commandEncoder.copyBufferToTexture(\n        {\n          buffer,\n          bytesPerRow,\n          rowsPerImage,\n        },\n        { texture, mipLevel: level, origin: { x: 0, y: 0, z: layer } },\n        { width, height, depthOrArrayLayers: depth }\n      );\n    }\n    this.queue.submit([commandEncoder.finish()]);\n    buffer.destroy();\n  }\n\n  initializeTexture(\n    texture: GPUTexture,\n    state: InitializedState,\n    subresourceRange: SubresourceRange\n  ): void {\n    if (this.p.sampleCount > 1 || !kTextureFormatInfo[this.p.format].copyDst) {\n      // Copies to multisampled textures not yet specified.\n      // Use a storeOp for now.\n      assert(kTextureFormatInfo[this.p.format].renderable);\n      this.initializeWithStoreOp(state, texture, subresourceRange);\n    } else {\n      this.initializeWithCopy(texture, state, subresourceRange);\n    }\n  }\n\n  discardTexture(texture: GPUTexture, subresourceRange: SubresourceRange): void {\n    const commandEncoder = this.device.createCommandEncoder();\n    commandEncoder.pushDebugGroup('discardTexture');\n\n    for (const desc of this.generateTextureViewDescriptorsForRendering('all', subresourceRange)) {\n      if (kTextureFormatInfo[this.p.format].color) {\n        commandEncoder\n          .beginRenderPass({\n            colorAttachments: [\n              {\n                view: texture.createView(desc),\n                storeOp: 'discard',\n                loadOp: 'load',\n              },\n            ],\n          })\n          .end();\n      } else {\n        const depthStencilAttachment: GPURenderPassDepthStencilAttachment = {\n          view: texture.createView(desc),\n        };\n        if (kTextureFormatInfo[this.p.format].depth) {\n          depthStencilAttachment.depthLoadOp = 'load';\n          depthStencilAttachment.depthStoreOp = 'discard';\n        }\n        if (kTextureFormatInfo[this.p.format].stencil) {\n          depthStencilAttachment.stencilLoadOp = 'load';\n          depthStencilAttachment.stencilStoreOp = 'discard';\n        }\n        commandEncoder\n          .beginRenderPass({\n            colorAttachments: [],\n            depthStencilAttachment,\n          })\n          .end();\n      }\n    }\n\n    commandEncoder.popDebugGroup();\n    this.queue.submit([commandEncoder.finish()]);\n  }\n}\n\nconst kTestParams = kUnitCaseParamsBuilder\n  .combine('dimension', kTextureDimensions)\n  .combine('readMethod', [\n    ReadMethod.CopyToBuffer,\n    ReadMethod.CopyToTexture,\n    ReadMethod.Sample,\n    ReadMethod.DepthTest,\n    ReadMethod.StencilTest,\n  ])\n  // [3] compressed formats\n  .combine('format', kUncompressedTextureFormats)\n  .filter(({ dimension, format }) => textureDimensionAndFormatCompatible(dimension, format))\n  .beginSubcases()\n  .combine('aspect', kTextureAspects)\n  .unless(({ readMethod, format, aspect }) => {\n    const info = kTextureFormatInfo[format];\n    return (\n      (readMethod === ReadMethod.DepthTest && (!info.depth || aspect === 'stencil-only')) ||\n      (readMethod === ReadMethod.StencilTest && (!info.stencil || aspect === 'depth-only')) ||\n      (readMethod === ReadMethod.ColorBlending && !info.color) ||\n      // [1]: Test with depth/stencil sampling\n      (readMethod === ReadMethod.Sample && (!!info.depth || !!info.stencil)) ||\n      (aspect === 'depth-only' && !info.depth) ||\n      (aspect === 'stencil-only' && !info.stencil) ||\n      (aspect === 'all' && !!info.depth && !!info.stencil) ||\n      // Cannot copy from a packed depth format.\n      // [2]: Test copying out of the stencil aspect.\n      ((readMethod === ReadMethod.CopyToBuffer || readMethod === ReadMethod.CopyToTexture) &&\n        (format === 'depth24plus' || format === 'depth24plus-stencil8'))\n    );\n  })\n  .combine('mipLevelCount', kMipLevelCounts)\n  // 1D texture can only have a single mip level\n  .unless(p => p.dimension === '1d' && p.mipLevelCount !== 1)\n  .combine('sampleCount', kSampleCounts)\n  .unless(\n    ({ readMethod, sampleCount }) =>\n      // We can only read from multisampled textures by sampling.\n      sampleCount > 1 &&\n      (readMethod === ReadMethod.CopyToBuffer || readMethod === ReadMethod.CopyToTexture)\n  )\n  // Multisampled textures may only have one mip\n  .unless(({ sampleCount, mipLevelCount }) => sampleCount > 1 && mipLevelCount > 1)\n  .combine('uninitializeMethod', kUninitializeMethods)\n  .unless(({ dimension, readMethod, uninitializeMethod, format, sampleCount }) => {\n    const formatInfo = kTextureFormatInfo[format];\n    return (\n      dimension !== '2d' &&\n      (sampleCount > 1 ||\n        !!formatInfo.depth ||\n        !!formatInfo.stencil ||\n        readMethod === ReadMethod.DepthTest ||\n        readMethod === ReadMethod.StencilTest ||\n        readMethod === ReadMethod.ColorBlending ||\n        uninitializeMethod === UninitializeMethod.StoreOpClear)\n    );\n  })\n  .expandWithParams(function* ({ dimension }) {\n    switch (dimension) {\n      case '2d':\n        yield { layerCount: 1 as LayerCounts };\n        yield { layerCount: 7 as LayerCounts };\n        break;\n      case '1d':\n      case '3d':\n        yield { layerCount: 1 as LayerCounts };\n        break;\n    }\n  })\n  // Multisampled 3D / 2D array textures not supported.\n  .unless(({ sampleCount, layerCount }) => sampleCount > 1 && layerCount > 1)\n  .unless(({ format, sampleCount, uninitializeMethod, readMethod }) => {\n    const usage = getRequiredTextureUsage(format, sampleCount, uninitializeMethod, readMethod);\n    const info = kTextureFormatInfo[format];\n\n    return (\n      ((usage & GPUConst.TextureUsage.RENDER_ATTACHMENT) !== 0 && !info.renderable) ||\n      ((usage & GPUConst.TextureUsage.STORAGE_BINDING) !== 0 && !info.color?.storage) ||\n      (sampleCount > 1 && !info.multisample)\n    );\n  })\n  .combine('nonPowerOfTwo', [false, true])\n  .combine('canaryOnCreation', [false, true])\n  .filter(({ canaryOnCreation, format }) => {\n    // We can only initialize the texture if it's encodable or renderable.\n    const canInitialize = format in kTextureFormatInfo || kTextureFormatInfo[format].renderable;\n\n    // Filter out cases where we want canary values but can't initialize.\n    return !canaryOnCreation || canInitialize;\n  });\n\ntype TextureZeroParams = ParamTypeOf<typeof kTestParams>;\n\nexport type CheckContents = (\n  t: TextureZeroInitTest,\n  params: TextureZeroParams,\n  texture: GPUTexture,\n  state: InitializedState,\n  subresourceRange: SubresourceRange\n) => void;\n\nimport { checkContentsByBufferCopy, checkContentsByTextureCopy } from './check_texture/by_copy.js';\nimport {\n  checkContentsByDepthTest,\n  checkContentsByStencilTest,\n} from './check_texture/by_ds_test.js';\nimport { checkContentsBySampling } from './check_texture/by_sampling.js';\n\nconst checkContentsImpl: { [k in ReadMethod]: CheckContents } = {\n  Sample: checkContentsBySampling,\n  CopyToBuffer: checkContentsByBufferCopy,\n  CopyToTexture: checkContentsByTextureCopy,\n  DepthTest: checkContentsByDepthTest,\n  StencilTest: checkContentsByStencilTest,\n  ColorBlending: t => t.skip('Not implemented'),\n  Storage: t => t.skip('Not implemented'),\n};\n\nexport const g = makeTestGroup(TextureZeroInitTest);\n\ng.test('uninitialized_texture_is_zero')\n  .params(kTestParams)\n  .beforeAllSubcases(t => {\n    t.skipIfTextureFormatNotSupported(t.params.format);\n    t.selectDeviceOrSkipTestCase(kTextureFormatInfo[t.params.format].feature);\n  })\n  .fn(t => {\n    const usage = getRequiredTextureUsage(\n      t.params.format,\n      t.params.sampleCount,\n      t.params.uninitializeMethod,\n      t.params.readMethod\n    );\n\n    const texture = t.device.createTexture({\n      size: [t.textureWidth, t.textureHeight, t.textureDepthOrArrayLayers],\n      format: t.params.format,\n      dimension: t.params.dimension,\n      usage,\n      mipLevelCount: t.params.mipLevelCount,\n      sampleCount: t.params.sampleCount,\n    });\n    t.trackForCleanup(texture);\n\n    if (t.params.canaryOnCreation) {\n      // Initialize some subresources with canary values\n      for (const subresourceRange of t.iterateInitializedSubresources()) {\n        t.initializeTexture(texture, InitializedState.Canary, subresourceRange);\n      }\n    }\n\n    switch (t.params.uninitializeMethod) {\n      case UninitializeMethod.Creation:\n        break;\n      case UninitializeMethod.StoreOpClear:\n        // Initialize the rest of the resources.\n        for (const subresourceRange of t.iterateUninitializedSubresources()) {\n          t.initializeTexture(texture, InitializedState.Canary, subresourceRange);\n        }\n        // Then use a store op to discard their contents.\n        for (const subresourceRange of t.iterateUninitializedSubresources()) {\n          t.discardTexture(texture, subresourceRange);\n        }\n        break;\n      default:\n        unreachable();\n    }\n\n    // Check that all uninitialized resources are zero.\n    for (const subresourceRange of t.iterateUninitializedSubresources()) {\n      checkContentsImpl[t.params.readMethod](\n        t,\n        t.params,\n        texture,\n        InitializedState.Zero,\n        subresourceRange\n      );\n    }\n\n    if (t.params.canaryOnCreation) {\n      // Check the all other resources are unchanged.\n      for (const subresourceRange of t.iterateInitializedSubresources()) {\n        checkContentsImpl[t.params.readMethod](\n          t,\n          t.params,\n          texture,\n          InitializedState.Canary,\n          subresourceRange\n        );\n      }\n    }\n  });\n"],"mappings":"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"}