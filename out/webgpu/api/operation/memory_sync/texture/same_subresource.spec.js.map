{"version":3,"file":"same_subresource.spec.js","names":["description","makeTestGroup","assert","memcpy","unreachable","GPUTest","MaxLimitsTestMixin","align","getTextureCopyLayout","kTexelRepresentationInfo","kOperationBoundaries","kBoundaryInfo","OperationContextHelper","kAllReadOps","kAllWriteOps","checkOpsValidForContext","kOpInfo","g","fullscreenQuadWGSL","readOpNeedsStorageTexture","op","in","context","writeOpNeedsStorageTexture","TextureSyncTestHelper","kTextureSize","kTextureFormat","constructor","t","textureCreationParams","texture","createTextureTracked","size","format","skipIfNeedStorageTexturesAndNoStorageTextures","reads","writes","isCompatibility","device","limits","maxStorageTexturesInFragmentStage","needStorageTexture","reduce","need","read","write","skipIf","performReadOp","ensureContext","usage","GPUTextureUsage","COPY_SRC","COPY_DST","commandEncoder","undefined","copyTextureToTexture","byteLength","bytesPerRow","buffer","createBufferTracked","GPUBufferUsage","copyTextureToBuffer","copyBufferToTexture","STORAGE_BINDING","bindGroupLayout","createBindGroupLayout","entries","binding","visibility","GPUShaderStage","FRAGMENT","COMPUTE","sampleType","storageTexture","access","bindGroup","createBindGroup","layout","resource","createView","module","createShaderModule","code","renderPipeline","createRenderPipeline","createPipelineLayout","bindGroupLayouts","vertex","entryPoint","fragment","targets","writeMask","renderBundleEncoder","setPipeline","setBindGroup","draw","renderPassEncoder","computePipeline","createComputePipeline","compute","computePassEncoder","dispatchWorkgroups","Math","ceil","performWriteOp","data","beginRenderPass","colorAttachments","view","clearValue","R","G","B","A","loadOp","storeOp","currentContext","rep","texelData","pack","encode","numTexels","fullTexelData","ArrayBuffer","i","src","dst","start","queue","writeTexture","j","writeBuffer","renderTarget","RENDER_ATTACHMENT","sampleCount","resolveTarget","storedValue","map","x","toFixed","join","test","desc","params","u","combine","expand","p","boundary","contexts","expandWithParams","_context","fn","helper","readUsage","writeUsage","texelValue1","texelValue2","readbackTexture","ensureBoundary","ensureSubmit","expectSingleColor","exp","texelValue","first","second","unimplemented"],"sources":["../../../../../../src/webgpu/api/operation/memory_sync/texture/same_subresource.spec.ts"],"sourcesContent":["export const description = `\nMemory Synchronization Tests for Texture: read before write, read after write, and write after write to the same subresource.\n\n- TODO: Test synchronization between multiple queues.\n- TODO: Test depth/stencil attachments.\n- TODO: Use non-solid-color texture contents [2]\n`;\n\nimport { makeTestGroup } from '../../../../../common/framework/test_group.js';\nimport { assert, memcpy, unreachable } from '../../../../../common/util/util.js';\nimport { EncodableTextureFormat } from '../../../../format_info.js';\nimport { GPUTest, MaxLimitsTestMixin } from '../../../../gpu_test.js';\nimport { align } from '../../../../util/math.js';\nimport { getTextureCopyLayout } from '../../../../util/texture/layout.js';\nimport {\n  kTexelRepresentationInfo,\n  PerTexelComponent,\n} from '../../../../util/texture/texel_data.js';\nimport {\n  kOperationBoundaries,\n  OperationContext,\n  kBoundaryInfo,\n  OperationContextHelper,\n} from '../operation_context_helper.js';\n\nimport {\n  kAllReadOps,\n  kAllWriteOps,\n  checkOpsValidForContext,\n  Op,\n  kOpInfo,\n} from './texture_sync_test.js';\n\nexport const g = makeTestGroup(MaxLimitsTestMixin(GPUTest));\n\nconst fullscreenQuadWGSL = `\n  struct VertexOutput {\n    @builtin(position) Position : vec4<f32>\n  };\n\n  @vertex fn vert_main(@builtin(vertex_index) VertexIndex : u32) -> VertexOutput {\n    var pos = array<vec2<f32>, 6>(\n        vec2<f32>( 1.0,  1.0),\n        vec2<f32>( 1.0, -1.0),\n        vec2<f32>(-1.0, -1.0),\n        vec2<f32>( 1.0,  1.0),\n        vec2<f32>(-1.0, -1.0),\n        vec2<f32>(-1.0,  1.0));\n\n    var output : VertexOutput;\n    output.Position = vec4<f32>(pos[VertexIndex], 0.0, 1.0);\n    return output;\n  }\n`;\n\nfunction readOpNeedsStorageTexture({ op, in: context }: { op: Op; in: OperationContext }) {\n  return (\n    op === 'sample' && (context === 'render-pass-encoder' || context === 'render-bundle-encoder')\n  );\n}\n\nfunction writeOpNeedsStorageTexture({ op, in: context }: { op: Op; in: OperationContext }) {\n  return (\n    op === 'storage' && (context === 'render-pass-encoder' || context === 'render-bundle-encoder')\n  );\n}\n\nclass TextureSyncTestHelper extends OperationContextHelper {\n  private texture: GPUTexture;\n\n  public override readonly kTextureSize = [4, 4] as const;\n  public override readonly kTextureFormat: EncodableTextureFormat = 'rgba8unorm';\n\n  constructor(\n    t: GPUTest,\n    textureCreationParams: {\n      usage: GPUTextureUsageFlags;\n    }\n  ) {\n    super(t);\n    this.texture = t.createTextureTracked({\n      size: this.kTextureSize,\n      format: this.kTextureFormat,\n      ...textureCreationParams,\n    });\n  }\n\n  static skipIfNeedStorageTexturesAndNoStorageTextures(\n    t: GPUTest,\n    reads: { op: Op; in: OperationContext }[],\n    writes: { op: Op; in: OperationContext }[]\n  ) {\n    if (!t.isCompatibility) {\n      return;\n    }\n\n    if (t.device.limits.maxStorageTexturesInFragmentStage! >= 1) {\n      return;\n    }\n\n    const needStorageTexture =\n      reads.reduce((need, read) => need || readOpNeedsStorageTexture(read), false) ||\n      writes.reduce((need, write) => need || writeOpNeedsStorageTexture(write), false);\n\n    t.skipIf(\n      needStorageTexture,\n      `maxStorageTexturesInFragmentStage(${t.device.limits.maxStorageTexturesInFragmentStage}) < 1`\n    );\n  }\n\n  /**\n   * Perform a read operation on the test texture.\n   * @return GPUTexture copy containing the contents.\n   */\n  performReadOp({ op, in: context }: { op: Op; in: OperationContext }): GPUTexture {\n    this.ensureContext(context);\n    switch (op) {\n      case 't2t-copy': {\n        const texture = this.t.createTextureTracked({\n          size: this.kTextureSize,\n          format: this.kTextureFormat,\n          usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.COPY_DST,\n        });\n\n        assert(this.commandEncoder !== undefined);\n        this.commandEncoder.copyTextureToTexture(\n          {\n            texture: this.texture,\n          },\n          { texture },\n          this.kTextureSize\n        );\n        return texture;\n      }\n      case 't2b-copy': {\n        const { byteLength, bytesPerRow } = getTextureCopyLayout(this.kTextureFormat, '2d', [\n          ...this.kTextureSize,\n          1,\n        ]);\n        const buffer = this.t.createBufferTracked({\n          size: byteLength,\n          usage: GPUBufferUsage.COPY_SRC | GPUBufferUsage.COPY_DST,\n        });\n\n        const texture = this.t.createTextureTracked({\n          size: this.kTextureSize,\n          format: this.kTextureFormat,\n          usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.COPY_DST,\n        });\n\n        assert(this.commandEncoder !== undefined);\n        this.commandEncoder.copyTextureToBuffer(\n          {\n            texture: this.texture,\n          },\n          { buffer, bytesPerRow },\n          this.kTextureSize\n        );\n        this.commandEncoder.copyBufferToTexture(\n          { buffer, bytesPerRow },\n          { texture },\n          this.kTextureSize\n        );\n        return texture;\n      }\n      case 'sample': {\n        const texture = this.t.createTextureTracked({\n          size: this.kTextureSize,\n          format: this.kTextureFormat,\n          usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.STORAGE_BINDING,\n        });\n\n        const bindGroupLayout = this.device.createBindGroupLayout({\n          entries: [\n            {\n              binding: 0,\n              visibility: GPUShaderStage.FRAGMENT | GPUShaderStage.COMPUTE,\n              texture: {\n                sampleType: 'unfilterable-float',\n              },\n            },\n            {\n              binding: 1,\n              visibility: GPUShaderStage.FRAGMENT | GPUShaderStage.COMPUTE,\n              storageTexture: {\n                access: 'write-only',\n                format: this.kTextureFormat,\n              },\n            },\n          ],\n        });\n\n        const bindGroup = this.device.createBindGroup({\n          layout: bindGroupLayout,\n          entries: [\n            {\n              binding: 0,\n              resource: this.texture.createView(),\n            },\n            {\n              binding: 1,\n              resource: texture.createView(),\n            },\n          ],\n        });\n\n        switch (context) {\n          case 'render-pass-encoder':\n          case 'render-bundle-encoder': {\n            const module = this.device.createShaderModule({\n              code: `${fullscreenQuadWGSL}\n\n                @group(0) @binding(0) var inputTex: texture_2d<f32>;\n                @group(0) @binding(1) var outputTex: texture_storage_2d<rgba8unorm, write>;\n\n                @fragment fn frag_main(@builtin(position) fragCoord: vec4<f32>) -> @location(0) vec4<f32> {\n                  let coord = vec2<i32>(fragCoord.xy);\n                  textureStore(outputTex, coord, textureLoad(inputTex, coord, 0));\n                  return vec4<f32>();\n                }\n              `,\n            });\n            const renderPipeline = this.device.createRenderPipeline({\n              layout: this.device.createPipelineLayout({\n                bindGroupLayouts: [bindGroupLayout],\n              }),\n              vertex: {\n                module,\n                entryPoint: 'vert_main',\n              },\n              fragment: {\n                module,\n                entryPoint: 'frag_main',\n\n                // Unused attachment since we can't use textureStore in the vertex shader.\n                // Set writeMask to zero.\n                targets: [\n                  {\n                    format: this.kTextureFormat,\n                    writeMask: 0,\n                  },\n                ],\n              },\n            });\n\n            switch (context) {\n              case 'render-bundle-encoder':\n                assert(this.renderBundleEncoder !== undefined);\n                this.renderBundleEncoder.setPipeline(renderPipeline);\n                this.renderBundleEncoder.setBindGroup(0, bindGroup);\n                this.renderBundleEncoder.draw(6);\n                break;\n              case 'render-pass-encoder':\n                assert(this.renderPassEncoder !== undefined);\n                this.renderPassEncoder.setPipeline(renderPipeline);\n                this.renderPassEncoder.setBindGroup(0, bindGroup);\n                this.renderPassEncoder.draw(6);\n                break;\n            }\n            break;\n          }\n          case 'compute-pass-encoder': {\n            const module = this.device.createShaderModule({\n              code: `\n                @group(0) @binding(0) var inputTex: texture_2d<f32>;\n                @group(0) @binding(1) var outputTex: texture_storage_2d<rgba8unorm, write>;\n\n                @compute @workgroup_size(8, 8)\n                fn main(@builtin(global_invocation_id) gid : vec3<u32>) {\n                  if (any(gid.xy >= vec2<u32>(textureDimensions(inputTex)))) {\n                    return;\n                  }\n                  let coord = vec2<i32>(gid.xy);\n                  textureStore(outputTex, coord, textureLoad(inputTex, coord, 0));\n                }\n              `,\n            });\n            const computePipeline = this.device.createComputePipeline({\n              layout: this.device.createPipelineLayout({\n                bindGroupLayouts: [bindGroupLayout],\n              }),\n              compute: {\n                module,\n                entryPoint: 'main',\n              },\n            });\n\n            assert(this.computePassEncoder !== undefined);\n            this.computePassEncoder.setPipeline(computePipeline);\n            this.computePassEncoder.setBindGroup(0, bindGroup);\n            this.computePassEncoder.dispatchWorkgroups(\n              Math.ceil(this.kTextureSize[0] / 8),\n              Math.ceil(this.kTextureSize[1] / 8)\n            );\n            break;\n          }\n          default:\n            unreachable();\n        }\n\n        return texture;\n      }\n      case 'b2t-copy':\n      case 'attachment-resolve':\n      case 'attachment-store':\n        unreachable();\n    }\n    unreachable();\n  }\n\n  performWriteOp(\n    { op, in: context }: { op: Op; in: OperationContext },\n    data: PerTexelComponent<number>\n  ) {\n    this.ensureContext(context);\n    switch (op) {\n      case 'attachment-store': {\n        assert(this.commandEncoder !== undefined);\n        this.renderPassEncoder = this.commandEncoder.beginRenderPass({\n          colorAttachments: [\n            {\n              view: this.texture.createView(),\n              // [2] Use non-solid-color texture values\n              clearValue: [data.R ?? 0, data.G ?? 0, data.B ?? 0, data.A ?? 0],\n              loadOp: 'clear',\n              storeOp: 'store',\n            },\n          ],\n        });\n        this.currentContext = 'render-pass-encoder';\n        break;\n      }\n      case 'write-texture': {\n        // [2] Use non-solid-color texture values\n        const rep = kTexelRepresentationInfo[this.kTextureFormat];\n        const texelData = rep.pack(rep.encode(data));\n        const numTexels = this.kTextureSize[0] * this.kTextureSize[1];\n        const fullTexelData = new ArrayBuffer(texelData.byteLength * numTexels);\n        for (let i = 0; i < numTexels; ++i) {\n          memcpy({ src: texelData }, { dst: fullTexelData, start: i * texelData.byteLength });\n        }\n\n        this.queue.writeTexture(\n          { texture: this.texture },\n          fullTexelData,\n          {\n            bytesPerRow: texelData.byteLength * this.kTextureSize[0],\n          },\n          this.kTextureSize\n        );\n        break;\n      }\n      case 't2t-copy': {\n        const texture = this.t.createTextureTracked({\n          size: this.kTextureSize,\n          format: this.kTextureFormat,\n          usage: GPUTextureUsage.COPY_SRC | GPUTextureUsage.COPY_DST,\n        });\n\n        // [2] Use non-solid-color texture values\n        const rep = kTexelRepresentationInfo[this.kTextureFormat];\n        const texelData = rep.pack(rep.encode(data));\n        const numTexels = this.kTextureSize[0] * this.kTextureSize[1];\n        const fullTexelData = new ArrayBuffer(texelData.byteLength * numTexels);\n        for (let i = 0; i < numTexels; ++i) {\n          memcpy({ src: texelData }, { dst: fullTexelData, start: i * texelData.byteLength });\n        }\n\n        this.queue.writeTexture(\n          { texture },\n          fullTexelData,\n          {\n            bytesPerRow: texelData.byteLength * this.kTextureSize[0],\n          },\n          this.kTextureSize\n        );\n\n        assert(this.commandEncoder !== undefined);\n        this.commandEncoder.copyTextureToTexture(\n          { texture },\n          { texture: this.texture },\n          this.kTextureSize\n        );\n        break;\n      }\n      case 'b2t-copy': {\n        // [2] Use non-solid-color texture values\n        const rep = kTexelRepresentationInfo[this.kTextureFormat];\n        const texelData = rep.pack(rep.encode(data));\n        const bytesPerRow = align(texelData.byteLength, 256);\n        const fullTexelData = new ArrayBuffer(bytesPerRow * this.kTextureSize[1]);\n        for (let i = 0; i < this.kTextureSize[1]; ++i) {\n          for (let j = 0; j < this.kTextureSize[0]; ++j) {\n            memcpy(\n              { src: texelData },\n              {\n                dst: fullTexelData,\n                start: i * bytesPerRow + j * texelData.byteLength,\n              }\n            );\n          }\n        }\n\n        const buffer = this.t.createBufferTracked({\n          size: fullTexelData.byteLength,\n          usage: GPUBufferUsage.COPY_SRC | GPUBufferUsage.COPY_DST,\n        });\n\n        this.queue.writeBuffer(buffer, 0, fullTexelData);\n\n        assert(this.commandEncoder !== undefined);\n        this.commandEncoder.copyBufferToTexture(\n          { buffer, bytesPerRow },\n          { texture: this.texture },\n          this.kTextureSize\n        );\n        break;\n      }\n      case 'attachment-resolve': {\n        assert(this.commandEncoder !== undefined);\n        const renderTarget = this.t.createTextureTracked({\n          format: this.kTextureFormat,\n          size: this.kTextureSize,\n          usage: GPUTextureUsage.RENDER_ATTACHMENT,\n          sampleCount: 4,\n        });\n        this.renderPassEncoder = this.commandEncoder.beginRenderPass({\n          colorAttachments: [\n            {\n              view: renderTarget.createView(),\n              resolveTarget: this.texture.createView(),\n              // [2] Use non-solid-color texture values\n              clearValue: [data.R ?? 0, data.G ?? 0, data.B ?? 0, data.A ?? 0],\n              loadOp: 'clear',\n              storeOp: 'discard',\n            },\n          ],\n        });\n        this.currentContext = 'render-pass-encoder';\n        break;\n      }\n      case 'storage': {\n        const bindGroupLayout = this.device.createBindGroupLayout({\n          entries: [\n            {\n              binding: 0,\n              visibility: GPUShaderStage.FRAGMENT | GPUShaderStage.COMPUTE,\n              storageTexture: {\n                access: 'write-only',\n                format: this.kTextureFormat,\n              },\n            },\n          ],\n        });\n\n        const bindGroup = this.device.createBindGroup({\n          layout: bindGroupLayout,\n          entries: [\n            {\n              binding: 0,\n              resource: this.texture.createView(),\n            },\n          ],\n        });\n\n        // [2] Use non-solid-color texture values\n        const storedValue = `vec4<f32>(${[data.R ?? 0, data.G ?? 0, data.B ?? 0, data.A ?? 0]\n          .map(x => x.toFixed(5))\n          .join(', ')})`;\n\n        switch (context) {\n          case 'render-pass-encoder':\n          case 'render-bundle-encoder': {\n            const module = this.device.createShaderModule({\n              code: `${fullscreenQuadWGSL}\n\n                @group(0) @binding(0) var outputTex: texture_storage_2d<rgba8unorm, write>;\n\n                @fragment fn frag_main(@builtin(position) fragCoord: vec4<f32>) -> @location(0) vec4<f32> {\n                  textureStore(outputTex, vec2<i32>(fragCoord.xy), ${storedValue});\n                  return vec4<f32>();\n                }\n              `,\n            });\n            const renderPipeline = this.device.createRenderPipeline({\n              layout: this.device.createPipelineLayout({\n                bindGroupLayouts: [bindGroupLayout],\n              }),\n              vertex: {\n                module,\n                entryPoint: 'vert_main',\n              },\n              fragment: {\n                module,\n                entryPoint: 'frag_main',\n\n                // Unused attachment since we can't use textureStore in the vertex shader.\n                // Set writeMask to zero.\n                targets: [\n                  {\n                    format: this.kTextureFormat,\n                    writeMask: 0,\n                  },\n                ],\n              },\n            });\n\n            switch (context) {\n              case 'render-bundle-encoder':\n                assert(this.renderBundleEncoder !== undefined);\n                this.renderBundleEncoder.setPipeline(renderPipeline);\n                this.renderBundleEncoder.setBindGroup(0, bindGroup);\n                this.renderBundleEncoder.draw(6);\n                break;\n              case 'render-pass-encoder':\n                assert(this.renderPassEncoder !== undefined);\n                this.renderPassEncoder.setPipeline(renderPipeline);\n                this.renderPassEncoder.setBindGroup(0, bindGroup);\n                this.renderPassEncoder.draw(6);\n                break;\n            }\n            break;\n          }\n          case 'compute-pass-encoder': {\n            const module = this.device.createShaderModule({\n              code: `\n                @group(0) @binding(0) var outputTex: texture_storage_2d<rgba8unorm, write>;\n\n                @compute @workgroup_size(8, 8)\n                fn main(@builtin(global_invocation_id) gid : vec3<u32>) {\n                  if (any(gid.xy >= vec2<u32>(textureDimensions(outputTex)))) {\n                    return;\n                  }\n                  let coord = vec2<i32>(gid.xy);\n                  textureStore(outputTex, coord, ${storedValue});\n                }\n              `,\n            });\n            const computePipeline = this.device.createComputePipeline({\n              layout: this.device.createPipelineLayout({\n                bindGroupLayouts: [bindGroupLayout],\n              }),\n              compute: {\n                module,\n                entryPoint: 'main',\n              },\n            });\n\n            assert(this.computePassEncoder !== undefined);\n            this.computePassEncoder.setPipeline(computePipeline);\n            this.computePassEncoder.setBindGroup(0, bindGroup);\n            this.computePassEncoder.dispatchWorkgroups(\n              Math.ceil(this.kTextureSize[0] / 8),\n              Math.ceil(this.kTextureSize[1] / 8)\n            );\n            break;\n          }\n          default:\n            unreachable();\n        }\n        break;\n      }\n      case 't2b-copy':\n      case 'sample':\n        unreachable();\n    }\n  }\n}\n\ng.test('rw')\n  .desc(\n    `\n    Perform a 'read' operations on a texture subresource, followed by a 'write' operation.\n    Operations are separated by a 'boundary' (pass, encoder, queue-op, etc.).\n    Test that the results are synchronized.\n    The read should not see the contents written by the subsequent write.`\n  )\n  .params(u =>\n    u\n      .combine('boundary', kOperationBoundaries)\n      .expand('_context', p => kBoundaryInfo[p.boundary].contexts)\n      .expandWithParams(function* ({ _context }) {\n        for (const read of kAllReadOps) {\n          for (const write of kAllWriteOps) {\n            if (checkOpsValidForContext([read, write], _context)) {\n              yield {\n                read: { op: read, in: _context[0] },\n                write: { op: write, in: _context[1] },\n              };\n            }\n          }\n        }\n      })\n  )\n  .fn(t => {\n    TextureSyncTestHelper.skipIfNeedStorageTexturesAndNoStorageTextures(\n      t,\n      [t.params.read],\n      [t.params.write]\n    );\n    const helper = new TextureSyncTestHelper(t, {\n      usage:\n        GPUTextureUsage.COPY_DST |\n        kOpInfo[t.params.read.op].readUsage |\n        kOpInfo[t.params.write.op].writeUsage,\n    });\n    // [2] Use non-solid-color texture value.\n    const texelValue1 = { R: 0, G: 1, B: 0, A: 1 } as const;\n    const texelValue2 = { R: 1, G: 0, B: 0, A: 1 } as const;\n\n    // Initialize the texture with something.\n    helper.performWriteOp({ op: 'write-texture', in: 'queue' }, texelValue1);\n    const readbackTexture = helper.performReadOp(t.params.read);\n    helper.ensureBoundary(t.params.boundary);\n    helper.performWriteOp(t.params.write, texelValue2);\n    helper.ensureSubmit();\n\n    // Contents should be the first value written, not the second.\n    t.expectSingleColor(readbackTexture, helper.kTextureFormat, {\n      size: [...helper.kTextureSize, 1],\n      exp: texelValue1,\n    });\n  });\n\ng.test('wr')\n  .desc(\n    `\n    Perform a 'write' operation on a texture subresource, followed by a 'read' operation.\n    Operations are separated by a 'boundary' (pass, encoder, queue-op, etc.).\n    Test that the results are synchronized.\n    The read should see exactly the contents written by the previous write.\n\n    - TODO: Use non-solid-color texture contents [2]`\n  )\n  .params(u =>\n    u\n      .combine('boundary', kOperationBoundaries)\n      .expand('_context', p => kBoundaryInfo[p.boundary].contexts)\n      .expandWithParams(function* ({ _context }) {\n        for (const read of kAllReadOps) {\n          for (const write of kAllWriteOps) {\n            if (checkOpsValidForContext([write, read], _context)) {\n              yield {\n                write: { op: write, in: _context[0] },\n                read: { op: read, in: _context[1] },\n              };\n            }\n          }\n        }\n      })\n  )\n  .fn(t => {\n    TextureSyncTestHelper.skipIfNeedStorageTexturesAndNoStorageTextures(\n      t,\n      [t.params.read],\n      [t.params.write]\n    );\n    const helper = new TextureSyncTestHelper(t, {\n      usage: kOpInfo[t.params.read.op].readUsage | kOpInfo[t.params.write.op].writeUsage,\n    });\n    // [2] Use non-solid-color texture value.\n    const texelValue = { R: 0, G: 1, B: 0, A: 1 } as const;\n\n    helper.performWriteOp(t.params.write, texelValue);\n    helper.ensureBoundary(t.params.boundary);\n    const readbackTexture = helper.performReadOp(t.params.read);\n    helper.ensureSubmit();\n\n    // Contents should be exactly the values written.\n    t.expectSingleColor(readbackTexture, helper.kTextureFormat, {\n      size: [...helper.kTextureSize, 1],\n      exp: texelValue,\n    });\n  });\n\ng.test('ww')\n  .desc(\n    `\n    Perform a 'first' write operation on a texture subresource, followed by a 'second' write operation.\n    Operations are separated by a 'boundary' (pass, encoder, queue-op, etc.).\n    Test that the results are synchronized.\n    The second write should overwrite the contents of the first.`\n  )\n  .params(u =>\n    u\n      .combine('boundary', kOperationBoundaries)\n      .expand('_context', p => kBoundaryInfo[p.boundary].contexts)\n      .expandWithParams(function* ({ _context }) {\n        for (const first of kAllWriteOps) {\n          for (const second of kAllWriteOps) {\n            if (checkOpsValidForContext([first, second], _context)) {\n              yield {\n                first: { op: first, in: _context[0] },\n                second: { op: second, in: _context[1] },\n              };\n            }\n          }\n        }\n      })\n  )\n  .fn(t => {\n    TextureSyncTestHelper.skipIfNeedStorageTexturesAndNoStorageTextures(\n      t,\n      [],\n      [t.params.first, t.params.second]\n    );\n\n    const helper = new TextureSyncTestHelper(t, {\n      usage:\n        GPUTextureUsage.COPY_SRC |\n        kOpInfo[t.params.first.op].writeUsage |\n        kOpInfo[t.params.second.op].writeUsage,\n    });\n    // [2] Use non-solid-color texture value.\n    const texelValue1 = { R: 1, G: 0, B: 0, A: 1 } as const;\n    const texelValue2 = { R: 0, G: 1, B: 0, A: 1 } as const;\n\n    helper.performWriteOp(t.params.first, texelValue1);\n    helper.ensureBoundary(t.params.boundary);\n    helper.performWriteOp(t.params.second, texelValue2);\n    helper.ensureSubmit();\n\n    // Read back the contents so we can test the result.\n    const readbackTexture = helper.performReadOp({ op: 't2t-copy', in: 'command-encoder' });\n    helper.ensureSubmit();\n\n    // Contents should be the second value written.\n    t.expectSingleColor(readbackTexture, helper.kTextureFormat, {\n      size: [...helper.kTextureSize, 1],\n      exp: texelValue2,\n    });\n  });\n\ng.test('rw,single_pass,load_store')\n  .desc(\n    `\n    TODO: Test memory synchronization when loading from a texture subresource in a single pass and storing to it.`\n  )\n  .unimplemented();\n\ng.test('rw,single_pass,load_resolve')\n  .desc(\n    `\n    TODO: Test memory synchronization when loading from a texture subresource in a single pass and resolving to it.`\n  )\n  .unimplemented();\n"],"mappings":"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"}