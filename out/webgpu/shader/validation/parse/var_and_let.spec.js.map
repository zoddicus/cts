{"version":3,"file":"var_and_let.spec.js","names":["description","makeTestGroup","ShaderValidationTest","g","kTestTypes","test","desc","params","u","combine","beginSubcases","fn","t","variableOrConstant","lhsType","rhsType","code","expectation","expectCompileResult","specURL","prog","prefix","accessMode","suffix","ok"],"sources":["../../../../../src/webgpu/shader/validation/parse/var_and_let.spec.ts"],"sourcesContent":["export const description = `\nPositive and negative validation tests for variable and const.\n\nTODO: Find a better way to test arrays than using a single arbitrary size. [1]\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kTestTypes = [\n  'f32',\n  'i32',\n  'u32',\n  'bool',\n  'vec2<f32>',\n  'vec2<i32>',\n  'vec2<u32>',\n  'vec2<bool>',\n  'vec3<f32>',\n  'vec3<i32>',\n  'vec3<u32>',\n  'vec3<bool>',\n  'vec4<f32>',\n  'vec4<i32>',\n  'vec4<u32>',\n  'vec4<bool>',\n  'mat2x2<f32>',\n  'mat2x3<f32>',\n  'mat2x4<f32>',\n  'mat3x2<f32>',\n  'mat3x3<f32>',\n  'mat3x4<f32>',\n  'mat4x2<f32>',\n  'mat4x3<f32>',\n  'mat4x4<f32>',\n  // [1]: 12 is a random number here. find a solution to replace it.\n  'array<f32, 12>',\n  'array<i32, 12>',\n  'array<u32, 12>',\n  'array<bool, 12>',\n] as const;\n\ng.test('initializer_type')\n  .desc(\n    `\n  If present, the initializer's type must match the store type of the variable.\n  Testing scalars, vectors, and matrices of every dimension and type.\n  TODO: add test for: structs - arrays of vectors and matrices - arrays of different length\n`\n  )\n  .params(u =>\n    u\n      .combine('variableOrConstant', ['var', 'let'])\n      .beginSubcases()\n      .combine('lhsType', kTestTypes)\n      .combine('rhsType', kTestTypes)\n  )\n  .fn(t => {\n    const { variableOrConstant, lhsType, rhsType } = t.params;\n\n    const code = `\n      @fragment\n      fn main() {\n        ${variableOrConstant} a : ${lhsType} = ${rhsType}();\n      }\n    `;\n\n    const expectation = lhsType === rhsType;\n    t.expectCompileResult(expectation, code);\n  });\n\ng.test('var_access_mode_bad_other_template_contents')\n  .desc(\n    'A variable declaration with explicit access mode with varying other template list contents'\n  )\n  .specURL('https://gpuweb.github.io/gpuweb/wgsl/#var-decls')\n  .params(u =>\n    u\n      .combine('accessMode', ['read', 'read_write'])\n      .combine('prefix', ['storage,', '', ','])\n      .combine('suffix', [',storage', ',read', ',', ''])\n  )\n  .fn(t => {\n    const prog = `@group(0) @binding(0)\n                  var<${t.params.prefix}${t.params.accessMode}${t.params.suffix}> x: i32;`;\n    const ok = t.params.prefix === 'storage,' && t.params.suffix === '';\n    t.expectCompileResult(ok, prog);\n  });\n\ng.test('var_access_mode_bad_template_delim')\n  .desc('A variable declaration has explicit access mode with varying template list delimiters')\n  .specURL('https://gpuweb.github.io/gpuweb/wgsl/#var-decls')\n  .params(u =>\n    u\n      .combine('accessMode', ['read', 'read_write'])\n      .combine('prefix', ['', '<', '>', ','])\n      .combine('suffix', ['', '<', '>', ','])\n  )\n  .fn(t => {\n    const prog = `@group(0) @binding(0)\n                  var ${t.params.prefix}storage,${t.params.accessMode}${t.params.suffix} x: i32;`;\n    const ok = t.params.prefix === '<' && t.params.suffix === '>';\n    t.expectCompileResult(ok, prog);\n  });\n"],"mappings":"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"}