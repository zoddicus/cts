{"version":3,"file":"increment_decrement.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","g","kTests","var","wgsl","pass","vector","paren_var_paren","star_and_var","paren_star_and_var_paren","many_star_and_var","space","tab","newline","cr","space_space","plus_space_plus","minux_space_minus","no_var","no_semi","prefix","postfix_x","postfix_r","postfix_index","postfix_field","literal_i32","literal_u32","literal_abstract_int","literal_abstract_float","literal_f32","assign_to","at_global","gdecl","private","workgroup","storage_rw","storage_r","storage","uniform","texture","texture_x","texture_storage","texture_storage_x","sampler","sampler_comparison","override","global_const","workgroup_atomic","storage_atomic","subexpr","expr_paren","expr_add","expr_negate","inc_inc","inc_space_inc","inc_dec","inc_space_dec","paren_inc","paren_dec","in_block","in_for_init","in_for_cond","in_for_update","in_for_update_semi","in_continuing","let","const","builtin","enum","param","test","desc","params","u","combine","fn","t","c","direction","replace","code","expectCompileResult"],"sources":["../../../../../src/webgpu/shader/validation/parse/increment_decrement.spec.ts"],"sourcesContent":["export const description = `Validation parser tests for increment and decrement statements`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ninterface Case {\n  // Statement in a function to execute.\n  wgsl: string;\n  // True if the test should pass\n  pass: boolean;\n  // Module-scope program fragment, if any. Usually a declaration\n  gdecl?: string;\n}\n\nconst kTests = {\n  var: { wgsl: 'a++;', pass: true },\n  vector: { wgsl: 'v++;', pass: false },\n  paren_var_paren: { wgsl: '(a)++;', pass: true },\n  star_and_var: { wgsl: '*&a++;', pass: true },\n  paren_star_and_var_paren: { wgsl: '(*&a)++;', pass: true },\n  many_star_and_var: { wgsl: '*&*&*&a++;', pass: true },\n\n  space: { wgsl: 'a ++;', pass: true },\n  tab: { wgsl: 'a\\t++;', pass: true },\n  newline: { wgsl: 'a\\n++;', pass: true },\n  cr: { wgsl: 'a\\r++;', pass: true },\n  space_space: { wgsl: 'a ++ ;', pass: true },\n  plus_space_plus: { wgsl: 'a+ +;', pass: false },\n  minux_space_minus: { wgsl: 'a- -;', pass: false },\n\n  no_var: { wgsl: '++;', pass: false },\n  no_semi: { wgsl: 'a++', pass: false },\n  prefix: { wgsl: '++a;', pass: false },\n\n  postfix_x: { wgsl: 'v++.x;', pass: false },\n  postfix_r: { wgsl: 'v++.r;', pass: false },\n  postfix_index: { wgsl: 'v++[0];', pass: false },\n  postfix_field: { wgsl: 'a++.foo;', pass: false },\n\n  literal_i32: { wgsl: '12i++;', pass: false },\n  literal_u32: { wgsl: '12u++;', pass: false },\n  literal_abstract_int: { wgsl: '12++;', pass: false },\n  literal_abstract_float: { wgsl: '12.0++;', pass: false },\n  literal_f32: { wgsl: '12.0f++;', pass: false },\n\n  assign_to: { wgsl: 'a++ = 1;', pass: false },\n\n  at_global: { wgsl: '', pass: false, gdecl: 'var<private> g:i32; g++;' },\n  private: { wgsl: 'g++;', pass: true, gdecl: 'var<private> g:i32;' },\n  workgroup: { wgsl: 'g++;', pass: true, gdecl: 'var<workgroup> g:i32;' },\n  storage_rw: {\n    wgsl: 'g++;',\n    pass: true,\n    gdecl: '@group(0) @binding(0) var<storage,read_write> g: i32;',\n  },\n  storage_r: {\n    wgsl: 'g++;',\n    pass: false,\n    gdecl: '@group(0) @binding(0) var<storage,read> g: i32;',\n  },\n  storage: { wgsl: 'g++;', pass: false, gdecl: '@group(0) @binding(0) var<storage,read> g: i32;' },\n  uniform: { wgsl: 'g++;', pass: false, gdecl: '@group(0) @binding(0) var<uniform> g: i32;' },\n  texture: { wgsl: 'g++;', pass: false, gdecl: '@group(0) @binding(0) var g: texture_2d<u32>;' },\n  texture_x: {\n    wgsl: 'g.x++;',\n    pass: false,\n    gdecl: '@group(0) @binding(0) var g: texture_2d<u32>;',\n  },\n  texture_storage: {\n    wgsl: 'g++;',\n    pass: false,\n    gdecl: '@group(0) @binding(0) var g: texture_storage_2d<r32uint>;',\n  },\n  texture_storage_x: {\n    wgsl: 'g.x++;',\n    pass: false,\n    gdecl: '@group(0) @binding(0) var g: texture_storage_2d<r32uint>;',\n  },\n  sampler: { wgsl: 'g++;', pass: false, gdecl: '@group(0) @binding(0) var g: sampler;' },\n  sampler_comparison: {\n    wgsl: 'g++;',\n    pass: false,\n    gdecl: '@group(0) @binding(0) var g: sampler_comparison;',\n  },\n  override: { wgsl: 'g++;', pass: false, gdecl: 'override g:i32;' },\n  global_const: { wgsl: 'g++;', pass: false, gdecl: 'const g:i32 = 0;' },\n  workgroup_atomic: { wgsl: 'g++;', pass: false, gdecl: 'var<workgroup> g:atomic<i32>;' },\n  storage_atomic: {\n    wgsl: 'g++;',\n    pass: false,\n    gdecl: '@group(0) @binding(0) var<storage,read_write> g:atomic<u32>;',\n  },\n\n  subexpr: { wgsl: 'a = b++;', pass: false },\n  expr_paren: { wgsl: '(a++);', pass: false },\n  expr_add: { wgsl: '0 + a++;', pass: false },\n  expr_negate: { wgsl: '-a++;', pass: false },\n  inc_inc: { wgsl: 'a++++;', pass: false },\n  inc_space_inc: { wgsl: 'a++ ++;', pass: false },\n  inc_dec: { wgsl: 'a++--;', pass: false },\n  inc_space_dec: { wgsl: 'a++ --;', pass: false },\n  paren_inc: { wgsl: '(a++)++;', pass: false },\n  paren_dec: { wgsl: '(a++)--;', pass: false },\n\n  in_block: { wgsl: '{ a++; }', pass: true },\n  in_for_init: { wgsl: 'for (a++;false;) {}', pass: true },\n  in_for_cond: { wgsl: 'for (;a++;) {}', pass: false },\n  in_for_update: { wgsl: 'for (;false;a++) {}', pass: true },\n  in_for_update_semi: { wgsl: 'for (;false;a++;) {}', pass: false },\n  in_continuing: { wgsl: 'loop { continuing { a++; break if true;}}', pass: true },\n\n  let: { wgsl: 'let c = a; c++;', pass: false },\n  const: { wgsl: 'const c = 1; c++;', pass: false },\n  builtin: { wgsl: 'max++', pass: false },\n  enum: { wgsl: 'r32uint++', pass: false },\n  param: { wgsl: '', pass: false, gdecl: 'fn bump(p: i32) { p++;}' },\n};\n\ng.test('parse')\n  .desc(`Test that increment and decrement statements are parsed correctly.`)\n  .params(u => u.combine('test', keysOf(kTests)).combine('direction', ['up', 'down']))\n  .fn(t => {\n    const c = kTests[t.params.test] as Case;\n    let { wgsl, gdecl } = c;\n    gdecl = gdecl ?? '';\n    if (t.params.direction === 'down') {\n      wgsl = wgsl.replace('++', '--');\n      gdecl = gdecl.replace('++', '--');\n    }\n\n    const code = `\n${gdecl}\nfn f() {\n  var a: u32;\n  var b: u32;\n  var v: vec4u;\n  ${wgsl}\n}`;\n    t.expectCompileResult(c.pass, code);\n  });\n"],"mappings":";;GAAA,OAAO,MAAMA,WAAW,GAAI,gEAA+D,CAE3F,SAASC,aAAa,QAAQ,4CAA4C;AAC1E,SAASC,MAAM,QAAQ,wCAAwC;AAC/D,SAASC,oBAAoB,QAAQ,8BAA8B;;AAEnE,OAAO,MAAMC,CAAC,GAAGH,aAAa,CAACE,oBAAoB,CAAC;;;;;;;;;;;AAWpD,MAAME,MAAM,GAAG;EACbC,GAAG,EAAE,EAAEC,IAAI,EAAE,MAAM,EAAEC,IAAI,EAAE,IAAI,CAAC,CAAC;EACjCC,MAAM,EAAE,EAAEF,IAAI,EAAE,MAAM,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EACrCE,eAAe,EAAE,EAAEH,IAAI,EAAE,QAAQ,EAAEC,IAAI,EAAE,IAAI,CAAC,CAAC;EAC/CG,YAAY,EAAE,EAAEJ,IAAI,EAAE,QAAQ,EAAEC,IAAI,EAAE,IAAI,CAAC,CAAC;EAC5CI,wBAAwB,EAAE,EAAEL,IAAI,EAAE,UAAU,EAAEC,IAAI,EAAE,IAAI,CAAC,CAAC;EAC1DK,iBAAiB,EAAE,EAAEN,IAAI,EAAE,YAAY,EAAEC,IAAI,EAAE,IAAI,CAAC,CAAC;;EAErDM,KAAK,EAAE,EAAEP,IAAI,EAAE,OAAO,EAAEC,IAAI,EAAE,IAAI,CAAC,CAAC;EACpCO,GAAG,EAAE,EAAER,IAAI,EAAE,QAAQ,EAAEC,IAAI,EAAE,IAAI,CAAC,CAAC;EACnCQ,OAAO,EAAE,EAAET,IAAI,EAAE,QAAQ,EAAEC,IAAI,EAAE,IAAI,CAAC,CAAC;EACvCS,EAAE,EAAE,EAAEV,IAAI,EAAE,QAAQ,EAAEC,IAAI,EAAE,IAAI,CAAC,CAAC;EAClCU,WAAW,EAAE,EAAEX,IAAI,EAAE,QAAQ,EAAEC,IAAI,EAAE,IAAI,CAAC,CAAC;EAC3CW,eAAe,EAAE,EAAEZ,IAAI,EAAE,OAAO,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EAC/CY,iBAAiB,EAAE,EAAEb,IAAI,EAAE,OAAO,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;;EAEjDa,MAAM,EAAE,EAAEd,IAAI,EAAE,KAAK,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EACpCc,OAAO,EAAE,EAAEf,IAAI,EAAE,KAAK,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EACrCe,MAAM,EAAE,EAAEhB,IAAI,EAAE,MAAM,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;;EAErCgB,SAAS,EAAE,EAAEjB,IAAI,EAAE,QAAQ,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EAC1CiB,SAAS,EAAE,EAAElB,IAAI,EAAE,QAAQ,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EAC1CkB,aAAa,EAAE,EAAEnB,IAAI,EAAE,SAAS,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EAC/CmB,aAAa,EAAE,EAAEpB,IAAI,EAAE,UAAU,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;;EAEhDoB,WAAW,EAAE,EAAErB,IAAI,EAAE,QAAQ,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EAC5CqB,WAAW,EAAE,EAAEtB,IAAI,EAAE,QAAQ,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EAC5CsB,oBAAoB,EAAE,EAAEvB,IAAI,EAAE,OAAO,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EACpDuB,sBAAsB,EAAE,EAAExB,IAAI,EAAE,SAAS,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EACxDwB,WAAW,EAAE,EAAEzB,IAAI,EAAE,UAAU,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;;EAE9CyB,SAAS,EAAE,EAAE1B,IAAI,EAAE,UAAU,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;;EAE5C0B,SAAS,EAAE,EAAE3B,IAAI,EAAE,EAAE,EAAEC,IAAI,EAAE,KAAK,EAAE2B,KAAK,EAAE,0BAA0B,CAAC,CAAC;EACvEC,OAAO,EAAE,EAAE7B,IAAI,EAAE,MAAM,EAAEC,IAAI,EAAE,IAAI,EAAE2B,KAAK,EAAE,qBAAqB,CAAC,CAAC;EACnEE,SAAS,EAAE,EAAE9B,IAAI,EAAE,MAAM,EAAEC,IAAI,EAAE,IAAI,EAAE2B,KAAK,EAAE,uBAAuB,CAAC,CAAC;EACvEG,UAAU,EAAE;IACV/B,IAAI,EAAE,MAAM;IACZC,IAAI,EAAE,IAAI;IACV2B,KAAK,EAAE;EACT,CAAC;EACDI,SAAS,EAAE;IACThC,IAAI,EAAE,MAAM;IACZC,IAAI,EAAE,KAAK;IACX2B,KAAK,EAAE;EACT,CAAC;EACDK,OAAO,EAAE,EAAEjC,IAAI,EAAE,MAAM,EAAEC,IAAI,EAAE,KAAK,EAAE2B,KAAK,EAAE,iDAAiD,CAAC,CAAC;EAChGM,OAAO,EAAE,EAAElC,IAAI,EAAE,MAAM,EAAEC,IAAI,EAAE,KAAK,EAAE2B,KAAK,EAAE,4CAA4C,CAAC,CAAC;EAC3FO,OAAO,EAAE,EAAEnC,IAAI,EAAE,MAAM,EAAEC,IAAI,EAAE,KAAK,EAAE2B,KAAK,EAAE,+CAA+C,CAAC,CAAC;EAC9FQ,SAAS,EAAE;IACTpC,IAAI,EAAE,QAAQ;IACdC,IAAI,EAAE,KAAK;IACX2B,KAAK,EAAE;EACT,CAAC;EACDS,eAAe,EAAE;IACfrC,IAAI,EAAE,MAAM;IACZC,IAAI,EAAE,KAAK;IACX2B,KAAK,EAAE;EACT,CAAC;EACDU,iBAAiB,EAAE;IACjBtC,IAAI,EAAE,QAAQ;IACdC,IAAI,EAAE,KAAK;IACX2B,KAAK,EAAE;EACT,CAAC;EACDW,OAAO,EAAE,EAAEvC,IAAI,EAAE,MAAM,EAAEC,IAAI,EAAE,KAAK,EAAE2B,KAAK,EAAE,uCAAuC,CAAC,CAAC;EACtFY,kBAAkB,EAAE;IAClBxC,IAAI,EAAE,MAAM;IACZC,IAAI,EAAE,KAAK;IACX2B,KAAK,EAAE;EACT,CAAC;EACDa,QAAQ,EAAE,EAAEzC,IAAI,EAAE,MAAM,EAAEC,IAAI,EAAE,KAAK,EAAE2B,KAAK,EAAE,iBAAiB,CAAC,CAAC;EACjEc,YAAY,EAAE,EAAE1C,IAAI,EAAE,MAAM,EAAEC,IAAI,EAAE,KAAK,EAAE2B,KAAK,EAAE,kBAAkB,CAAC,CAAC;EACtEe,gBAAgB,EAAE,EAAE3C,IAAI,EAAE,MAAM,EAAEC,IAAI,EAAE,KAAK,EAAE2B,KAAK,EAAE,+BAA+B,CAAC,CAAC;EACvFgB,cAAc,EAAE;IACd5C,IAAI,EAAE,MAAM;IACZC,IAAI,EAAE,KAAK;IACX2B,KAAK,EAAE;EACT,CAAC;;EAEDiB,OAAO,EAAE,EAAE7C,IAAI,EAAE,UAAU,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EAC1C6C,UAAU,EAAE,EAAE9C,IAAI,EAAE,QAAQ,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EAC3C8C,QAAQ,EAAE,EAAE/C,IAAI,EAAE,UAAU,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EAC3C+C,WAAW,EAAE,EAAEhD,IAAI,EAAE,OAAO,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EAC3CgD,OAAO,EAAE,EAAEjD,IAAI,EAAE,QAAQ,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EACxCiD,aAAa,EAAE,EAAElD,IAAI,EAAE,SAAS,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EAC/CkD,OAAO,EAAE,EAAEnD,IAAI,EAAE,QAAQ,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EACxCmD,aAAa,EAAE,EAAEpD,IAAI,EAAE,SAAS,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EAC/CoD,SAAS,EAAE,EAAErD,IAAI,EAAE,UAAU,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EAC5CqD,SAAS,EAAE,EAAEtD,IAAI,EAAE,UAAU,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;;EAE5CsD,QAAQ,EAAE,EAAEvD,IAAI,EAAE,UAAU,EAAEC,IAAI,EAAE,IAAI,CAAC,CAAC;EAC1CuD,WAAW,EAAE,EAAExD,IAAI,EAAE,qBAAqB,EAAEC,IAAI,EAAE,IAAI,CAAC,CAAC;EACxDwD,WAAW,EAAE,EAAEzD,IAAI,EAAE,gBAAgB,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EACpDyD,aAAa,EAAE,EAAE1D,IAAI,EAAE,qBAAqB,EAAEC,IAAI,EAAE,IAAI,CAAC,CAAC;EAC1D0D,kBAAkB,EAAE,EAAE3D,IAAI,EAAE,sBAAsB,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EACjE2D,aAAa,EAAE,EAAE5D,IAAI,EAAE,2CAA2C,EAAEC,IAAI,EAAE,IAAI,CAAC,CAAC;;EAEhF4D,GAAG,EAAE,EAAE7D,IAAI,EAAE,iBAAiB,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EAC7C6D,KAAK,EAAE,EAAE9D,IAAI,EAAE,mBAAmB,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EACjD8D,OAAO,EAAE,EAAE/D,IAAI,EAAE,OAAO,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EACvC+D,IAAI,EAAE,EAAEhE,IAAI,EAAE,WAAW,EAAEC,IAAI,EAAE,KAAK,CAAC,CAAC;EACxCgE,KAAK,EAAE,EAAEjE,IAAI,EAAE,EAAE,EAAEC,IAAI,EAAE,KAAK,EAAE2B,KAAK,EAAE,yBAAyB,CAAC;AACnE,CAAC;;AAED/B,CAAC,CAACqE,IAAI,CAAC,OAAO,CAAC;AACZC,IAAI,CAAE,oEAAmE,CAAC;AAC1EC,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,OAAO,CAAC,MAAM,EAAE3E,MAAM,CAACG,MAAM,CAAC,CAAC,CAACwE,OAAO,CAAC,WAAW,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC,CAAC;AACnFC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAMC,CAAC,GAAG3E,MAAM,CAAC0E,CAAC,CAACJ,MAAM,CAACF,IAAI,CAAS;EACvC,IAAI,EAAElE,IAAI,EAAE4B,KAAK,CAAC,CAAC,GAAG6C,CAAC;EACvB7C,KAAK,GAAGA,KAAK,IAAI,EAAE;EACnB,IAAI4C,CAAC,CAACJ,MAAM,CAACM,SAAS,KAAK,MAAM,EAAE;IACjC1E,IAAI,GAAGA,IAAI,CAAC2E,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC;IAC/B/C,KAAK,GAAGA,KAAK,CAAC+C,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC;EACnC;;EAEA,MAAMC,IAAI,GAAI;AAClB,EAAEhD,KAAM;AACR;AACA;AACA;AACA;AACA,IAAI5B,IAAK;AACT,EAAE;EACEwE,CAAC,CAACK,mBAAmB,CAACJ,CAAC,CAACxE,IAAI,EAAE2E,IAAI,CAAC;AACrC,CAAC,CAAC"}