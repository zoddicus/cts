{"version":3,"file":"const.spec.js","names":["description","makeTestGroup","ShaderValidationTest","g","test","desc","params","u","combine","undefined","fn","t","scope","attr","code","expectCompileResult"],"sources":["../../../../../src/webgpu/shader/validation/parse/const.spec.ts"],"sourcesContent":["export const description = `Validation tests for @const`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('placement')\n  .desc('Tests @const is not allowed to appear')\n  .params(u =>\n    u.combine('scope', [\n      'private-var',\n      'storage-var',\n      'struct-member',\n      'fn-decl',\n      'fn-param',\n      'fn-var',\n      'fn-return',\n      'while-stmt',\n      undefined,\n    ] as const)\n  )\n  .fn(t => {\n    const scope = t.params.scope;\n\n    const attr = '@const';\n    const code = `\n      ${scope === 'private-var' ? attr : ''}\n      var<private> priv_var : i32;\n\n      ${scope === 'storage-var' ? attr : ''}\n      @group(0) @binding(0)\n      var<storage> stor_var : i32;\n\n      struct A {\n        ${scope === 'struct-member' ? attr : ''}\n        a : i32,\n      }\n\n      @vertex\n      ${scope === 'fn-decl' ? attr : ''}\n      fn f(\n        ${scope === 'fn-param' ? attr : ''}\n        @location(0) b : i32,\n      ) -> ${scope === 'fn-return' ? attr : ''} @builtin(position) vec4f {\n        ${scope === 'fn-var' ? attr : ''}\n        var<function> func_v : i32;\n\n        ${scope === 'while-stmt' ? attr : ''}\n        while false {}\n\n        return vec4(1, 1, 1, 1);\n      }\n    `;\n\n    t.expectCompileResult(scope === undefined, code);\n  });\n"],"mappings":";;GAAA,OAAO,MAAMA,WAAW,GAAI,6BAA4B,CAExD,SAASC,aAAa,QAAQ,4CAA4C;AAC1E,SAASC,oBAAoB,QAAQ,8BAA8B;;AAEnE,OAAO,MAAMC,CAAC,GAAGF,aAAa,CAACC,oBAAoB,CAAC;;AAEpDC,CAAC,CAACC,IAAI,CAAC,WAAW,CAAC;AAChBC,IAAI,CAAC,uCAAuC,CAAC;AAC7CC,MAAM,CAAC,CAAAC,CAAC;AACPA,CAAC,CAACC,OAAO,CAAC,OAAO,EAAE;AACjB,aAAa;AACb,aAAa;AACb,eAAe;AACf,SAAS;AACT,UAAU;AACV,QAAQ;AACR,WAAW;AACX,YAAY;AACZC,SAAS;AACD;AACZ,CAAC;AACAC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAMC,KAAK,GAAGD,CAAC,CAACL,MAAM,CAACM,KAAK;;EAE5B,MAAMC,IAAI,GAAG,QAAQ;EACrB,MAAMC,IAAI,GAAI;AAClB,QAAQF,KAAK,KAAK,aAAa,GAAGC,IAAI,GAAG,EAAG;AAC5C;AACA;AACA,QAAQD,KAAK,KAAK,aAAa,GAAGC,IAAI,GAAG,EAAG;AAC5C;AACA;AACA;AACA;AACA,UAAUD,KAAK,KAAK,eAAe,GAAGC,IAAI,GAAG,EAAG;AAChD;AACA;AACA;AACA;AACA,QAAQD,KAAK,KAAK,SAAS,GAAGC,IAAI,GAAG,EAAG;AACxC;AACA,UAAUD,KAAK,KAAK,UAAU,GAAGC,IAAI,GAAG,EAAG;AAC3C;AACA,aAAaD,KAAK,KAAK,WAAW,GAAGC,IAAI,GAAG,EAAG;AAC/C,UAAUD,KAAK,KAAK,QAAQ,GAAGC,IAAI,GAAG,EAAG;AACzC;AACA;AACA,UAAUD,KAAK,KAAK,YAAY,GAAGC,IAAI,GAAG,EAAG;AAC7C;AACA;AACA;AACA;AACA,KAAK;;EAEDF,CAAC,CAACI,mBAAmB,CAACH,KAAK,KAAKH,SAAS,EAAEK,IAAI,CAAC;AAClD,CAAC,CAAC"}