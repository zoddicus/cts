{"version":3,"file":"blankspace.spec.js","names":["description","makeTestGroup","ShaderValidationTest","g","test","desc","params","u","combine","beginSubcases","fn","t","code","placement","contains_null","expectCompileResult","blankspace","include_bom"],"sources":["../../../../../src/webgpu/shader/validation/parse/blankspace.spec.ts"],"sourcesContent":["export const description = `Validation tests for blankspace handling`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('null_characters')\n  .desc(`Test that WGSL source containing a null character is rejected.`)\n  .params(u =>\n    u\n      .combine('contains_null', [true, false])\n      .combine('placement', ['comment', 'delimiter', 'eol'])\n      .beginSubcases()\n  )\n  .fn(t => {\n    let code = '';\n    if (t.params.placement === 'comment') {\n      code = `// Here is a ${t.params.contains_null ? '\\0' : 'Z'} character`;\n    } else if (t.params.placement === 'delimiter') {\n      code = `const${t.params.contains_null ? '\\0' : ' '}name : i32 = 0;`;\n    } else if (t.params.placement === 'eol') {\n      code = `const name : i32 = 0;${t.params.contains_null ? '\\0' : ''}`;\n    }\n    t.expectCompileResult(!t.params.contains_null, code);\n  });\n\ng.test('blankspace')\n  .desc(`Test that all blankspace characters act as delimiters.`)\n  .params(u =>\n    u\n      .combine('blankspace', [\n        ['\\u0020', 'space'],\n        ['\\u0009', 'horizontal_tab'],\n        ['\\u000a', 'line_feed'],\n        ['\\u000b', 'vertical_tab'],\n        ['\\u000c', 'form_feed'],\n        ['\\u000d', 'carriage_return'],\n        ['\\u0085', 'next_line'],\n        ['\\u200e', 'left_to_right_mark'],\n        ['\\u200f', 'right_to_left_mark'],\n        ['\\u2028', 'line_separator'],\n        ['\\u2029', 'paragraph_separator'],\n      ])\n      .beginSubcases()\n  )\n  .fn(t => {\n    const code = `const${t.params.blankspace[0]}ident : i32 = 0;`;\n    t.expectCompileResult(true, code);\n  });\n\ng.test('bom')\n  .desc(\n    `Tests that including a BOM causes a shader compile error.\n\nNote, per RFC 2632, for protocols which forbit the use of U+FEFF then the BOM is treated as a\n\"ZERO WIDTH NO-BREAK SPACE\". The \"ZERO WIDTH NO-BREAK SPACE\" is not a valid WGSL blankspace code\npoint, so the BOM ends up as a shader compilation error.\n    `\n  )\n  .params(u => u.combine('include_bom', [true, false]))\n  .fn(t => {\n    const code = `${t.params.include_bom ? '\\uFEFF' : ''}const name : i32 = 0;`;\n    t.expectCompileResult(!t.params.include_bom, code);\n  });\n"],"mappings":"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"}