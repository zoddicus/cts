{"version":3,"file":"break_if.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","g","kTests","compound_break","src","pass","loop_break","loop_if_break","continuing_break_if","continuing_break_if_parens","continuing_break_if_not_last","while_break","while_if_break","for_break","for_if_break","switch_case_break","switch_case_if_break","break","return_break","if_break","continuing_if_break","switch_break","test","desc","params","u","combine","fn","t","code","stmt","expectCompileResult","vec_types","map","i","j","reduce","a","c","concat","f32_matrix_types","f16_matrix_types","beforeAllSubcases","type","includes","selectDeviceOrSkipTestCase"],"sources":["../../../../../src/webgpu/shader/validation/parse/break_if.spec.ts"],"sourcesContent":["export const description = `Validation tests for break if`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kTests = {\n  compound_break: {\n    src: '{ break if true; }',\n    pass: false,\n  },\n  loop_break: {\n    src: 'loop { break if true; }',\n    pass: false,\n  },\n  loop_if_break: {\n    src: 'loop { if true { break if false; } }',\n    pass: false,\n  },\n  continuing_break_if: {\n    src: 'loop { continuing { break if true; } }',\n    pass: true,\n  },\n  continuing_break_if_parens: {\n    src: 'loop { continuing { break if (true); } }',\n    pass: true,\n  },\n  continuing_break_if_not_last: {\n    src: 'loop { continuing { break if (true); let a = 4;} }',\n    pass: false,\n  },\n  while_break: {\n    src: 'while true { break if true; }',\n    pass: false,\n  },\n  while_if_break: {\n    src: 'while true { if true { break if true; } }',\n    pass: false,\n  },\n  for_break: {\n    src: 'for (;;) { break if true; }',\n    pass: false,\n  },\n  for_if_break: {\n    src: 'for (;;) { if true { break if true; } }',\n    pass: false,\n  },\n  switch_case_break: {\n    src: 'switch(1) { default: { break if true; } }',\n    pass: false,\n  },\n  switch_case_if_break: {\n    src: 'switch(1) { default: { if true { break if true; } } }',\n    pass: false,\n  },\n  break: {\n    src: 'break if true;',\n    pass: false,\n  },\n  return_break: {\n    src: 'return break if true;',\n    pass: false,\n  },\n  if_break: {\n    src: 'if true { break if true; }',\n    pass: false,\n  },\n  continuing_if_break: {\n    src: 'loop { continuing { if (true) { break if true; } } }',\n    pass: false,\n  },\n  switch_break: {\n    src: 'switch(1) { break if true; }',\n    pass: false,\n  },\n};\n\ng.test('placement')\n  .desc('Test that break if placement is validated correctly')\n  .params(u => u.combine('stmt', keysOf(kTests)))\n  .fn(t => {\n    const code = `\n@vertex\nfn vtx() -> @builtin(position) vec4f {\n  ${kTests[t.params.stmt].src}\n  return vec4f(1);\n}\n    `;\n    t.expectCompileResult(kTests[t.params.stmt].pass, code);\n  });\n\nconst vec_types = [2, 3, 4]\n  .map(i => ['i32', 'u32', 'f32', 'f16'].map(j => `vec${i}<${j}>`))\n  .reduce((a, c) => a.concat(c), []);\nconst f32_matrix_types = [2, 3, 4]\n  .map(i => [2, 3, 4].map(j => `mat${i}x${j}f`))\n  .reduce((a, c) => a.concat(c), []);\nconst f16_matrix_types = [2, 3, 4]\n  .map(i => [2, 3, 4].map(j => `mat${i}x${j}<f16>`))\n  .reduce((a, c) => a.concat(c), []);\n\ng.test('non_bool_param')\n  .desc('Test that break if fails with a non-bool parameter')\n  .params(u =>\n    u.combine('type', [\n      'f32',\n      'f16',\n      'i32',\n      'u32',\n      'S',\n      ...vec_types,\n      ...f32_matrix_types,\n      ...f16_matrix_types,\n    ])\n  )\n  .beforeAllSubcases(t => {\n    if (t.params.type.includes('f16')) {\n      t.selectDeviceOrSkipTestCase('shader-f16');\n    }\n  })\n  .fn(t => {\n    const code = `\nstruct S {\n  a: i32,\n}\n\n@vertex\nfn vtx() -> @builtin(position) vec4f {\n  var v: ${t.params.type};\n\n  loop {\n    continuing {\n      break if v;\n    }\n  }\n  return vec4f(1);\n}`;\n    t.expectCompileResult(t.params.type === 'bool', code);\n  });\n"],"mappings":"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"}