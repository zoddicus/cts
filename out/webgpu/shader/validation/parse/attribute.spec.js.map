{"version":3,"file":"attribute.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","g","kPossibleValues","val","expr","override","user_func","const_func","const","kAttributeUsage","align","binding","group","id","location","size","workgroup_size","kAllowedUsages","test","desc","params","u","combine","fn","t","attributes","value","attribute","replace","code","pass","includes","expectCompileResult"],"sources":["../../../../../src/webgpu/shader/validation/parse/attribute.spec.ts"],"sourcesContent":["export const description = `Validation tests for attributes`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kPossibleValues = {\n  val: '32',\n  expr: '30 + 2',\n  override: 'a_override',\n  user_func: 'a_func()',\n  const_func: 'min(4, 8)',\n  const: 'a_const',\n};\nconst kAttributeUsage = {\n  align: '@align($val)',\n  binding: '@binding($val) @group(0)',\n  group: '@binding(1) @group($val)',\n  id: '@id($val)',\n  location: '@location($val)',\n  size: '@size($val)',\n  workgroup_size: '@workgroup_size($val, $val, $val)',\n};\nconst kAllowedUsages = {\n  align: ['val', 'expr', 'const', 'const_func'],\n  binding: ['val', 'expr', 'const', 'const_func'],\n  group: ['val', 'expr', 'const', 'const_func'],\n  id: ['val', 'expr', 'const', 'const_func'],\n  location: ['val', 'expr', 'const', 'const_func'],\n  size: ['val', 'expr', 'const', 'const_func'],\n  workgroup_size: ['val', 'expr', 'const', 'const_func', 'override'],\n};\n\ng.test('expressions')\n  .desc(`Tests attributes which allow expressions`)\n  .params(u =>\n    u.combine('value', keysOf(kPossibleValues)).combine('attribute', keysOf(kAllowedUsages))\n  )\n  .fn(t => {\n    const attributes = {\n      align: '',\n      binding: '@binding(0) @group(0)',\n      group: '@binding(1) @group(1)',\n      id: '@id(2)',\n      location: '@location(0)',\n      size: '',\n      workgroup_size: '@workgroup_size(1)',\n    };\n\n    const val = kPossibleValues[t.params.value];\n    attributes[t.params.attribute] = kAttributeUsage[t.params.attribute].replace(/(\\$val)/g, val);\n\n    const code = `\nfn a_func() -> i32 {\n    return 4;\n}\n\nconst a_const = -2 + 10;\noverride a_override: i32 = 2;\n\n${attributes.id} override my_id: i32 = 4;\n\nstruct B {\n  ${attributes.align} ${attributes.size} a: i32,\n}\n\n${attributes.binding}\nvar<uniform> uniform_buffer_1: B;\n\n${attributes.group}\nvar<uniform> uniform_buffer_2: B;\n\n@fragment\nfn main() -> ${attributes.location} vec4<f32> {\n  return vec4<f32>(.4, .2, .3, .1);\n}\n\n@compute\n${attributes.workgroup_size}\nfn compute_main() {}\n`;\n\n    const pass = kAllowedUsages[t.params.attribute].includes(t.params.value);\n    t.expectCompileResult(pass, code);\n  });\n"],"mappings":"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"}