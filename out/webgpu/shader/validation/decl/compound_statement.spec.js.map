{"version":3,"file":"compound_statement.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","g","kConflictTests","a","src","pass","bc","d","e","test","desc","params","u","combine","fn","t","wgsl","case","expectCompileResult","kUseTests","b","self","c_yes","c_no","d_yes","d_no"],"sources":["../../../../../src/webgpu/shader/validation/decl/compound_statement.spec.ts"],"sourcesContent":["export const description = `\nValidation tests for declarations in compound statements.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\n// 9.1 Compound Statements\n//    When a declaration is one of those statements, its identifier is in scope from\n//    the start of the next statement until the end of the compound statement.\n//\n// Enumerating cases: Consider a declaration X inside a compound statement.\n// The X declaration should be tested with potential uses and potentially\n// conflicting declarations in positions [a, b, c, d, e], in the following:\n//     a { b; X; c; { d; } } e;\n\nconst kConflictTests = {\n  a: {\n    src: 'let x = 1; { let x = 1; }',\n    pass: true,\n  },\n  bc: {\n    src: '{let x = 1; let x = 1; }',\n    pass: false,\n  },\n  d: {\n    src: '{let x = 1; { let x = 1; }}',\n    pass: true,\n  },\n  e: {\n    src: '{let x = 1; } let x = 1;',\n    pass: true,\n  },\n};\n\ng.test('decl_conflict')\n  .desc(\n    'Test a potentially conflicting declaration relative to a declaration in a compound statement'\n  )\n  .params(u => u.combine('case', keysOf(kConflictTests)))\n  .fn(t => {\n    const wgsl = `\n@vertex fn vtx() -> @builtin(position) vec4f {\n  ${kConflictTests[t.params.case].src}\n  return vec4f(1);\n}`;\n    t.expectCompileResult(kConflictTests[t.params.case].pass, wgsl);\n  });\n\nconst kUseTests = {\n  a: {\n    src: 'let y = x; { let x = 1; }',\n    pass: false, // not visible\n  },\n  b: {\n    src: '{ let y = x; let x = 1; }',\n    pass: false, // not visible\n  },\n  self: {\n    src: '{ let x = (x);}',\n    pass: false, // not visible\n  },\n  c_yes: {\n    src: '{ const x = 1; const_assert x == 1; }',\n    pass: true,\n  },\n  c_no: {\n    src: '{ const x = 1; const_assert x == 2; }',\n    pass: false,\n  },\n  d_yes: {\n    src: '{ const x = 1; { const_assert x == 1; }}',\n    pass: true,\n  },\n  d_no: {\n    src: '{ const x = 1; { const_assert x == 2; }}',\n    pass: false,\n  },\n  e: {\n    src: '{ const x = 1; } let y = x;',\n    pass: false, // not visible\n  },\n};\n\ng.test('decl_use')\n  .desc('Test a use of a declaration in a compound statement')\n  .params(u => u.combine('case', keysOf(kUseTests)))\n  .fn(t => {\n    const wgsl = `\n@vertex fn vtx() -> @builtin(position) vec4f {\n  ${kUseTests[t.params.case].src}\n  return vec4f(1);\n}`;\n    t.expectCompileResult(kUseTests[t.params.case].pass, wgsl);\n  });\n"],"mappings":";;GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA,CAAC,CAED,SAASC,aAAa,QAAQ,4CAA4C;AAC1E,SAASC,MAAM,QAAQ,wCAAwC;AAC/D,SAASC,oBAAoB,QAAQ,8BAA8B;;AAEnE,OAAO,MAAMC,CAAC,GAAGH,aAAa,CAACE,oBAAoB,CAAC;;AAEpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAME,cAAc,GAAG;EACrBC,CAAC,EAAE;IACDC,GAAG,EAAE,2BAA2B;IAChCC,IAAI,EAAE;EACR,CAAC;EACDC,EAAE,EAAE;IACFF,GAAG,EAAE,0BAA0B;IAC/BC,IAAI,EAAE;EACR,CAAC;EACDE,CAAC,EAAE;IACDH,GAAG,EAAE,6BAA6B;IAClCC,IAAI,EAAE;EACR,CAAC;EACDG,CAAC,EAAE;IACDJ,GAAG,EAAE,0BAA0B;IAC/BC,IAAI,EAAE;EACR;AACF,CAAC;;AAEDJ,CAAC,CAACQ,IAAI,CAAC,eAAe,CAAC;AACpBC,IAAI;EACH;AACF,CAAC;AACAC,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,OAAO,CAAC,MAAM,EAAEd,MAAM,CAACG,cAAc,CAAC,CAAC,CAAC;AACtDY,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAMC,IAAI,GAAI;AAClB;AACA,IAAId,cAAc,CAACa,CAAC,CAACJ,MAAM,CAACM,IAAI,CAAC,CAACb,GAAI;AACtC;AACA,EAAE;EACEW,CAAC,CAACG,mBAAmB,CAAChB,cAAc,CAACa,CAAC,CAACJ,MAAM,CAACM,IAAI,CAAC,CAACZ,IAAI,EAAEW,IAAI,CAAC;AACjE,CAAC,CAAC;;AAEJ,MAAMG,SAAS,GAAG;EAChBhB,CAAC,EAAE;IACDC,GAAG,EAAE,2BAA2B;IAChCC,IAAI,EAAE,KAAK,CAAE;EACf,CAAC;EACDe,CAAC,EAAE;IACDhB,GAAG,EAAE,2BAA2B;IAChCC,IAAI,EAAE,KAAK,CAAE;EACf,CAAC;EACDgB,IAAI,EAAE;IACJjB,GAAG,EAAE,iBAAiB;IACtBC,IAAI,EAAE,KAAK,CAAE;EACf,CAAC;EACDiB,KAAK,EAAE;IACLlB,GAAG,EAAE,uCAAuC;IAC5CC,IAAI,EAAE;EACR,CAAC;EACDkB,IAAI,EAAE;IACJnB,GAAG,EAAE,uCAAuC;IAC5CC,IAAI,EAAE;EACR,CAAC;EACDmB,KAAK,EAAE;IACLpB,GAAG,EAAE,0CAA0C;IAC/CC,IAAI,EAAE;EACR,CAAC;EACDoB,IAAI,EAAE;IACJrB,GAAG,EAAE,0CAA0C;IAC/CC,IAAI,EAAE;EACR,CAAC;EACDG,CAAC,EAAE;IACDJ,GAAG,EAAE,6BAA6B;IAClCC,IAAI,EAAE,KAAK,CAAE;EACf;AACF,CAAC;;AAEDJ,CAAC,CAACQ,IAAI,CAAC,UAAU,CAAC;AACfC,IAAI,CAAC,qDAAqD,CAAC;AAC3DC,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,OAAO,CAAC,MAAM,EAAEd,MAAM,CAACoB,SAAS,CAAC,CAAC,CAAC;AACjDL,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAMC,IAAI,GAAI;AAClB;AACA,IAAIG,SAAS,CAACJ,CAAC,CAACJ,MAAM,CAACM,IAAI,CAAC,CAACb,GAAI;AACjC;AACA,EAAE;EACEW,CAAC,CAACG,mBAAmB,CAACC,SAAS,CAACJ,CAAC,CAACJ,MAAM,CAACM,IAAI,CAAC,CAACZ,IAAI,EAAEW,IAAI,CAAC;AAC5D,CAAC,CAAC"}