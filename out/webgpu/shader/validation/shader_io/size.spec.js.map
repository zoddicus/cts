{"version":3,"file":"size.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","g","kSizeTests","valid","src","pass","non_align_size","i32","u32","constant","trailing_comma","hex","whitespace","comment","large","misspelling","no_value","missing_left_paren","missing_right_paren","missing_parens","multiple_values","override","zero","negative","f32_literal","f32","duplicate","too_small","test","desc","params","u","combine","fn","t","code","attr","expectCompileResult","beforeAllSubcases","selectDeviceOrSkipTestCase","ext","kNonStructTests","control","mod_src","func_src","size","struct","vec","mat","array","scalar","data"],"sources":["../../../../../src/webgpu/shader/validation/shader_io/size.spec.ts"],"sourcesContent":["export const description = `Validation tests for size`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kSizeTests = {\n  valid: {\n    src: `@size(4)`,\n    pass: true,\n  },\n  non_align_size: {\n    src: `@size(5)`,\n    pass: true,\n  },\n  i32: {\n    src: `@size(4i)`,\n    pass: true,\n  },\n  u32: {\n    src: `@size(4u)`,\n    pass: true,\n  },\n  constant: {\n    src: `@size(z)`,\n    pass: true,\n  },\n  trailing_comma: {\n    src: `@size(4,)`,\n    pass: true,\n  },\n  hex: {\n    src: `@size(0x4)`,\n    pass: true,\n  },\n  whitespace: {\n    src: '@\\nsize(4)',\n    pass: true,\n  },\n  comment: {\n    src: `@/* comment */size(4)`,\n    pass: true,\n  },\n  large: {\n    src: `@size(2147483647)`,\n    pass: true,\n  },\n\n  misspelling: {\n    src: `@msize(4)`,\n    pass: false,\n  },\n  no_value: {\n    src: `@size()`,\n    pass: false,\n  },\n  missing_left_paren: {\n    src: `@size 4)`,\n    pass: false,\n  },\n  missing_right_paren: {\n    src: `@size(4`,\n    pass: false,\n  },\n  missing_parens: {\n    src: `@size`,\n    pass: false,\n  },\n  multiple_values: {\n    src: `@size(4, 8)`,\n    pass: false,\n  },\n  override: {\n    src: `@size(over)`,\n    pass: false,\n  },\n  zero: {\n    src: `@size(0)`,\n    pass: false,\n  },\n  negative: {\n    src: `@size(-4)`,\n    pass: false,\n  },\n  f32_literal: {\n    src: `@size(4.0)`,\n    pass: false,\n  },\n  f32: {\n    src: `@size(4f)`,\n    pass: false,\n  },\n  duplicate: {\n    src: `@size(4) @size(8)`,\n    pass: false,\n  },\n  too_small: {\n    src: `@size(1)`,\n    pass: false,\n  },\n};\n\ng.test('size')\n  .desc(`Test validation of ize`)\n  .params(u => u.combine('attr', keysOf(kSizeTests)))\n  .fn(t => {\n    const code = `\noverride over: i32 = 4;\nconst z: i32 = 4;\n\nstruct S {\n  ${kSizeTests[t.params.attr].src} a: f32,\n};\n@group(0) @binding(0)\nvar<storage> a: S;\n\n@workgroup_size(1)\n@compute fn main() {\n  _ = a;\n}`;\n    t.expectCompileResult(kSizeTests[t.params.attr].pass, code);\n  });\n\ng.test('size_fp16')\n  .desc(`Test validation of size with fp16`)\n  .params(u => u.combine('ext', ['', 'h']))\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  })\n  .fn(t => {\n    const code = `\nstruct S {\n  @size(4${t.params.ext}) a: f32,\n}\n@group(0) @binding(0)\nvar<storage> a: S;\n\n@workgroup_size(1)\n@compute fn main() {\n  _ = a;\n}`;\n    t.expectCompileResult(t.params.ext === '', code);\n  });\n\nconst kNonStructTests = {\n  control: {\n    mod_src: ``,\n    func_src: ``,\n    size: 0,\n    pass: true,\n  },\n  struct: {\n    mod_src: `struct S { a: f32 }`,\n    func_src: ``,\n    size: 4,\n    pass: false,\n  },\n  constant: {\n    mod_src: `const a: f32 = 4.0;`,\n    func_src: ``,\n    size: 4,\n    pass: false,\n  },\n  vec: {\n    mod_src: ``,\n    func_src: `vec4<f32>`,\n    size: 16,\n    pass: false,\n  },\n  mat: {\n    mod_src: ``,\n    func_src: `mat4x4<f32>`,\n    size: 64,\n    pass: false,\n  },\n  array: {\n    mod_src: ``,\n    func_src: `array<f32, 4>`,\n    size: 16,\n    pass: false,\n  },\n  scalar: {\n    mod_src: ``,\n    func_src: `f32`,\n    size: 4,\n    pass: false,\n  },\n};\n\ng.test('size_non_struct')\n  .desc(`Test validation of size outside of a struct`)\n  .params(u => u.combine('attr', keysOf(kNonStructTests)))\n  .fn(t => {\n    const data = kNonStructTests[t.params.attr];\n    let code = '';\n    if (data.mod_src !== '') {\n      code += `@size(${data.size}) ${data.mod_src}`;\n    }\n\n    code += `\n@workgroup_size(1)\n@compute fn main() {\n`;\n    if (data.func_src !== '') {\n      code += `@size(${data.size}) var a: ${data.func_src};`;\n    }\n    code += '}';\n\n    t.expectCompileResult(data.pass, code);\n  });\n"],"mappings":"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"}