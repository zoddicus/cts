{"version":3,"file":"group_and_binding.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","g","test","desc","fn","t","code","expectCompileResult","kRequiredSettingTests","storage","space","kind","pass","uniform","handle_tex","handle_sampler","none","params","u","combine","data","attr","group"],"sources":["../../../../../src/webgpu/shader/validation/shader_io/group_and_binding.spec.ts"],"sourcesContent":["export const description = `Validation tests for group and binding`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('storage')\n  .desc(`Test validation of group and binding on storage resources`)\n  .fn(t => {\n    const code = `\n@group(1) @binding(1)\nvar<storage> a: i32;\n\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  _ = a;\n}`;\n    t.expectCompileResult(true, code);\n  });\n\ng.test('uniform')\n  .desc(`Test validation of group and binding on uniform resources`)\n  .fn(t => {\n    const code = `\n@group(1) @binding(1)\nvar<uniform> a: i32;\n\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  _ = a;\n}`;\n    t.expectCompileResult(true, code);\n  });\n\ng.test('texture')\n  .desc(`Test validation of group and binding on texture resources`)\n  .fn(t => {\n    const code = `\n@group(1) @binding(1)\nvar a: texture_2d<f32>;\n\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  _ = a;\n}`;\n    t.expectCompileResult(true, code);\n  });\n\ng.test('sampler')\n  .desc(`Test validation of group and binding on sampler resources`)\n  .fn(t => {\n    const code = `\n@group(1) @binding(1)\nvar a: sampler;\n\n@group(0) @binding(2)\nvar b: sampler_comparison;\n\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  _ = a;\n  _ = b;\n}`;\n    t.expectCompileResult(true, code);\n  });\n\nconst kRequiredSettingTests = {\n  storage: {\n    space: '<storage>',\n    kind: 'i32',\n    pass: false,\n  },\n  uniform: {\n    space: '<uniform>',\n    kind: 'i32',\n    pass: false,\n  },\n  handle_tex: {\n    space: '',\n    kind: 'texture_2d<f32>',\n    pass: false,\n  },\n  handle_sampler: {\n    space: '',\n    kind: 'sampler',\n    pass: false,\n  },\n  none: {\n    space: '<private>',\n    kind: 'i32',\n    pass: true,\n  },\n};\n\ng.test('required_group_and_binding')\n  .desc(`Test validation of group and binding missing on required address spaces`)\n  .params(u => u.combine('attr', keysOf(kRequiredSettingTests)))\n  .fn(t => {\n    const data = kRequiredSettingTests[t.params.attr];\n\n    const code = `\nvar${data.space} a: ${data.kind};\n\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  _ = a;\n}`;\n    t.expectCompileResult(data.pass, code);\n  });\n\ng.test('private_module_scope')\n  .desc(`Test validation of group and binding on private resources`)\n  .fn(t => {\n    const code = `\n@group(1) @binding(1)\nvar<private> a: i32;\n\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  _ = a;\n}`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('private_function_scope')\n  .desc(`Test validation of group and binding on function-scope private resources`)\n  .fn(t => {\n    const code = `\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  @group(1) @binding(1)\n  var<private> a: i32;\n}`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('function_scope')\n  .desc(`Test validation of group and binding on function-scope private resources`)\n  .fn(t => {\n    const code = `\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  @group(1) @binding(1)\n  var a: i32;\n}`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('function_scope_texture')\n  .desc(`Test validation of group and binding on function-scope private resources`)\n  .fn(t => {\n    const code = `\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  @group(1) @binding(1)\n  var a: texture_2d<f32>;\n}`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('duplicate_group_binding_same_entry_point')\n  .desc(\n    `Test validation of group and binding when same values set on a var used in the same entry point`\n  )\n  .params(u => u.combine('group', [1, 2]))\n  .fn(t => {\n    const code = `\n@group(${t.params.group}) @binding(1) var a: texture_2d<f32>;\n@group(1) @binding(1) var<storage> b: i32;\n\n@workgroup_size(1, 1, 1)\n@compute fn main() {\n  _ = a;\n  _ = b;\n}`;\n    t.expectCompileResult(`${t.params.group}` === '2', code);\n  });\n\ng.test('duplicate_group_binding_different_entry_point')\n  .desc(\n    `Test validation of group and binding when same values set on a var used in different entry points`\n  )\n  .fn(t => {\n    const code = `\n@group(1) @binding(1) var a: texture_2d<f32>;\n@group(1) @binding(1) var b: sampler;\n\n@workgroup_size(1, 1, 1)\n@compute fn main_a() {\n  _ = a;\n}\n\n@workgroup_size(1, 1, 1)\n@compute fn main_b() {\n  _ = b;\n}`;\n    t.expectCompileResult(true, code);\n  });\n"],"mappings":"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"}