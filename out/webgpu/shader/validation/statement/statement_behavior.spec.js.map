{"version":3,"file":"statement_behavior.spec.js","names":["description","makeTestGroup","keysOf","ShaderValidationTest","g","kInvalidStatements","break","break_if","continue","loop1","loop2","loop3","loop4","loop5","loop6","loop7","loop8","for1","for2","for3","for4","for5","for6","switch1","sequence1","compound1","test","desc","specURL","params","u","combine","fn","t","body","code","expectCompileResult","kValidStatements","empty","const_assert","let","var1","var2","assign","phony_assign","compound_assign","return","discard","function_call1","function_call2","if1","if2","break1","break2","continue1","while1","while2","while3","swtich2","switch3","switch4","sequence2","sequence3","compound2","kInvalidFunctions","next_for_type","next_return_for_type","func","function","kValidFunctions","next_return","no_final_return"],"sources":["../../../../../src/webgpu/shader/validation/statement/statement_behavior.spec.ts"],"sourcesContent":["export const description = `\nTest statement behavior analysis.\n\nFunctions must have a behavior of {Return}, {Next}, or {Return, Next}.\nFunctions with a return type must have a behavior of {Return}.\n\nEach statement in the function must be valid according to the table.\n`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kInvalidStatements = {\n  break: `break`,\n  break_if: `break if true`,\n  continue: `continue`,\n  loop1: `loop { }`,\n  loop2: `loop { continuing { } }`,\n  loop3: `loop { continue; continuing { } }`,\n  loop4: `loop { continuing { break; } }`,\n  loop5: `loop { continuing { continue; } }`,\n  loop6: `loop { continuing { return; } }`,\n  loop7: `loop { continue; break; }`,\n  loop8: `loop { continuing { break if true; return; } }`,\n  for1: `for (;;) { }`,\n  for2: `for (var i = 0; ; i++) { }`,\n  for3: `for (;; break) { }`,\n  for4: `for (;; continue ) { }`,\n  for5: `for (;; return ) { }`,\n  for6: `for (;;) { continue; break; }`,\n  // while loops always have break in their behaviors.\n  switch1: `switch (1) { case 1 { } }`,\n  sequence1: `return; loop { }`,\n  compound1: `{ loop { } }`,\n};\n\ng.test('invalid_statements')\n  .desc('Test statements with invalid behaviors')\n  .specURL('https://gpuweb.github.io/gpuweb/wgsl/#behaviors-rules')\n  .params(u => u.combine('body', keysOf(kInvalidStatements)))\n  .fn(t => {\n    const body = kInvalidStatements[t.params.body];\n    const code = `fn foo() {\n      ${body};\n    }`;\n    t.expectCompileResult(false, code);\n  });\n\nconst kValidStatements = {\n  empty: ``,\n  const_assert: `const_assert true`,\n  let: `let x = 1`,\n  var1: `var x = 1`,\n  var2: `var x : i32`,\n  assign: `v = 1`,\n  phony_assign: `_ = 1`,\n  compound_assign: `v += 1`,\n  return: `return`,\n  discard: `discard`,\n  function_call1: `bar()`,\n  function_call2: `workgroupBarrier()`,\n\n  if1: `if true { } else { }`,\n  if2: `if true { }`,\n\n  break1: `loop { break; }`,\n  break2: `loop { if false { break; } }`,\n  break_if: `loop { continuing { break if false; } }`,\n\n  continue1: `loop { continue; continuing { break if true; } }`,\n\n  loop1: `loop { break; }`,\n  loop2: `loop { break; continuing { } }`,\n  loop3: `loop { continue; continuing { break if true; } }`,\n  loop4: `loop { break; continue; }`,\n\n  for1: `for (; true; ) { }`,\n  for2: `for (;;) { break; }`,\n  for3: `for (;true;) { continue; }`,\n\n  while1: `while true { }`,\n  while2: `while true { continue; }`,\n  while3: `while true { continue; break; }`,\n\n  switch1: `switch 1 { default { } }`,\n  swtich2: `switch 1 { case 1 { } default { } }`,\n  switch3: `switch 1 { default { break; } }`,\n  switch4: `switch 1 { default { } case 1 { break; } }`,\n\n  sequence1: `return; let x = 1`,\n  sequence2: `if true { } let x = 1`,\n  sequence3: `switch 1 { default { break; return; } }`,\n\n  compound1: `{ }`,\n  compound2: `{ loop { break; } if true { return; } }`,\n};\n\ng.test('valid_statements')\n  .desc('Test statements with valid behaviors')\n  .specURL('https://gpuweb.github.io/gpuweb/wgsl/#behaviors-rules')\n  .params(u => u.combine('body', keysOf(kValidStatements)))\n  .fn(t => {\n    const body = kValidStatements[t.params.body];\n    const code = `\n    var<private> v : i32;\n    fn bar() { }\n    fn foo() {\n      ${body};\n    }`;\n    t.expectCompileResult(true, code);\n  });\n\nconst kInvalidFunctions = {\n  next_for_type: `fn foo() -> bool { }`,\n  next_return_for_type: `fn foo() -> bool { if true { return true; } }`,\n};\n\ng.test('invalid_functions')\n  .desc('Test functions with invalid behaviors')\n  .specURL('https://gpuweb.github.io/gpuweb/wgsl/#behaviors-rules')\n  .params(u => u.combine('function', keysOf(kInvalidFunctions)))\n  .fn(t => {\n    const func = kInvalidFunctions[t.params.function];\n    t.expectCompileResult(false, func);\n  });\n\nconst kValidFunctions = {\n  empty: `fn foo() { }`,\n  next_return: `fn foo() { if true { return; } }`,\n  no_final_return: `fn foo() -> bool { if true { return true; } else { return false; } }`,\n};\n\ng.test('valid_functions')\n  .desc('Test functions with valid behaviors')\n  .specURL('https://gpuweb.github.io/gpuweb/wgsl/#behaviors-rules')\n  .params(u => u.combine('function', keysOf(kValidFunctions)))\n  .fn(t => {\n    const func = kValidFunctions[t.params.function];\n    t.expectCompileResult(true, func);\n  });\n"],"mappings":"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"}