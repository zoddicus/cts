{"version":3,"file":"return.spec.js","names":["description","makeTestGroup","isConvertible","scalarTypeOf","Type","ShaderValidationTest","g","kTestTypesNoAbstract","kTestTypes","test","desc","params","u","combine","undefined","beforeAllSubcases","t","type","kind","selectDeviceOrSkipTestCase","fn","enable","code","pass","expectCompileResult","create","wgsl","return_value_type","fn_return_type","returnValueType","fnReturnType"],"sources":["../../../../../src/webgpu/shader/validation/statement/return.spec.ts"],"sourcesContent":["export const description = `Validation tests for 'return' statements'`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { isConvertible, scalarTypeOf, Type } from '../../../util/conversion.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\nconst kTestTypesNoAbstract = [\n  'bool',\n  'i32',\n  'u32',\n  'f32',\n  'f16',\n  'vec2f',\n  'vec3h',\n  'vec4u',\n  'vec3b',\n  'mat2x3f',\n  'mat4x2h',\n] as const;\n\nconst kTestTypes = [\n  ...kTestTypesNoAbstract,\n  'abstract-int',\n  'abstract-float',\n  'vec2af',\n  'vec3af',\n  'vec4af',\n  'vec2ai',\n  'vec3ai',\n  'vec4ai',\n] as const;\n\ng.test('return_missing_value')\n  .desc(`Tests that a 'return' must have a value if the function has a return type`)\n  .params(u => u.combine('type', [...kTestTypesNoAbstract, undefined]))\n  .beforeAllSubcases(t => {\n    if (t.params.type !== undefined && scalarTypeOf(Type[t.params.type]).kind) {\n      t.selectDeviceOrSkipTestCase('shader-f16');\n    }\n  })\n  .fn(t => {\n    const type = t.params.type ? Type[t.params.type] : undefined;\n    const enable = type && scalarTypeOf(type).kind === 'f16' ? 'enable f16;' : '';\n    const code = `\n${enable}\n\nfn f()${type ? `-> ${type}` : ''} {\n  return;\n}\n`;\n\n    const pass = type === undefined;\n    t.expectCompileResult(pass, code);\n  });\n\ng.test('return_unexpected_value')\n  .desc(`Tests that a 'return' must not have a value if the function has no return type`)\n  .params(u => u.combine('type', [...kTestTypes, undefined]))\n  .beforeAllSubcases(t => {\n    if (t.params.type !== undefined && scalarTypeOf(Type[t.params.type]).kind) {\n      t.selectDeviceOrSkipTestCase('shader-f16');\n    }\n  })\n  .fn(t => {\n    const type = t.params.type ? Type[t.params.type] : undefined;\n    const enable = type && scalarTypeOf(type).kind === 'f16' ? 'enable f16;' : '';\n    const code = `\n${enable}\n\nfn f() {\n  return ${type ? `${type.create(1).wgsl()}` : ''};\n}\n`;\n\n    const pass = type === undefined;\n    t.expectCompileResult(pass, code);\n  });\n\ng.test('return_type_match')\n  .desc(`Tests that a 'return' value type must match the function return type`)\n  .params(u =>\n    u.combine('return_value_type', kTestTypes).combine('fn_return_type', kTestTypesNoAbstract)\n  )\n  .beforeAllSubcases(t => {\n    if (\n      scalarTypeOf(Type[t.params.return_value_type]).kind === 'f16' ||\n      scalarTypeOf(Type[t.params.fn_return_type]).kind === 'f16'\n    ) {\n      t.selectDeviceOrSkipTestCase('shader-f16');\n    }\n  })\n  .fn(t => {\n    const returnValueType = Type[t.params.return_value_type];\n    const fnReturnType = Type[t.params.fn_return_type];\n    const enable =\n      scalarTypeOf(returnValueType).kind === 'f16' || scalarTypeOf(fnReturnType).kind === 'f16'\n        ? 'enable f16;'\n        : '';\n    const code = `\n${enable}\n\nfn f() -> ${fnReturnType} {\n  return ${returnValueType.create(1).wgsl()};\n}\n`;\n\n    const pass = isConvertible(returnValueType, fnReturnType);\n    t.expectCompileResult(pass, code);\n  });\n"],"mappings":"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"}