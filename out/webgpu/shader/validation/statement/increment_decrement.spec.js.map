{"version":3,"file":"increment_decrement.spec.js","names":["description","makeTestGroup","keysOf","scalarTypeOf","Type","ShaderValidationTest","g","kConstructibleTypes","kConstructibleCases","reduce","acc","t","value","create","wgsl","pass","usesF16","kind","array","struct","gdecl","atomic_u32","atomic_i32","test","desc","params","u","combine","beforeAllSubcases","c","type","selectDeviceOrSkipTestCase","fn","operator","direction","code","expectCompileResult","kComponentCases","v2u_x","v2u_y","v3u_x","v3u_y","v3u_z","v4u_x","v4u_y","v4u_z","v4u_w","v2i_x","v2i_y","v3i_x","v3i_y","v3i_z","v4i_x","v4i_y","v4i_z","v4i_w","v2u_xx","v2u_indexed","v2f_x","v2h_x","mat2x2f","mat2x2h","array_i","array_f","struct_var","struct_field"],"sources":["../../../../../src/webgpu/shader/validation/statement/increment_decrement.spec.ts"],"sourcesContent":["export const description = `Validation for phony assignment statements`;\n\nimport { makeTestGroup } from '../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../common/util/data_tables.js';\nimport { scalarTypeOf, Type } from '../../../util/conversion.js';\nimport { ShaderValidationTest } from '../shader_validation_test.js';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ninterface Case {\n  value: string;\n  pass: boolean;\n  usesF16?: boolean;\n  gdecl?: string;\n}\n\nconst kConstructibleTypes = [\n  'bool',\n  'i32',\n  'u32',\n  'f32',\n  'f16',\n  'vec2f',\n  'vec3h',\n  'vec4u',\n  'vec3b',\n  'mat2x3f',\n  'mat4x2h',\n  'abstractInt',\n  'abstractFloat',\n] as const;\n\nconst kConstructibleCases = {\n  ...kConstructibleTypes.reduce(\n    (acc, t) => ({\n      ...acc,\n      [t]: {\n        value: Type[t].create(1).wgsl(),\n        pass: t === 'i32' || t === 'u32' || t === 'abstractInt',\n        usesF16: scalarTypeOf(Type[t]).kind === 'f16',\n      },\n    }),\n    {}\n  ),\n  array: { value: 'array(1,2,3)', pass: false },\n  struct: { value: 'S(1,2)', pass: false, gdecl: 'struct S{ a:u32, b:u32}' },\n  atomic_u32: { value: 'xu', pass: false, gdecl: 'var<workgroup> xu: atomic<u32>;' },\n  atomic_i32: { value: 'xi', pass: false, gdecl: 'var<workgroup> xi: atomic<i32>;' },\n} as const;\n\ng.test('var_init_type')\n  .desc(`Test increment and decrement of a variable of various types`)\n  .params(u => u.combine('type', keysOf(kConstructibleCases)).combine('direction', ['up', 'down']))\n  .beforeAllSubcases(t => {\n    const c = kConstructibleCases[t.params.type] as Case;\n    if (c.usesF16) {\n      t.selectDeviceOrSkipTestCase('shader-f16');\n    }\n  })\n  .fn(t => {\n    const { value, pass, usesF16, gdecl } = kConstructibleCases[t.params.type] as Case;\n    const operator = t.params.direction === 'up' ? '++' : '--';\n    const code = `\n${usesF16 ? 'enable f16;' : ''}\n${gdecl ?? ''}\nfn f() {\n  var a = ${value};\n  a${operator};\n}`;\n    t.expectCompileResult(pass, code);\n  });\n\ninterface ComponentCase {\n  type: string;\n  wgsl: string;\n  pass: boolean;\n  usesF16?: boolean;\n  gdecl?: string;\n}\n\nconst kComponentCases = {\n  v2u_x: { type: 'vec2u', wgsl: 'a.x', pass: true },\n  v2u_y: { type: 'vec2u', wgsl: 'a.y', pass: true },\n  v3u_x: { type: 'vec3u', wgsl: 'a.x', pass: true },\n  v3u_y: { type: 'vec3u', wgsl: 'a.y', pass: true },\n  v3u_z: { type: 'vec3u', wgsl: 'a.z', pass: true },\n  v4u_x: { type: 'vec4u', wgsl: 'a.x', pass: true },\n  v4u_y: { type: 'vec4u', wgsl: 'a.y', pass: true },\n  v4u_z: { type: 'vec4u', wgsl: 'a.z', pass: true },\n  v4u_w: { type: 'vec4u', wgsl: 'a.w', pass: true },\n  v2i_x: { type: 'vec2i', wgsl: 'a.x', pass: true },\n  v2i_y: { type: 'vec2i', wgsl: 'a.y', pass: true },\n  v3i_x: { type: 'vec3i', wgsl: 'a.x', pass: true },\n  v3i_y: { type: 'vec3i', wgsl: 'a.y', pass: true },\n  v3i_z: { type: 'vec3i', wgsl: 'a.z', pass: true },\n  v4i_x: { type: 'vec4i', wgsl: 'a.x', pass: true },\n  v4i_y: { type: 'vec4i', wgsl: 'a.y', pass: true },\n  v4i_z: { type: 'vec4i', wgsl: 'a.z', pass: true },\n  v4i_w: { type: 'vec4i', wgsl: 'a.w', pass: true },\n  v2u_xx: { type: 'vec2u', wgsl: 'a.xx', pass: false },\n  v2u_indexed: { type: 'vec2u', wgsl: 'a[0]', pass: true },\n  v2f_x: { type: 'vec2f', wgsl: 'a.x', pass: false },\n  v2h_x: { type: 'vec2h', wgsl: 'a.x', pass: false, usesF16: true },\n  mat2x2f: { type: 'mat2x2f', wgsl: 'a[0][0]', pass: false },\n  mat2x2h: { type: 'mat2x2h', wgsl: 'a[0][0]', pass: false, usesF16: true },\n  array: { type: 'array<i32,2>', wgsl: 'a', pass: false },\n  array_i: { type: 'array<i32,2>', wgsl: 'a[0]', pass: true },\n  array_f: { type: 'array<f32,2>', wgsl: 'a[0]', pass: false },\n  struct: { type: 'S', wgsl: 'S', pass: false, gdecl: 'struct S{field:i32}' },\n  struct_var: { type: 'S', wgsl: 'a', pass: false, gdecl: 'struct S{field:i32}' },\n  struct_field: { type: 'S', wgsl: 'a.field', pass: true, gdecl: 'struct S{field:i32}' },\n} as const;\n\ng.test('component')\n  .desc('Test increment and decrement of component of various types')\n  .params(u => u.combine('type', keysOf(kComponentCases)).combine('direction', ['up', 'down']))\n  .beforeAllSubcases(t => {\n    const c = kComponentCases[t.params.type] as ComponentCase;\n    if (c.usesF16) {\n      t.selectDeviceOrSkipTestCase('shader-f16');\n    }\n  })\n  .fn(t => {\n    const { type, wgsl, pass, usesF16, gdecl } = kComponentCases[t.params.type] as ComponentCase;\n    const operator = t.params.direction === 'up' ? '++' : '--';\n    const code = `\n${usesF16 ? 'enable f16;' : ''}\n${gdecl ?? ''}\nfn f() {\n  var a: ${type};\n  ${wgsl}${operator};\n}`;\n    t.expectCompileResult(pass, code);\n  });\n"],"mappings":"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"}