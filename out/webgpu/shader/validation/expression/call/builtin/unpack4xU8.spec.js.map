{"version":3,"file":"unpack4xU8.spec.js","names":["kFn","description","makeTestGroup","keysOf","ShaderValidationTest","kFeature","kArgCases","good_u32","good_aint","bad_0args","bad_2args","bad_i32","bad_f32","bad_f16","bad_bool","bad_vec2u","bad_vec3u","bad_vec4u","bad_array","bad_struct","kGoodArgs","kReturnType","g","test","desc","params","u","combine","fn","t","skipIfLanguageFeatureSupported","preamble","requires","code","expectCompileResult","skipIfLanguageFeatureNotSupported","arg","startsWith","type","use_it","use"],"sources":["../../../../../../../src/webgpu/shader/validation/expression/call/builtin/unpack4xU8.spec.ts"],"sourcesContent":["const kFn = 'unpack4xU8';\nexport const description = `Validate ${kFn}`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { keysOf } from '../../../../../../common/util/data_tables.js';\nimport { ShaderValidationTest } from '../../../shader_validation_test.js';\n\nconst kFeature = 'packed_4x8_integer_dot_product';\nconst kArgCases = {\n  good_u32: '(1u)',\n  good_aint: '(1)',\n  bad_0args: '()',\n  bad_2args: '(1u,2u)',\n  bad_i32: '(1i)',\n  bad_f32: '(1f)',\n  bad_f16: '(1h)',\n  bad_bool: '(false)',\n  bad_vec2u: '(vec2u())',\n  bad_vec3u: '(vec3u())',\n  bad_vec4u: '(vec4u())',\n  bad_array: '(array(1))',\n  bad_struct: '(modf(1.1))',\n};\nconst kGoodArgs = kArgCases['good_u32'];\nconst kReturnType = 'vec4u';\n\nexport const g = makeTestGroup(ShaderValidationTest);\n\ng.test('unsupported')\n  .desc(`Test absence of ${kFn} when ${kFeature} is not supported.`)\n  .params(u => u.combine('requires', [false, true]))\n  .fn(t => {\n    t.skipIfLanguageFeatureSupported(kFeature);\n    const preamble = t.params.requires ? `requires ${kFeature}; ` : '';\n    const code = `${preamble}const c = ${kFn}${kGoodArgs};`;\n    t.expectCompileResult(false, code);\n  });\n\ng.test('supported')\n  .desc(`Test presence of ${kFn} when ${kFeature} is supported.`)\n  .params(u => u.combine('requires', [false, true]))\n  .fn(t => {\n    t.skipIfLanguageFeatureNotSupported(kFeature);\n    const preamble = t.params.requires ? `requires ${kFeature}; ` : '';\n    const code = `${preamble}const c = ${kFn}${kGoodArgs};`;\n    t.expectCompileResult(true, code);\n  });\n\ng.test('args')\n  .desc(`Test compilation failure of ${kFn} with various numbers of and types of arguments`)\n  .params(u => u.combine('arg', keysOf(kArgCases)))\n  .fn(t => {\n    t.skipIfLanguageFeatureNotSupported(kFeature);\n\n    let code = '';\n    if (t.params.arg === 'bad_f16') {\n      code += 'enable f16;\\n';\n    }\n    code += `const c = ${kFn}${kArgCases[t.params.arg]};`;\n\n    t.expectCompileResult(t.params.arg.startsWith('good'), code);\n  });\n\ng.test('return')\n  .desc(`Test ${kFn} return value type ${kReturnType}`)\n  .params(u => u.combine('type', ['vec4u', 'vec4i', 'vec4f', 'vec3u', 'vec2u', 'u32']))\n  .fn(t => {\n    t.expectCompileResult(\n      t.params.type === kReturnType,\n      `const c: ${t.params.type} = ${kFn}${kGoodArgs};`\n    );\n  });\n\ng.test('must_use')\n  .desc(`Result of ${kFn} must be used`)\n  .params(u => u.combine('use', [true, false]))\n  .fn(t => {\n    t.skipIfLanguageFeatureNotSupported(kFeature);\n    const use_it = t.params.use ? '_ = ' : '';\n    t.expectCompileResult(t.params.use, `fn f() { ${use_it}${kFn}${kGoodArgs}; }`);\n  });\n"],"mappings":"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"}