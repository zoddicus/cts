{"version":3,"file":"bool_conversion.spec.js","names":["description","makeTestGroup","GPUTest","anyOf","bool","f32","i32","TypeBool","TypeF32","TypeI32","TypeU32","u32","fullF32Range","fullI32Range","fullU32Range","isSubnormalNumberF32","makeCaseCache","allInputSources","run","unary","g","d","input","expected","map","u","i","f","push","vectorizeToExpression","vectorize","undefined","test","specURL","desc","params","combine","fn","t","cases","get","unimplemented"],"sources":["../../../../../../src/webgpu/shader/execution/expression/unary/bool_conversion.spec.ts"],"sourcesContent":["export const description = `\nExecution Tests for the boolean conversion operations\n`;\n\nimport { makeTestGroup } from '../../../../../common/framework/test_group.js';\nimport { GPUTest } from '../../../../gpu_test.js';\nimport { anyOf } from '../../../../util/compare.js';\nimport {\n  bool,\n  f32,\n  i32,\n  Scalar,\n  TypeBool,\n  TypeF32,\n  TypeI32,\n  TypeU32,\n  u32,\n} from '../../../../util/conversion.js';\nimport {\n  fullF32Range,\n  fullI32Range,\n  fullU32Range,\n  isSubnormalNumberF32,\n} from '../../../../util/math.js';\nimport { makeCaseCache } from '../case_cache.js';\nimport { allInputSources, run, ShaderBuilder } from '../expression.js';\n\nimport { unary } from './unary.js';\n\nexport const g = makeTestGroup(GPUTest);\n\nexport const d = makeCaseCache('unary/bool_conversion', {\n  bool: () => {\n    return [\n      { input: bool(true), expected: bool(true) },\n      { input: bool(false), expected: bool(false) },\n    ];\n  },\n  u32: () => {\n    return fullU32Range().map(u => {\n      return { input: u32(u), expected: u === 0 ? bool(false) : bool(true) };\n    });\n  },\n  i32: () => {\n    return fullI32Range().map(i => {\n      return { input: i32(i), expected: i === 0 ? bool(false) : bool(true) };\n    });\n  },\n  f32: () => {\n    return fullF32Range().map(f => {\n      const expected: Scalar[] = [];\n      if (f !== 0) {\n        expected.push(bool(true));\n      }\n      if (isSubnormalNumberF32(f)) {\n        expected.push(bool(false));\n      }\n      return { input: f32(f), expected: anyOf(...expected) };\n    });\n  },\n});\n\n/** Generate expression builder based on how the test case is to be vectorized */\nfunction vectorizeToExpression(vectorize: undefined | 2 | 3 | 4): ShaderBuilder {\n  return vectorize === undefined ? unary('bool') : unary(`vec${vectorize}<bool>`);\n}\n\ng.test('bool')\n  .specURL('https://www.w3.org/TR/WGSL/#value-constructor-builtin-function')\n  .desc(\n    `\nbool(e), where e is a bool\n\nIdentity operation\n`\n  )\n  .params(u =>\n    u.combine('inputSource', allInputSources).combine('vectorize', [undefined, 2, 3, 4] as const)\n  )\n  .fn(async t => {\n    const cases = await d.get('bool');\n    await run(t, vectorizeToExpression(t.params.vectorize), [TypeBool], TypeBool, t.params, cases);\n  });\n\ng.test('u32')\n  .specURL('https://www.w3.org/TR/WGSL/#bool-builtin')\n  .desc(\n    `\nbool(e), where e is a u32\n\nCoercion to boolean.\nThe result is false if e is 0, and true otherwise.\n`\n  )\n  .params(u =>\n    u.combine('inputSource', allInputSources).combine('vectorize', [undefined, 2, 3, 4] as const)\n  )\n  .fn(async t => {\n    const cases = await d.get('u32');\n    await run(t, vectorizeToExpression(t.params.vectorize), [TypeU32], TypeBool, t.params, cases);\n  });\n\ng.test('i32')\n  .specURL('https://www.w3.org/TR/WGSL/#value-constructor-builtin-function')\n  .desc(\n    `\nbool(e), where e is a i32\n\nCoercion to boolean.\nThe result is false if e is 0, and true otherwise.\n`\n  )\n  .params(u =>\n    u.combine('inputSource', allInputSources).combine('vectorize', [undefined, 2, 3, 4] as const)\n  )\n  .fn(async t => {\n    const cases = await d.get('i32');\n    await run(t, vectorizeToExpression(t.params.vectorize), [TypeI32], TypeBool, t.params, cases);\n  });\n\ng.test('f32')\n  .specURL('https://www.w3.org/TR/WGSL/#value-constructor-builtin-function')\n  .desc(\n    `\nbool(e), where e is a f32\n\nCoercion to boolean.\nThe result is false if e is 0.0 or -0.0, and true otherwise.\n`\n  )\n  .params(u =>\n    u.combine('inputSource', allInputSources).combine('vectorize', [undefined, 2, 3, 4] as const)\n  )\n  .fn(async t => {\n    const cases = await d.get('f32');\n    await run(t, vectorizeToExpression(t.params.vectorize), [TypeF32], TypeBool, t.params, cases);\n  });\n\ng.test('f16')\n  .specURL('https://www.w3.org/TR/WGSL/#value-constructor-builtin-function')\n  .desc(\n    `\nbool(e), where e is a f16\n\nCoercion to boolean.\nThe result is false if e is 0.0 or -0.0, and true otherwise.\n`\n  )\n  .params(u =>\n    u.combine('inputSource', allInputSources).combine('vectorize', [undefined, 2, 3, 4] as const)\n  )\n  .unimplemented();\n"],"mappings":"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"}