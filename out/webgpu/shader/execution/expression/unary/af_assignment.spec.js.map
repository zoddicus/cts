{"version":3,"file":"af_assignment.spec.js","names":["description","makeTestGroup","GPUTest","kValue","abstractFloat","TypeAbstractFloat","TypeF16","TypeF32","FP","filteredF64Range","fullF64Range","isSubnormalNumberF64","reinterpretU64AsF64","makeCaseCache","allInputSources","run","assignment","g","d","abstract","inputs","map","f","input","expected","f32","negative","min","positive","max","correctlyRoundedInterval","f16","test","specURL","desc","params","u","combine","fn","t","cases","get","beforeAllSubcases","selectDeviceOrSkipTestCase","requiredFeatures"],"sources":["../../../../../../src/webgpu/shader/execution/expression/unary/af_assignment.spec.ts"],"sourcesContent":["export const description = `\nExecution Tests for assignment of AbstractFloats\n`;\n\nimport { makeTestGroup } from '../../../../../common/framework/test_group.js';\nimport { GPUTest } from '../../../../gpu_test.js';\nimport { kValue } from '../../../../util/constants.js';\nimport { abstractFloat, TypeAbstractFloat, TypeF16, TypeF32 } from '../../../../util/conversion.js';\nimport { FP } from '../../../../util/floating_point.js';\nimport {\n  filteredF64Range,\n  fullF64Range,\n  isSubnormalNumberF64,\n  reinterpretU64AsF64,\n} from '../../../../util/math.js';\nimport { makeCaseCache } from '../case_cache.js';\nimport { allInputSources, run } from '../expression.js';\n\nimport { assignment } from './unary.js';\n\nexport const g = makeTestGroup(GPUTest);\n\nexport const d = makeCaseCache('unary/af_assignment', {\n  abstract: () => {\n    const inputs = [\n      // Values that are useful for debugging the underlying framework/shader code, since it cannot be directly unit tested.\n      0,\n      0.5,\n      0.5,\n      1,\n      -1,\n      reinterpretU64AsF64(0x7000_0000_0000_0001n), // smallest magnitude negative subnormal with non-zero mantissa\n      reinterpretU64AsF64(0x0000_0000_0000_0001n), // smallest magnitude positive subnormal with non-zero mantissa\n      reinterpretU64AsF64(0x600a_aaaa_5555_5555n), // negative subnormal with obvious pattern\n      reinterpretU64AsF64(0x000a_aaaa_5555_5555n), // positive subnormal with obvious pattern\n      reinterpretU64AsF64(0x0010_0000_0000_0001n), // smallest magnitude negative normal with non-zero mantissa\n      reinterpretU64AsF64(0x0010_0000_0000_0001n), // smallest magnitude positive normal with non-zero mantissa\n      reinterpretU64AsF64(0xf555_5555_aaaa_aaaan), // negative normal with obvious pattern\n      reinterpretU64AsF64(0x5555_5555_aaaa_aaaan), // positive normal with obvious pattern\n      reinterpretU64AsF64(0xffef_ffff_ffff_ffffn), // largest magnitude negative normal\n      reinterpretU64AsF64(0x7fef_ffff_ffff_ffffn), // largest magnitude positive normal\n      // WebGPU implementation stressing values\n      ...fullF64Range(),\n    ];\n    return inputs.map(f => {\n      return {\n        input: abstractFloat(f),\n        expected: isSubnormalNumberF64(f) ? abstractFloat(0) : abstractFloat(f),\n      };\n    });\n  },\n  f32: () => {\n    return filteredF64Range(kValue.f32.negative.min, kValue.f32.positive.max).map(f => {\n      return { input: abstractFloat(f), expected: FP.f32.correctlyRoundedInterval(f) };\n    });\n  },\n  f16: () => {\n    return filteredF64Range(kValue.f16.negative.min, kValue.f16.positive.max).map(f => {\n      return { input: abstractFloat(f), expected: FP.f16.correctlyRoundedInterval(f) };\n    });\n  },\n});\n\ng.test('abstract')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-conversion')\n  .desc(\n    `\ntesting that extracting abstract floats works\n`\n  )\n  .params(u => u.combine('inputSource', [allInputSources[0]])) // Only defined for const-eval\n  .fn(async t => {\n    const cases = await d.get('abstract');\n    await run(t, assignment(), [TypeAbstractFloat], TypeAbstractFloat, t.params, cases, 1);\n  });\n\ng.test('f32')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-conversion')\n  .desc(\n    `\nconcretizing to f32\n`\n  )\n  .params(u => u.combine('inputSource', [allInputSources[0]])) // Only defined for const-eval\n  .fn(async t => {\n    const cases = await d.get('f32');\n    await run(t, assignment(), [TypeAbstractFloat], TypeF32, t.params, cases);\n  });\n\ng.test('f16')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-conversion')\n  .desc(\n    `\nconcretizing to f16\n`\n  )\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase({ requiredFeatures: ['shader-f16'] });\n  })\n  .params(u => u.combine('inputSource', [allInputSources[0]])) // Only defined for const-eval\n  .fn(async t => {\n    const cases = await d.get('f16');\n    await run(t, assignment(), [TypeAbstractFloat], TypeF16, t.params, cases);\n  });\n"],"mappings":"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"}