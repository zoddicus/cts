{"version":3,"file":"f32_remainder.spec.js","names":["description","makeTestGroup","GPUTest","TypeF32","TypeVec","FP","sparseF32Range","sparseVectorF32Range","makeCaseCache","allInputSources","run","binary","compoundBinary","remainderVectorScalarInterval","v","s","f32","toVector","map","e","remainderInterval","remainderScalarVectorInterval","g","scalar_cases","nonConst","generateScalarPairToIntervalCases","reduce","a","b","vector_scalar_cases","flatMap","dim","generateVectorScalarToVectorCases","scalar_vector_cases","generateScalarVectorToVectorCases","d","test","specURL","desc","params","u","combine","fn","t","cases","get","inputSource","undefined"],"sources":["../../../../../../src/webgpu/shader/execution/expression/binary/f32_remainder.spec.ts"],"sourcesContent":["export const description = `\nExecution Tests for non-matrix f32 remainder expression\n`;\n\nimport { makeTestGroup } from '../../../../../common/framework/test_group.js';\nimport { GPUTest } from '../../../../gpu_test.js';\nimport { TypeF32, TypeVec } from '../../../../util/conversion.js';\nimport { FP, FPVector } from '../../../../util/floating_point.js';\nimport { sparseF32Range, sparseVectorF32Range } from '../../../../util/math.js';\nimport { makeCaseCache } from '../case_cache.js';\nimport { allInputSources, run } from '../expression.js';\n\nimport { binary, compoundBinary } from './binary.js';\n\nconst remainderVectorScalarInterval = (v: readonly number[], s: number): FPVector => {\n  return FP.f32.toVector(v.map(e => FP.f32.remainderInterval(e, s)));\n};\n\nconst remainderScalarVectorInterval = (s: number, v: readonly number[]): FPVector => {\n  return FP.f32.toVector(v.map(e => FP.f32.remainderInterval(s, e)));\n};\n\nexport const g = makeTestGroup(GPUTest);\n\nconst scalar_cases = ([true, false] as const)\n  .map(nonConst => ({\n    [`scalar_${nonConst ? 'non_const' : 'const'}`]: () => {\n      return FP.f32.generateScalarPairToIntervalCases(\n        sparseF32Range(),\n        sparseF32Range(),\n        nonConst ? 'unfiltered' : 'finite',\n        FP.f32.remainderInterval\n      );\n    },\n  }))\n  .reduce((a, b) => ({ ...a, ...b }), {});\n\nconst vector_scalar_cases = ([2, 3, 4] as const)\n  .flatMap(dim =>\n    ([true, false] as const).map(nonConst => ({\n      [`vec${dim}_scalar_${nonConst ? 'non_const' : 'const'}`]: () => {\n        return FP.f32.generateVectorScalarToVectorCases(\n          sparseVectorF32Range(dim),\n          sparseF32Range(),\n          nonConst ? 'unfiltered' : 'finite',\n          remainderVectorScalarInterval\n        );\n      },\n    }))\n  )\n  .reduce((a, b) => ({ ...a, ...b }), {});\n\nconst scalar_vector_cases = ([2, 3, 4] as const)\n  .flatMap(dim =>\n    ([true, false] as const).map(nonConst => ({\n      [`scalar_vec${dim}_${nonConst ? 'non_const' : 'const'}`]: () => {\n        return FP.f32.generateScalarVectorToVectorCases(\n          sparseF32Range(),\n          sparseVectorF32Range(dim),\n          nonConst ? 'unfiltered' : 'finite',\n          remainderScalarVectorInterval\n        );\n      },\n    }))\n  )\n  .reduce((a, b) => ({ ...a, ...b }), {});\n\nexport const d = makeCaseCache('binary/f32_remainder', {\n  ...scalar_cases,\n  ...vector_scalar_cases,\n  ...scalar_vector_cases,\n});\n\ng.test('scalar')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-evaluation')\n  .desc(\n    `\nExpression: x % y, where x and y are scalars\nAccuracy: Derived from x - y * trunc(x/y)\n`\n  )\n  .params(u => u.combine('inputSource', allInputSources))\n  .fn(async t => {\n    const cases = await d.get(\n      t.params.inputSource === 'const' ? 'scalar_const' : 'scalar_non_const'\n    );\n    await run(t, binary('%'), [TypeF32, TypeF32], TypeF32, t.params, cases);\n  });\n\ng.test('vector')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-evaluation')\n  .desc(\n    `\nExpression: x % y, where x and y are vectors\nAccuracy: Derived from x - y * trunc(x/y)\n`\n  )\n  .params(u => u.combine('inputSource', allInputSources).combine('vectorize', [2, 3, 4] as const))\n  .fn(async t => {\n    const cases = await d.get(\n      t.params.inputSource === 'const' ? 'scalar_const' : 'scalar_non_const' // Using vectorize to generate vector cases based on scalar cases\n    );\n    await run(t, binary('%'), [TypeF32, TypeF32], TypeF32, t.params, cases);\n  });\n\ng.test('scalar_compound')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-evaluation')\n  .desc(\n    `\nExpression: x %= y\nAccuracy: Derived from x - y * trunc(x/y)\n`\n  )\n  .params(u =>\n    u.combine('inputSource', allInputSources).combine('vectorize', [undefined, 2, 3, 4] as const)\n  )\n  .fn(async t => {\n    const cases = await d.get(\n      t.params.inputSource === 'const' ? 'scalar_const' : 'scalar_non_const'\n    );\n    await run(t, compoundBinary('%='), [TypeF32, TypeF32], TypeF32, t.params, cases);\n  });\n\ng.test('vector_scalar')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-evaluation')\n  .desc(\n    `\nExpression: x % y, where x is a vector and y is a scalar\nAccuracy: Correctly rounded\n`\n  )\n  .params(u => u.combine('inputSource', allInputSources).combine('dim', [2, 3, 4] as const))\n  .fn(async t => {\n    const dim = t.params.dim;\n    const cases = await d.get(\n      t.params.inputSource === 'const' ? `vec${dim}_scalar_const` : `vec${dim}_scalar_non_const`\n    );\n    await run(\n      t,\n      binary('%'),\n      [TypeVec(dim, TypeF32), TypeF32],\n      TypeVec(dim, TypeF32),\n      t.params,\n      cases\n    );\n  });\n\ng.test('vector_scalar_compound')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-evaluation')\n  .desc(\n    `\nExpression: x %= y, where x is a vector and y is a scalar\nAccuracy: Correctly rounded\n`\n  )\n  .params(u => u.combine('inputSource', allInputSources).combine('dim', [2, 3, 4] as const))\n  .fn(async t => {\n    const dim = t.params.dim;\n    const cases = await d.get(\n      t.params.inputSource === 'const' ? `vec${dim}_scalar_const` : `vec${dim}_scalar_non_const`\n    );\n    await run(\n      t,\n      compoundBinary('%='),\n      [TypeVec(dim, TypeF32), TypeF32],\n      TypeVec(dim, TypeF32),\n      t.params,\n      cases\n    );\n  });\n\ng.test('scalar_vector')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-evaluation')\n  .desc(\n    `\nExpression: x % y, where x is a scalar and y is a vector\nAccuracy: Correctly rounded\n`\n  )\n  .params(u => u.combine('inputSource', allInputSources).combine('dim', [2, 3, 4] as const))\n  .fn(async t => {\n    const dim = t.params.dim;\n    const cases = await d.get(\n      t.params.inputSource === 'const' ? `scalar_vec${dim}_const` : `scalar_vec${dim}_non_const`\n    );\n    await run(\n      t,\n      binary('%'),\n      [TypeF32, TypeVec(dim, TypeF32)],\n      TypeVec(dim, TypeF32),\n      t.params,\n      cases\n    );\n  });\n"],"mappings":"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"}