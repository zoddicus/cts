{"version":3,"file":"f16_remainder.spec.js","names":["description","makeTestGroup","GPUTest","TypeF16","TypeVec","FP","sparseF16Range","sparseVectorF16Range","makeCaseCache","allInputSources","run","binary","compoundBinary","remainderVectorScalarInterval","v","s","f16","toVector","map","e","remainderInterval","remainderScalarVectorInterval","g","scalar_cases","nonConst","generateScalarPairToIntervalCases","reduce","a","b","vector_scalar_cases","flatMap","dim","generateVectorScalarToVectorCases","scalar_vector_cases","generateScalarVectorToVectorCases","d","test","specURL","desc","params","u","combine","beforeAllSubcases","t","selectDeviceOrSkipTestCase","fn","cases","get","inputSource","undefined"],"sources":["../../../../../../src/webgpu/shader/execution/expression/binary/f16_remainder.spec.ts"],"sourcesContent":["export const description = `\nExecution Tests for non-matrix f16 remainder expression\n`;\n\nimport { makeTestGroup } from '../../../../../common/framework/test_group.js';\nimport { GPUTest } from '../../../../gpu_test.js';\nimport { TypeF16, TypeVec } from '../../../../util/conversion.js';\nimport { FP, FPVector } from '../../../../util/floating_point.js';\nimport { sparseF16Range, sparseVectorF16Range } from '../../../../util/math.js';\nimport { makeCaseCache } from '../case_cache.js';\nimport { allInputSources, run } from '../expression.js';\n\nimport { binary, compoundBinary } from './binary.js';\n\nconst remainderVectorScalarInterval = (v: readonly number[], s: number): FPVector => {\n  return FP.f16.toVector(v.map(e => FP.f16.remainderInterval(e, s)));\n};\n\nconst remainderScalarVectorInterval = (s: number, v: readonly number[]): FPVector => {\n  return FP.f16.toVector(v.map(e => FP.f16.remainderInterval(s, e)));\n};\n\nexport const g = makeTestGroup(GPUTest);\n\nconst scalar_cases = ([true, false] as const)\n  .map(nonConst => ({\n    [`scalar_${nonConst ? 'non_const' : 'const'}`]: () => {\n      return FP.f16.generateScalarPairToIntervalCases(\n        sparseF16Range(),\n        sparseF16Range(),\n        nonConst ? 'unfiltered' : 'finite',\n        FP.f16.remainderInterval\n      );\n    },\n  }))\n  .reduce((a, b) => ({ ...a, ...b }), {});\n\nconst vector_scalar_cases = ([2, 3, 4] as const)\n  .flatMap(dim =>\n    ([true, false] as const).map(nonConst => ({\n      [`vec${dim}_scalar_${nonConst ? 'non_const' : 'const'}`]: () => {\n        return FP.f16.generateVectorScalarToVectorCases(\n          sparseVectorF16Range(dim),\n          sparseF16Range(),\n          nonConst ? 'unfiltered' : 'finite',\n          remainderVectorScalarInterval\n        );\n      },\n    }))\n  )\n  .reduce((a, b) => ({ ...a, ...b }), {});\n\nconst scalar_vector_cases = ([2, 3, 4] as const)\n  .flatMap(dim =>\n    ([true, false] as const).map(nonConst => ({\n      [`scalar_vec${dim}_${nonConst ? 'non_const' : 'const'}`]: () => {\n        return FP.f16.generateScalarVectorToVectorCases(\n          sparseF16Range(),\n          sparseVectorF16Range(dim),\n          nonConst ? 'unfiltered' : 'finite',\n          remainderScalarVectorInterval\n        );\n      },\n    }))\n  )\n  .reduce((a, b) => ({ ...a, ...b }), {});\n\nexport const d = makeCaseCache('binary/f16_remainder', {\n  ...scalar_cases,\n  ...vector_scalar_cases,\n  ...scalar_vector_cases,\n});\n\ng.test('scalar')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-evaluation')\n  .desc(\n    `\nExpression: x % y, where x and y are scalars\nAccuracy: Derived from x - y * trunc(x/y)\n`\n  )\n  .params(u => u.combine('inputSource', allInputSources))\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  })\n  .fn(async t => {\n    const cases = await d.get(\n      t.params.inputSource === 'const' ? 'scalar_const' : 'scalar_non_const'\n    );\n    await run(t, binary('%'), [TypeF16, TypeF16], TypeF16, t.params, cases);\n  });\n\ng.test('vector')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-evaluation')\n  .desc(\n    `\nExpression: x % y, where x and y are vectors\nAccuracy: Derived from x - y * trunc(x/y)\n`\n  )\n  .params(u => u.combine('inputSource', allInputSources).combine('vectorize', [2, 3, 4] as const))\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  })\n  .fn(async t => {\n    const cases = await d.get(\n      t.params.inputSource === 'const' ? 'scalar_const' : 'scalar_non_const'\n    );\n    await run(t, binary('%'), [TypeF16, TypeF16], TypeF16, t.params, cases);\n  });\n\ng.test('scalar_compound')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-evaluation')\n  .desc(\n    `\nExpression: x %= y\nAccuracy: Derived from x - y * trunc(x/y)\n`\n  )\n  .params(u =>\n    u.combine('inputSource', allInputSources).combine('vectorize', [undefined, 2, 3, 4] as const)\n  )\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  })\n  .fn(async t => {\n    const cases = await d.get(\n      t.params.inputSource === 'const' ? 'scalar_const' : 'scalar_non_const'\n    );\n    await run(t, compoundBinary('%='), [TypeF16, TypeF16], TypeF16, t.params, cases);\n  });\n\ng.test('vector_scalar')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-evaluation')\n  .desc(\n    `\nExpression: x % y, where x is a vector and y is a scalar\nAccuracy: Correctly rounded\n`\n  )\n  .params(u => u.combine('inputSource', allInputSources).combine('dim', [2, 3, 4] as const))\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  })\n  .fn(async t => {\n    const dim = t.params.dim;\n    const cases = await d.get(\n      t.params.inputSource === 'const' ? `vec${dim}_scalar_const` : `vec${dim}_scalar_non_const`\n    );\n    await run(\n      t,\n      binary('%'),\n      [TypeVec(dim, TypeF16), TypeF16],\n      TypeVec(dim, TypeF16),\n      t.params,\n      cases\n    );\n  });\n\ng.test('vector_scalar_compound')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-evaluation')\n  .desc(\n    `\nExpression: x %= y, where x is a vector and y is a scalar\nAccuracy: Correctly rounded\n`\n  )\n  .params(u => u.combine('inputSource', allInputSources).combine('dim', [2, 3, 4] as const))\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  })\n  .fn(async t => {\n    const dim = t.params.dim;\n    const cases = await d.get(\n      t.params.inputSource === 'const' ? `vec${dim}_scalar_const` : `vec${dim}_scalar_non_const`\n    );\n    await run(\n      t,\n      compoundBinary('%='),\n      [TypeVec(dim, TypeF16), TypeF16],\n      TypeVec(dim, TypeF16),\n      t.params,\n      cases\n    );\n  });\n\ng.test('scalar_vector')\n  .specURL('https://www.w3.org/TR/WGSL/#floating-point-evaluation')\n  .desc(\n    `\nExpression: x % y, where x is a scalar and y is a vector\nAccuracy: Correctly rounded\n`\n  )\n  .params(u => u.combine('inputSource', allInputSources).combine('dim', [2, 3, 4] as const))\n  .beforeAllSubcases(t => {\n    t.selectDeviceOrSkipTestCase('shader-f16');\n  })\n  .fn(async t => {\n    const dim = t.params.dim;\n    const cases = await d.get(\n      t.params.inputSource === 'const' ? `scalar_vec${dim}_const` : `scalar_vec${dim}_non_const`\n    );\n    await run(\n      t,\n      binary('%'),\n      [TypeF16, TypeVec(dim, TypeF16)],\n      TypeVec(dim, TypeF16),\n      t.params,\n      cases\n    );\n  });\n"],"mappings":"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"}