{"version":3,"file":"zero_value.spec.js","names":["description","makeTestGroup","GPUTest","Type","basicExpressionBuilder","run","g","test","specURL","desc","params","u","combine","beforeAllSubcases","t","type","selectDeviceOrSkipTestCase","fn","ops","inputSource","input","expected","create","vec","width","constEvaluationMode","mat","columns","rows","array","length","beginSubcases","expand","member_types","map","_","i","includes","memberType","member_index","builder","nested","ty","join"],"sources":["../../../../../../src/webgpu/shader/execution/expression/constructor/zero_value.spec.ts"],"sourcesContent":["export const description = `\nExecution Tests for zero value constructors\n`;\n\nimport { makeTestGroup } from '../../../../../common/framework/test_group.js';\nimport { GPUTest } from '../../../../gpu_test.js';\nimport { ScalarKind, Type } from '../../../../util/conversion.js';\nimport { ShaderBuilderParams, basicExpressionBuilder, run } from '../expression.js';\n\nexport const g = makeTestGroup(GPUTest);\n\ng.test('scalar')\n  .specURL('https://www.w3.org/TR/WGSL/#zero-value-builtin-function')\n  .desc(`Test that a zero value scalar constructor produces the expected zero value`)\n  .params(u => u.combine('type', ['bool', 'i32', 'u32', 'f32', 'f16'] as const))\n  .beforeAllSubcases(t => {\n    if (t.params.type === 'f16') {\n      t.selectDeviceOrSkipTestCase('shader-f16');\n    }\n  })\n  .fn(async t => {\n    const type = Type[t.params.type];\n    await run(\n      t,\n      basicExpressionBuilder(ops => `${type}()`),\n      [],\n      type,\n      { inputSource: 'const' },\n      [{ input: [], expected: type.create(0) }]\n    );\n  });\n\ng.test('vector')\n  .specURL('https://www.w3.org/TR/WGSL/#zero-value-builtin-function')\n  .desc(`Test that a zero value vector constructor produces the expected zero value`)\n  .params(u =>\n    u\n      .combine('type', ['bool', 'i32', 'u32', 'f32', 'f16'] as const)\n      .combine('width', [2, 3, 4] as const)\n  )\n  .beforeAllSubcases(t => {\n    if (t.params.type === 'f16') {\n      t.selectDeviceOrSkipTestCase('shader-f16');\n    }\n  })\n  .fn(async t => {\n    const type = Type.vec(t.params.width, Type[t.params.type]);\n    await run(\n      t,\n      basicExpressionBuilder(ops => `${type}()`),\n      [],\n      type,\n      { inputSource: 'const' },\n      [{ input: [], expected: type.create(0) }]\n    );\n  });\n\ng.test('vector_prefix')\n  .desc(`Test that a zero value vector constructor produces the expected zero value`)\n  .params(u =>\n    u.combine('type', ['i32', 'u32', 'f32', 'f16'] as const).combine('width', [2, 3, 4] as const)\n  )\n  .beforeAllSubcases(t => {\n    if (t.params.type === 'f16') {\n      t.selectDeviceOrSkipTestCase('shader-f16');\n    }\n  })\n  .fn(async t => {\n    const type = Type.vec(t.params.width, Type[t.params.type]);\n    await run(\n      t,\n      basicExpressionBuilder(ops => `vec${t.params.width}()`),\n      [],\n      type,\n      { inputSource: 'const', constEvaluationMode: 'direct' },\n      [{ input: [], expected: type.create(0) }]\n    );\n  });\n\ng.test('matrix')\n  .specURL('https://www.w3.org/TR/WGSL/#zero-value-builtin-function')\n  .desc(`Test that a zero value matrix constructor produces the expected zero value`)\n  .params(u =>\n    u\n      .combine('type', ['f32', 'f16'] as const)\n      .combine('columns', [2, 3, 4] as const)\n      .combine('rows', [2, 3, 4] as const)\n  )\n  .beforeAllSubcases(t => {\n    if (t.params.type === 'f16') {\n      t.selectDeviceOrSkipTestCase('shader-f16');\n    }\n  })\n  .fn(async t => {\n    const type = Type.mat(t.params.columns, t.params.rows, Type[t.params.type]);\n    await run(\n      t,\n      basicExpressionBuilder(ops => `${type}()`),\n      [],\n      type,\n      { inputSource: 'const' },\n      [{ input: [], expected: type.create(0) }]\n    );\n  });\n\ng.test('array')\n  .specURL('https://www.w3.org/TR/WGSL/#zero-value-builtin-function')\n  .desc(`Test that a zero value matrix constructor produces the expected zero value`)\n  .params(u =>\n    u\n      .combine('type', ['bool', 'i32', 'u32', 'f32', 'f16', 'vec3f', 'vec4i'] as const)\n      .combine('length', [1, 5, 10] as const)\n  )\n  .beforeAllSubcases(t => {\n    if (t.params.type === 'f16') {\n      t.selectDeviceOrSkipTestCase('shader-f16');\n    }\n  })\n  .fn(async t => {\n    const type = Type.array(t.params.length, Type[t.params.type]);\n    await run(\n      t,\n      basicExpressionBuilder(ops => `${type}()`),\n      [],\n      type,\n      { inputSource: 'const' },\n      [{ input: [], expected: type.create(0) }]\n    );\n  });\n\ng.test('structure')\n  .specURL('https://www.w3.org/TR/WGSL/#zero-value-builtin-function')\n  .desc(`Test that an structure constructed from element values produces the expected value`)\n  .params(u =>\n    u\n      .combine('member_types', [\n        ['bool'],\n        ['u32'],\n        ['vec3f'],\n        ['i32', 'u32'],\n        ['i32', 'f16', 'vec4i', 'mat3x2f'],\n        ['bool', 'u32', 'f16', 'vec3f', 'vec2i'],\n        ['i32', 'u32', 'f32', 'f16', 'vec3f', 'vec4i'],\n      ] as readonly ScalarKind[][])\n      .combine('nested', [false, true])\n      .beginSubcases()\n      .expand('member_index', t => t.member_types.map((_, i) => i))\n  )\n  .beforeAllSubcases(t => {\n    if (t.params.member_types.includes('f16')) {\n      t.selectDeviceOrSkipTestCase('shader-f16');\n    }\n  })\n  .fn(async t => {\n    const memberType = Type[t.params.member_types[t.params.member_index]];\n    const builder = basicExpressionBuilder(_ =>\n      t.params.nested\n        ? `OuterStruct().inner.member_${t.params.member_index}`\n        : `MyStruct().member_${t.params.member_index}`\n    );\n    await run(\n      t,\n      (params: ShaderBuilderParams) => {\n        return `\n${t.params.member_types.includes('f16') ? 'enable f16;' : ''}\n\n${builder(params)}\n\nstruct MyStruct {\n${t.params.member_types.map((ty, i) => `  member_${i} : ${ty},`).join('\\n')}\n};\nstruct OuterStruct {\n  pre : i32,\n  inner : MyStruct,\n  post : i32,\n};\n`;\n      },\n      [],\n      memberType,\n      { inputSource: 'const' },\n      [{ input: [], expected: memberType.create(0) }]\n    );\n  });\n"],"mappings":"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"}