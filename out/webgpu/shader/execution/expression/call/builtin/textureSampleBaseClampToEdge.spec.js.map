{"version":3,"file":"textureSampleBaseClampToEdge.spec.js","names":["description","makeTestGroup","checkCallResults","createTextureWithRandomDataAndGetTexels","createVideoFrameWithRandomDataAndGetTexels","doTextureCalls","generateTextureBuiltinInputs2D","kSamplePointMethods","WGSLTextureSampleTest","g","createTextureAndDataForTest","t","descriptor","isExternal","texels","videoFrame","size","texture","device","importExternalTexture","source","test","specURL","desc","params","u","combine","beginSubcases","beforeAllSubcases","skipIf","textureType","VideoFrame","fn","samplePoints","addressModeU","addressModeV","minFilter","format","usage","GPUTextureUsage","COPY_DST","TEXTURE_BINDING","mipLevelCount","sampler","magFilter","mipmapFilter","calls","method","hashInputs","map","coords","builtin","coordType","viewDescriptor","results","res","expectOK","close"],"sources":["../../../../../../../src/webgpu/shader/execution/expression/call/builtin/textureSampleBaseClampToEdge.spec.ts"],"sourcesContent":["export const description = `\nExecution tests for textureSampleBaseClampToEdge\n`;\n\nimport { makeTestGroup } from '../../../../../../common/framework/test_group.js';\nimport { GPUTest } from '../../../../../gpu_test.js';\nimport { TexelView } from '../../../../../util/texture/texel_view.js';\n\nimport {\n  checkCallResults,\n  createTextureWithRandomDataAndGetTexels,\n  createVideoFrameWithRandomDataAndGetTexels,\n  doTextureCalls,\n  generateTextureBuiltinInputs2D,\n  kSamplePointMethods,\n  TextureCall,\n  vec2,\n  WGSLTextureSampleTest,\n} from './texture_utils.js';\n\nexport const g = makeTestGroup(WGSLTextureSampleTest);\n\nasync function createTextureAndDataForTest(\n  t: GPUTest,\n  descriptor: GPUTextureDescriptor,\n  isExternal: boolean\n): Promise<{\n  texels: TexelView[];\n  texture: GPUTexture | GPUExternalTexture;\n  videoFrame?: VideoFrame;\n}> {\n  if (isExternal) {\n    const { texels, videoFrame } = createVideoFrameWithRandomDataAndGetTexels(descriptor.size);\n    const texture = t.device.importExternalTexture({ source: videoFrame });\n    return { texels, texture, videoFrame };\n  } else {\n    return await createTextureWithRandomDataAndGetTexels(t, descriptor);\n  }\n}\n\ng.test('2d_coords')\n  .specURL('https://www.w3.org/TR/WGSL/#texturesamplebaseclamptoedge')\n  .desc(\n    `\nfn textureSampleBaseClampToEdge(t: texture_2d<f32>, s: sampler, coords: vec2<f32>) -> vec4<f32>\nfn textureSampleBaseClampToEdge(t: texture_external, s: sampler, coords: vec2<f32>) -> vec4<f32>\n\n\nParameters:\n * t  The texture to sample.\n * s  The sampler type.\n * coords The texture coordinates used for sampling.\n`\n  )\n  .params(u =>\n    u\n      .combine('textureType', ['texture_2d<f32>', 'texture_external'] as const)\n      .beginSubcases()\n      .combine('samplePoints', kSamplePointMethods)\n      .combine('addressModeU', ['clamp-to-edge', 'repeat', 'mirror-repeat'] as const)\n      .combine('addressModeV', ['clamp-to-edge', 'repeat', 'mirror-repeat'] as const)\n      .combine('minFilter', ['nearest', 'linear'] as const)\n  )\n  .beforeAllSubcases(t =>\n    t.skipIf(\n      t.params.textureType === 'texture_external' && typeof VideoFrame === 'undefined',\n      'VideoFrames are not supported'\n    )\n  )\n  .fn(async t => {\n    const { textureType, samplePoints, addressModeU, addressModeV, minFilter } = t.params;\n\n    const descriptor: GPUTextureDescriptor = {\n      format: 'rgba8unorm',\n      size: [8, 8],\n      usage: GPUTextureUsage.COPY_DST | GPUTextureUsage.TEXTURE_BINDING,\n      mipLevelCount: 3,\n    };\n\n    const isExternal = textureType === 'texture_external';\n    const { texture, texels, videoFrame } = await createTextureAndDataForTest(\n      t,\n      descriptor,\n      isExternal\n    );\n    try {\n      const sampler: GPUSamplerDescriptor = {\n        addressModeU,\n        addressModeV,\n        minFilter,\n        magFilter: minFilter,\n        mipmapFilter: minFilter,\n      };\n\n      const calls: TextureCall<vec2>[] = generateTextureBuiltinInputs2D(50, {\n        method: samplePoints,\n        sampler,\n        descriptor,\n        hashInputs: [samplePoints, addressModeU, addressModeV, minFilter],\n      }).map(({ coords }) => {\n        return {\n          builtin: 'textureSampleBaseClampToEdge',\n          coordType: 'f',\n          coords,\n        };\n      });\n      const viewDescriptor = {};\n      const results = await doTextureCalls(t, texture, viewDescriptor, textureType, sampler, calls);\n      const res = await checkCallResults(\n        t,\n        { texels, descriptor, viewDescriptor },\n        textureType,\n        sampler,\n        calls,\n        results\n      );\n      t.expectOK(res);\n    } finally {\n      videoFrame?.close();\n    }\n  });\n"],"mappings":"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"}