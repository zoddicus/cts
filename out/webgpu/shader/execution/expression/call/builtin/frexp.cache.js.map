{"version":3,"file":"frexp.cache.js","names":["skipUndefined","i32","toVector","FP","frexp","makeCaseCache","makeCaseFract","v","trait","fp","toInput","toOutput","Array","n","scalarBuilder","map","quantize","some","e","isSubnormal","input","expected","undefined","fs","fract","makeCaseExp","exp","vec_cases","flatMap","dim","portion","vectorRange","reduce","a","b","scalar_cases","scalarRange","d"],"sources":["../../../../../../../src/webgpu/shader/execution/expression/call/builtin/frexp.cache.ts"],"sourcesContent":["import { skipUndefined } from '../../../../../util/compare.js';\nimport { Scalar, Vector, i32, toVector } from '../../../../../util/conversion.js';\nimport { FP } from '../../../../../util/floating_point.js';\nimport { frexp } from '../../../../../util/math.js';\nimport { Case } from '../../case.js';\nimport { makeCaseCache } from '../../case_cache.js';\n\n/* @returns a fract Case for a given scalar or vector input */\nfunction makeCaseFract(v: number | readonly number[], trait: 'f32' | 'f16'): Case {\n  const fp = FP[trait];\n  let toInput: (n: readonly number[]) => Scalar | Vector;\n  let toOutput: (n: readonly number[]) => Scalar | Vector;\n  if (v instanceof Array) {\n    // Input is vector\n    toInput = (n: readonly number[]) => toVector(n, fp.scalarBuilder);\n    toOutput = (n: readonly number[]) => toVector(n, fp.scalarBuilder);\n  } else {\n    // Input is scalar, also wrap it in an array.\n    v = [v];\n    toInput = (n: readonly number[]) => fp.scalarBuilder(n[0]);\n    toOutput = (n: readonly number[]) => fp.scalarBuilder(n[0]);\n  }\n\n  v = v.map(fp.quantize);\n  if (v.some(e => e !== 0 && fp.isSubnormal(e))) {\n    return { input: toInput(v), expected: skipUndefined(undefined) };\n  }\n\n  const fs = v.map(e => {\n    return frexp(e, trait).fract;\n  });\n\n  return { input: toInput(v), expected: toOutput(fs) };\n}\n\n/* @returns an exp Case for a given scalar or vector input */\nfunction makeCaseExp(v: number | readonly number[], trait: 'f32' | 'f16'): Case {\n  const fp = FP[trait];\n  let toInput: (n: readonly number[]) => Scalar | Vector;\n  let toOutput: (n: readonly number[]) => Scalar | Vector;\n  if (v instanceof Array) {\n    // Input is vector\n    toInput = (n: readonly number[]) => toVector(n, fp.scalarBuilder);\n    toOutput = (n: readonly number[]) => toVector(n, i32);\n  } else {\n    // Input is scalar, also wrap it in an array.\n    v = [v];\n    toInput = (n: readonly number[]) => fp.scalarBuilder(n[0]);\n    toOutput = (n: readonly number[]) => i32(n[0]);\n  }\n\n  v = v.map(fp.quantize);\n  if (v.some(e => e !== 0 && fp.isSubnormal(e))) {\n    return { input: toInput(v), expected: skipUndefined(undefined) };\n  }\n\n  const fs = v.map(e => {\n    return frexp(e, trait).exp;\n  });\n\n  return { input: toInput(v), expected: toOutput(fs) };\n}\n\n// Cases: [f32|f16]_vecN_[exp|whole]\nconst vec_cases = (['f32', 'f16'] as const)\n  .flatMap(trait =>\n    ([2, 3, 4] as const).flatMap(dim =>\n      (['exp', 'fract'] as const).map(portion => ({\n        [`${trait}_vec${dim}_${portion}`]: () => {\n          return FP[trait]\n            .vectorRange(dim)\n            .map(v => (portion === 'exp' ? makeCaseExp(v, trait) : makeCaseFract(v, trait)));\n        },\n      }))\n    )\n  )\n  .reduce((a, b) => ({ ...a, ...b }), {});\n\n// Cases: [f32|f16]_[exp|whole]\nconst scalar_cases = (['f32', 'f16'] as const)\n  .flatMap(trait =>\n    (['exp', 'fract'] as const).map(portion => ({\n      [`${trait}_${portion}`]: () => {\n        return FP[trait]\n          .scalarRange()\n          .map(v => (portion === 'exp' ? makeCaseExp(v, trait) : makeCaseFract(v, trait)));\n      },\n    }))\n  )\n  .reduce((a, b) => ({ ...a, ...b }), {});\n\nexport const d = makeCaseCache('frexp', {\n  ...scalar_cases,\n  ...vec_cases,\n});\n"],"mappings":"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"}