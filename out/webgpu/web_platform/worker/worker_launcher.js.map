{"version":3,"file":"worker_launcher.js","names":["SkipTestCase","getDefaultRequestAdapterOptions","launchDedicatedWorker","Worker","globalThis","constructor","name","selfPath","import","meta","url","selfPathDir","substring","lastIndexOf","workerPath","worker","type","promise","Promise","resolve","addEventListener","ev","data","once","postMessage","defaultRequestAdapterOptions","launchSharedWorker","SharedWorker","port","start","launchServiceWorker","navigator","serviceWorker","serviceWorkerPath","registration","register","update","unregister","active"],"sources":["../../../../src/webgpu/web_platform/worker/worker_launcher.ts"],"sourcesContent":["import { SkipTestCase } from '../../../common/framework/fixture.js';\nimport { getDefaultRequestAdapterOptions } from '../../../common/util/navigator_gpu.js';\n\nexport type TestResult = {\n  error: String | undefined;\n};\n\nexport async function launchDedicatedWorker() {\n  if (typeof Worker === 'undefined') {\n    throw new SkipTestCase(`Worker undefined in context ${globalThis.constructor.name}`);\n  }\n\n  const selfPath = import.meta.url;\n  const selfPathDir = selfPath.substring(0, selfPath.lastIndexOf('/'));\n  const workerPath = selfPathDir + '/worker.js';\n  const worker = new Worker(workerPath, { type: 'module' });\n\n  const promise = new Promise<TestResult>(resolve => {\n    worker.addEventListener('message', ev => resolve(ev.data as TestResult), { once: true });\n  });\n  worker.postMessage({ defaultRequestAdapterOptions: getDefaultRequestAdapterOptions() });\n  return await promise;\n}\n\nexport async function launchSharedWorker() {\n  if (typeof SharedWorker === 'undefined') {\n    throw new SkipTestCase(`SharedWorker undefined in context ${globalThis.constructor.name}`);\n  }\n\n  const selfPath = import.meta.url;\n  const selfPathDir = selfPath.substring(0, selfPath.lastIndexOf('/'));\n  const workerPath = selfPathDir + '/worker.js';\n  const worker = new SharedWorker(workerPath, { type: 'module' });\n\n  const port = worker.port;\n  const promise = new Promise<TestResult>(resolve => {\n    port.addEventListener('message', ev => resolve(ev.data as TestResult), { once: true });\n  });\n  port.start();\n  port.postMessage({\n    defaultRequestAdapterOptions: getDefaultRequestAdapterOptions(),\n  });\n  return await promise;\n}\n\nexport async function launchServiceWorker() {\n  if (typeof navigator === 'undefined' || typeof navigator.serviceWorker === 'undefined') {\n    throw new SkipTestCase(\n      `navigator.serviceWorker undefined in context ${globalThis.constructor.name}`\n    );\n  }\n\n  const selfPath = import.meta.url;\n  const selfPathDir = selfPath.substring(0, selfPath.lastIndexOf('/'));\n  const serviceWorkerPath = selfPathDir + '/worker.js';\n  const registration = await navigator.serviceWorker.register(serviceWorkerPath, {\n    type: 'module',\n  });\n  await registration.update();\n\n  const promise = new Promise<TestResult>(resolve => {\n    navigator.serviceWorker.addEventListener(\n      'message',\n      ev => {\n        resolve(ev.data as TestResult);\n        void registration.unregister();\n      },\n      { once: true }\n    );\n  });\n  registration.active?.postMessage({\n    defaultRequestAdapterOptions: getDefaultRequestAdapterOptions(),\n  });\n  return await promise;\n}\n"],"mappings":"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"}