{"version":3,"file":"util.js","names":["SkipTestCase","getResourcePath","makeTable","timeout","ErrorWithExtra","raceWithRejectOnTimeout","kVideoInfo","undefined","kBt601PixelValue","red","Float32Array","green","blue","yellow","convertToUnorm8","expectation","unorm8","Uint8ClampedArray","length","i","Math","round","Uint8Array","buffer","kBt601Red","kBt601Green","kBt601Blue","kBt601Yellow","kVideoExpectations","videoName","_redExpectation","_greenExpectation","_blueExpectation","_yellowExpectation","kVideoRotationExpectations","_topLeftExpectation","_topRightExpectation","_bottomLeftExpectation","_bottomRightExpectation","startPlayingAndWaitForVideo","video","callback","Promise","resolve","reject","callbackAndResolve","ex","error","message","addEventListener","event","requestVideoFrameCallback","timeWatcher","currentTime","requestAnimationFrame","loop","muted","preload","play","catch","waitForNextTask","promise","callbackHelper","waitForNextFrame","getVideoFrameFromVideoElement","test","captureStream","skip","videoTrack","getVideoTracks","trackProcessor","MediaStreamTrackProcessor","track","transformer","TransformStream","transform","videoFrame","controller","stop","flush","terminate","trackGenerator","MediaStreamTrackGenerator","kind","readable","pipeThrough","pipeTo","writable","getVideoElement","t","videoElement","document","createElement","videoInfo","canPlayType","mimeType","videoUrl","src","timeoutMessage","promiseWithoutTimeout"],"sources":["../../../src/webgpu/web_platform/util.ts"],"sourcesContent":["import { Fixture, SkipTestCase } from '../../common/framework/fixture.js';\nimport { getResourcePath } from '../../common/framework/resources.js';\nimport { makeTable } from '../../common/util/data_tables.js';\nimport { timeout } from '../../common/util/timeout.js';\nimport { ErrorWithExtra, raceWithRejectOnTimeout } from '../../common/util/util.js';\nimport { GPUTest } from '../gpu_test.js';\n\ndeclare global {\n  interface HTMLMediaElement {\n    // Add captureStream() support for HTMLMediaElement from\n    // https://w3c.github.io/mediacapture-fromelement/#dom-htmlmediaelement-capturestream\n    captureStream(): MediaStream;\n  }\n}\n\nexport const kVideoInfo = /* prettier-ignore */ makeTable(\n  ['mimeType'] as const,\n  [undefined] as const, {\n// All video names\n'four-colors-vp8-bt601.webm'  : ['video/webm; codecs=vp8'],\n'four-colors-theora-bt601.ogv': ['video/ogg; codecs=theora'],\n'four-colors-h264-bt601.mp4'  : ['video/mp4; codecs=avc1.4d400c'],\n'four-colors-vp9-bt601.webm'  : ['video/webm; codecs=vp9'],\n'four-colors-vp9-bt709.webm'  : ['video/webm; codecs=vp9'],\n'four-colors-vp9-bt2020.webm' : ['video/webm; codecs=vp9'],\n'four-colors-h264-bt601-rotate-90.mp4'  : ['video/mp4; codecs=avc1.4d400c'],\n'four-colors-h264-bt601-rotate-180.mp4'  : ['video/mp4; codecs=avc1.4d400c'],\n'four-colors-h264-bt601-rotate-270.mp4'  : ['video/mp4; codecs=avc1.4d400c']\n} as const);\nexport type VideoName = keyof typeof kVideoInfo;\n\n// Expectation values about converting video contents to sRGB color space.\n// Source video color space affects expected values.\n// The process to calculate these expected pixel values can be found:\n// https://github.com/gpuweb/cts/pull/2242#issuecomment-1430382811\n// and https://github.com/gpuweb/cts/pull/2242#issuecomment-1463273434\nconst kBt601PixelValue = {\n  red: new Float32Array([0.972945567233341, 0.141794376683341, -0.0209589916711088, 1.0]),\n  green: new Float32Array([0.248234279433399, 0.984810378661784, -0.0564701319494314, 1.0]),\n  blue: new Float32Array([0.10159735826538, 0.135451122863674, 1.00262982899724, 1.0]),\n  yellow: new Float32Array([0.995470750775951, 0.992742114518355, -0.0774291236205402, 1.0]),\n};\n\nfunction convertToUnorm8(expectation: Float32Array): Uint8Array {\n  const unorm8 = new Uint8ClampedArray(expectation.length);\n\n  for (let i = 0; i < expectation.length; ++i) {\n    unorm8[i] = Math.round(expectation[i] * 255.0);\n  }\n\n  return new Uint8Array(unorm8.buffer);\n}\n\n// kVideoExpectations uses unorm8 results\nconst kBt601Red = convertToUnorm8(kBt601PixelValue.red);\nconst kBt601Green = convertToUnorm8(kBt601PixelValue.green);\nconst kBt601Blue = convertToUnorm8(kBt601PixelValue.blue);\nconst kBt601Yellow = convertToUnorm8(kBt601PixelValue.yellow);\n\nexport const kVideoExpectations = [\n  {\n    videoName: 'four-colors-vp8-bt601.webm',\n    _redExpectation: kBt601Red,\n    _greenExpectation: kBt601Green,\n    _blueExpectation: kBt601Blue,\n    _yellowExpectation: kBt601Yellow,\n  },\n  {\n    videoName: 'four-colors-theora-bt601.ogv',\n    _redExpectation: kBt601Red,\n    _greenExpectation: kBt601Green,\n    _blueExpectation: kBt601Blue,\n    _yellowExpectation: kBt601Yellow,\n  },\n  {\n    videoName: 'four-colors-h264-bt601.mp4',\n    _redExpectation: kBt601Red,\n    _greenExpectation: kBt601Green,\n    _blueExpectation: kBt601Blue,\n    _yellowExpectation: kBt601Yellow,\n  },\n  {\n    videoName: 'four-colors-vp9-bt601.webm',\n    _redExpectation: kBt601Red,\n    _greenExpectation: kBt601Green,\n    _blueExpectation: kBt601Blue,\n    _yellowExpectation: kBt601Yellow,\n  },\n  {\n    videoName: 'four-colors-vp9-bt709.webm',\n    _redExpectation: new Uint8Array([255, 0, 0, 255]),\n    _greenExpectation: new Uint8Array([0, 255, 0, 255]),\n    _blueExpectation: new Uint8Array([0, 0, 255, 255]),\n    _yellowExpectation: new Uint8Array([255, 255, 0, 255]),\n  },\n] as const;\n\nexport const kVideoRotationExpectations = [\n  {\n    videoName: 'four-colors-h264-bt601-rotate-90.mp4',\n    _topLeftExpectation: kBt601Red,\n    _topRightExpectation: kBt601Green,\n    _bottomLeftExpectation: kBt601Yellow,\n    _bottomRightExpectation: kBt601Blue,\n  },\n  {\n    videoName: 'four-colors-h264-bt601-rotate-180.mp4',\n    _topLeftExpectation: kBt601Green,\n    _topRightExpectation: kBt601Blue,\n    _bottomLeftExpectation: kBt601Red,\n    _bottomRightExpectation: kBt601Yellow,\n  },\n  {\n    videoName: 'four-colors-h264-bt601-rotate-270.mp4',\n    _topLeftExpectation: kBt601Blue,\n    _topRightExpectation: kBt601Yellow,\n    _bottomLeftExpectation: kBt601Green,\n    _bottomRightExpectation: kBt601Red,\n  },\n] as const;\n\n/**\n * Starts playing a video and waits for it to be consumable.\n * Returns a promise which resolves after `callback` (which may be async) completes.\n *\n * @param video An HTML5 Video element.\n * @param callback Function to call when video is ready.\n *\n * Adapted from https://github.com/KhronosGroup/WebGL/blob/main/sdk/tests/js/webgl-test-utils.js\n */\nexport function startPlayingAndWaitForVideo(\n  video: HTMLVideoElement,\n  callback: () => unknown | Promise<unknown>\n): Promise<void> {\n  return raceWithRejectOnTimeout(\n    new Promise((resolve, reject) => {\n      const callbackAndResolve = () =>\n        void (async () => {\n          try {\n            await callback();\n            resolve();\n          } catch (ex) {\n            reject();\n          }\n        })();\n      if (video.error) {\n        reject(\n          new ErrorWithExtra('Video.error: ' + video.error.message, () => ({ error: video.error }))\n        );\n        return;\n      }\n\n      video.addEventListener(\n        'error',\n        event => reject(new ErrorWithExtra('Video received \"error\" event', () => ({ event }))),\n        true\n      );\n\n      if ('requestVideoFrameCallback' in video) {\n        video.requestVideoFrameCallback(() => {\n          callbackAndResolve();\n        });\n      } else {\n        // If requestVideoFrameCallback isn't available, check each frame if the video has advanced.\n        const timeWatcher = () => {\n          if (video.currentTime > 0) {\n            callbackAndResolve();\n          } else {\n            requestAnimationFrame(timeWatcher);\n          }\n        };\n        timeWatcher();\n      }\n\n      video.loop = true;\n      video.muted = true;\n      video.preload = 'auto';\n      video.play().catch(reject);\n    }),\n    2000,\n    'Video never became ready'\n  );\n}\n\n/**\n * Fire a `callback` when the script animation reaches a new frame.\n * Returns a promise which resolves after `callback` (which may be async) completes.\n */\nexport function waitForNextTask(callback: () => unknown | Promise<unknown>): Promise<void> {\n  const { promise, callbackAndResolve } = callbackHelper(callback, 'wait for next task timed out');\n  timeout(() => {\n    callbackAndResolve();\n  }, 0);\n\n  return promise;\n}\n\n/**\n * Fire a `callback` when the video reaches a new frame.\n * Returns a promise which resolves after `callback` (which may be async) completes.\n *\n * MAINTENANCE_TODO: Find a way to implement this for browsers without requestVideoFrameCallback as\n * well, similar to the timeWatcher path in startPlayingAndWaitForVideo. If that path is proven to\n * work well, we can consider getting rid of the requestVideoFrameCallback path.\n */\nexport function waitForNextFrame(\n  video: HTMLVideoElement,\n  callback: () => unknown | Promise<unknown>\n): Promise<void> {\n  const { promise, callbackAndResolve } = callbackHelper(callback, 'waitForNextFrame timed out');\n\n  if ('requestVideoFrameCallback' in video) {\n    video.requestVideoFrameCallback(() => {\n      callbackAndResolve();\n    });\n  } else {\n    throw new SkipTestCase('waitForNextFrame currently requires requestVideoFrameCallback');\n  }\n\n  return promise;\n}\n\nexport async function getVideoFrameFromVideoElement(\n  test: Fixture,\n  video: HTMLVideoElement\n): Promise<VideoFrame> {\n  if (video.captureStream === undefined) {\n    test.skip('HTMLVideoElement.captureStream is not supported');\n  }\n\n  return raceWithRejectOnTimeout(\n    new Promise<VideoFrame>((resolve, reject) => {\n      const videoTrack: MediaStreamVideoTrack = video.captureStream().getVideoTracks()[0];\n      const trackProcessor: MediaStreamTrackProcessor<VideoFrame> = new MediaStreamTrackProcessor({\n        track: videoTrack,\n      });\n      const transformer: TransformStream = new TransformStream({\n        transform(videoFrame, controller) {\n          videoTrack.stop();\n          resolve(videoFrame);\n        },\n        flush(controller) {\n          controller.terminate();\n        },\n      });\n      const trackGenerator: MediaStreamTrackGenerator<VideoFrame> = new MediaStreamTrackGenerator({\n        kind: 'video',\n      });\n      trackProcessor.readable\n        .pipeThrough(transformer)\n        .pipeTo(trackGenerator.writable)\n        .catch(() => {});\n    }),\n    2000,\n    'Video never became ready'\n  );\n}\n\n/**\n * Create HTMLVideoElement based on VideoName. Check whether video is playable in current\n * browser environment.\n * Returns a HTMLVideoElement.\n *\n * @param t: GPUTest that requires getting HTMLVideoElement\n * @param videoName: Required video name\n *\n */\nexport function getVideoElement(t: GPUTest, videoName: VideoName): HTMLVideoElement {\n  const videoElement = document.createElement('video');\n  const videoInfo = kVideoInfo[videoName];\n\n  if (videoElement.canPlayType(videoInfo.mimeType) === '') {\n    t.skip('Video codec is not supported');\n  }\n\n  const videoUrl = getResourcePath(videoName);\n  videoElement.src = videoUrl;\n\n  return videoElement;\n}\n\n/**\n * Helper for doing something inside of a (possibly async) callback (directly, not in a following\n * microtask), and returning a promise when the callback is done.\n * MAINTENANCE_TODO: Use this in startPlayingAndWaitForVideo (and make sure it works).\n */\nfunction callbackHelper(\n  callback: () => unknown | Promise<unknown>,\n  timeoutMessage: string\n): { promise: Promise<void>; callbackAndResolve: () => void } {\n  let callbackAndResolve: () => void;\n\n  const promiseWithoutTimeout = new Promise<void>((resolve, reject) => {\n    callbackAndResolve = () =>\n      void (async () => {\n        try {\n          await callback(); // catches both exceptions and rejections\n          resolve();\n        } catch (ex) {\n          reject(ex);\n        }\n      })();\n  });\n  const promise = raceWithRejectOnTimeout(promiseWithoutTimeout, 2000, timeoutMessage);\n  return { promise, callbackAndResolve: callbackAndResolve! };\n}\n"],"mappings":"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"}