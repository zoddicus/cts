{"version":3,"file":"print_environment.spec.js","names":["description","getResourcePath","globalTestConfig","makeTestGroup","getDefaultRequestAdapterOptions","GPUTest","g","consoleLogIfNotWPT","x","globalThis","cons","console","log","test","desc","fn","t","isCompatibilityMode","adapter","info","JSON","stringify","userAgent","navigator","globalScope","Object","getPrototypeOf","constructor","name","baseResourcePath","defaultRequestAdapterOptions","isFallbackAdapter","features","Array","from","limits","_key","value","undefined","valueObj","fromEntries","key"],"sources":["../../src/webgpu/print_environment.spec.ts"],"sourcesContent":["export const description = `\n\nExamples of writing CTS tests with various features.\n\nStart here when looking for examples of basic framework usage.\n`;\n\nimport { getResourcePath } from '../common/framework/resources.js';\nimport { globalTestConfig } from '../common/framework/test_config.js';\nimport { makeTestGroup } from '../common/framework/test_group.js';\nimport { getDefaultRequestAdapterOptions } from '../common/util/navigator_gpu.js';\n\nimport { GPUTest } from './gpu_test.js';\n\nexport const g = makeTestGroup(GPUTest);\n\n/** console.log is disallowed by WPT. Work around it when we're not in WPT. */\nfunction consoleLogIfNotWPT(x: unknown) {\n  if (!('step_timeout' in globalThis)) {\n    const cons = console;\n    cons.log(x);\n  }\n}\n\ng.test('info')\n  .desc(\n    `Test which prints what global scope (e.g. worker type) it's running in.\nTypically, tests will check for the presence of the feature they need (like HTMLCanvasElement)\nand skip if it's not available.\n\nRun this test under various configurations to see different results\n(Window, worker scopes, Node, etc.)\n\nNOTE: If your test runtime elides logs when tests pass, you won't see the prints from this test\nin the logs. On non-WPT runtimes, it will also print to the console with console.log.\nWPT disallows console.log and doesn't support logs on passing tests, so this does nothing on WPT.`\n  )\n  .fn(t => {\n    const isCompatibilityMode = (t.adapter as unknown as { isCompatibilityMode?: boolean })\n      .isCompatibilityMode;\n\n    const info = JSON.stringify(\n      {\n        userAgent: navigator.userAgent,\n        globalScope: Object.getPrototypeOf(globalThis).constructor.name,\n        globalTestConfig,\n        baseResourcePath: getResourcePath(''),\n        defaultRequestAdapterOptions: getDefaultRequestAdapterOptions(),\n        adapter: {\n          isFallbackAdapter: t.adapter.isFallbackAdapter,\n          isCompatibilityMode,\n          info: t.adapter.info,\n          features: Array.from(t.adapter.features),\n          limits: t.adapter.limits,\n        },\n      },\n      // Flatten objects with prototype chains into plain objects, using `for..in`. (Otherwise,\n      // properties from the prototype chain will be ignored and things will print as `{}`.)\n      (_key, value) => {\n        if (value === undefined || value === null) return null;\n        if (typeof value !== 'object') return value;\n        if (value instanceof Array) return value;\n\n        const valueObj = value as Record<string, unknown>;\n        return Object.fromEntries(\n          (function* () {\n            for (const key in valueObj) {\n              yield [key, valueObj[key]];\n            }\n          })()\n        );\n      },\n      2\n    );\n\n    t.info(info);\n    consoleLogIfNotWPT(info);\n  });\n"],"mappings":";;GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA;AACA;AACA;AACA,CAAC,CAED,SAASC,eAAe,QAAQ,kCAAkC;AAClE,SAASC,gBAAgB,QAAQ,oCAAoC;AACrE,SAASC,aAAa,QAAQ,mCAAmC;AACjE,SAASC,+BAA+B,QAAQ,iCAAiC;;AAEjF,SAASC,OAAO,QAAQ,eAAe;;AAEvC,OAAO,MAAMC,CAAC,GAAGH,aAAa,CAACE,OAAO,CAAC;;AAEvC;AACA,SAASE,kBAAkBA,CAACC,CAAU,EAAE;EACtC,IAAI,EAAE,cAAc,IAAIC,UAAU,CAAC,EAAE;IACnC,MAAMC,IAAI,GAAGC,OAAO;IACpBD,IAAI,CAACE,GAAG,CAACJ,CAAC,CAAC;EACb;AACF;;AAEAF,CAAC,CAACO,IAAI,CAAC,MAAM,CAAC;AACXC,IAAI;EACF;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACE,CAAC;AACAC,EAAE,CAAC,CAAAC,CAAC,KAAI;EACP,MAAMC,mBAAmB,GAAID,CAAC,CAACE,OAAO;EACnCD,mBAAmB;;EAEtB,MAAME,IAAI,GAAGC,IAAI,CAACC,SAAS;IACzB;MACEC,SAAS,EAAEC,SAAS,CAACD,SAAS;MAC9BE,WAAW,EAAEC,MAAM,CAACC,cAAc,CAACjB,UAAU,CAAC,CAACkB,WAAW,CAACC,IAAI;MAC/D1B,gBAAgB;MAChB2B,gBAAgB,EAAE5B,eAAe,CAAC,EAAE,CAAC;MACrC6B,4BAA4B,EAAE1B,+BAA+B,CAAC,CAAC;MAC/Dc,OAAO,EAAE;QACPa,iBAAiB,EAAEf,CAAC,CAACE,OAAO,CAACa,iBAAiB;QAC9Cd,mBAAmB;QACnBE,IAAI,EAAEH,CAAC,CAACE,OAAO,CAACC,IAAI;QACpBa,QAAQ,EAAEC,KAAK,CAACC,IAAI,CAAClB,CAAC,CAACE,OAAO,CAACc,QAAQ,CAAC;QACxCG,MAAM,EAAEnB,CAAC,CAACE,OAAO,CAACiB;MACpB;IACF,CAAC;IACD;IACA;IACA,CAACC,IAAI,EAAEC,KAAK,KAAK;MACf,IAAIA,KAAK,KAAKC,SAAS,IAAID,KAAK,KAAK,IAAI,EAAE,OAAO,IAAI;MACtD,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE,OAAOA,KAAK;MAC3C,IAAIA,KAAK,YAAYJ,KAAK,EAAE,OAAOI,KAAK;;MAExC,MAAME,QAAQ,GAAGF,KAAgC;MACjD,OAAOZ,MAAM,CAACe,WAAW;QACtB,aAAa;UACZ,KAAK,MAAMC,GAAG,IAAIF,QAAQ,EAAE;YAC1B,MAAM,CAACE,GAAG,EAAEF,QAAQ,CAACE,GAAG,CAAC,CAAC;UAC5B;QACF,CAAC,CAAE;MACL,CAAC;IACH,CAAC;IACD;EACF,CAAC;;EAEDzB,CAAC,CAACG,IAAI,CAACA,IAAI,CAAC;EACZZ,kBAAkB,CAACY,IAAI,CAAC;AAC1B,CAAC,CAAC"}