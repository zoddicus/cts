{"version":3,"file":"websocket_logger.js","names":["connection","logToWebsocket","msg","Promise","resolve","WebSocket","ws","onopen","onerror","onclose","then","resolved","send"],"sources":["../../../src/common/internal/websocket_logger.ts"],"sourcesContent":["/**\n * - 'uninitialized' means we haven't tried to connect yet\n * - Promise means it's pending\n * - 'failed' means it failed (this is the most common case, where the logger isn't running)\n * - WebSocket means it succeeded\n */\nlet connection: Promise<WebSocket | 'failed'> | WebSocket | 'failed' | 'uninitialized' =\n  'uninitialized';\n\n/**\n * Log a string to a websocket at `localhost:59497`. See `tools/websocket-logger`.\n *\n * This does nothing if a connection couldn't be established on the first call.\n */\nexport function logToWebsocket(msg: string) {\n  if (connection === 'failed') {\n    return;\n  }\n\n  if (connection === 'uninitialized') {\n    connection = new Promise(resolve => {\n      if (typeof WebSocket === 'undefined') {\n        resolve('failed');\n        return;\n      }\n\n      const ws = new WebSocket('ws://localhost:59497/optional_cts_websocket_logger');\n      ws.onopen = () => {\n        resolve(ws);\n      };\n      ws.onerror = () => {\n        connection = 'failed';\n        resolve('failed');\n      };\n      ws.onclose = () => {\n        connection = 'failed';\n        resolve('failed');\n      };\n    });\n    void connection.then(resolved => {\n      connection = resolved;\n    });\n  }\n\n  void (async () => {\n    // connection may be a promise or a value here. Either is OK to await.\n    const ws = await connection;\n    if (ws !== 'failed') {\n      ws.send(msg);\n    }\n  })();\n}\n"],"mappings":";;IAAA;AACA;AACA;AACA;AACA;AACA,GACA,IAAIA,UAAkF,GACpF,eAAe;;AAEjB;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,cAAcA,CAACC,GAAW,EAAE;EAC1C,IAAIF,UAAU,KAAK,QAAQ,EAAE;IAC3B;EACF;;EAEA,IAAIA,UAAU,KAAK,eAAe,EAAE;IAClCA,UAAU,GAAG,IAAIG,OAAO,CAAC,CAAAC,OAAO,KAAI;MAClC,IAAI,OAAOC,SAAS,KAAK,WAAW,EAAE;QACpCD,OAAO,CAAC,QAAQ,CAAC;QACjB;MACF;;MAEA,MAAME,EAAE,GAAG,IAAID,SAAS,CAAC,oDAAoD,CAAC;MAC9EC,EAAE,CAACC,MAAM,GAAG,MAAM;QAChBH,OAAO,CAACE,EAAE,CAAC;MACb,CAAC;MACDA,EAAE,CAACE,OAAO,GAAG,MAAM;QACjBR,UAAU,GAAG,QAAQ;QACrBI,OAAO,CAAC,QAAQ,CAAC;MACnB,CAAC;MACDE,EAAE,CAACG,OAAO,GAAG,MAAM;QACjBT,UAAU,GAAG,QAAQ;QACrBI,OAAO,CAAC,QAAQ,CAAC;MACnB,CAAC;IACH,CAAC,CAAC;IACF,KAAKJ,UAAU,CAACU,IAAI,CAAC,CAAAC,QAAQ,KAAI;MAC/BX,UAAU,GAAGW,QAAQ;IACvB,CAAC,CAAC;EACJ;;EAEA,KAAK,CAAC,YAAY;IAChB;IACA,MAAML,EAAE,GAAG,MAAMN,UAAU;IAC3B,IAAIM,EAAE,KAAK,QAAQ,EAAE;MACnBA,EAAE,CAACM,IAAI,CAACV,GAAG,CAAC;IACd;EACF,CAAC,EAAE,CAAC;AACN"}