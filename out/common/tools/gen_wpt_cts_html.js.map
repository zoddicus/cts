{"version":3,"file":"gen_wpt_cts_html.js","names":["promises","fs","path","DefaultTestFileLoader","TestQueryMultiCase","TestQueryMultiFile","TestQueryMultiTest","assert","kMaxQueryLength","printUsageAndExit","rc","console","error","process","exit","config","argv","length","configFile","configJSON","JSON","parse","readFile","jsonFileDir","dirname","suite","out","resolve","template","maxChunkTimeMS","Infinity","argumentsPrefixes","noLongPathAssert","outVariantList","expectations","file","prefix","fullyExpandSubtrees","_nodeBinary","_thisScript","outFile","templateFile","argsPrefixesFile","expectationsFile","expectationsPrefix","split","filter","a","useChunking","Number","isFinite","sort","b","loadQueryFile","fullyExpand","loader","lines","tooLongQueries","rootQuery","tree","loadTree","subqueriesToExpand","get","maxChunkTime","push","undefined","prefixComment","comment","filesSeen","Set","testsSeen","variantCount","alwaysExpandThroughLevel","query","subtreeCounts","iterateCollapsedNodes","queryString","toString","urlQueryString","totalTimeMS","toFixed","add","filePathParts","testPathParts","size","queryStrings","Map","forEach","s","colonNdx","lastIndexOf","substring","id","set","Error","padEnd","values","join","generateFile","catch","ex","log","stack","queryFile","l","result","expLoop","exp","argsPrefix","startsWith","variantList","line","writeFile","stringify"],"sources":["../../../src/common/tools/gen_wpt_cts_html.ts"],"sourcesContent":["import { promises as fs } from 'fs';\nimport * as path from 'path';\n\nimport { DefaultTestFileLoader } from '../internal/file_loader.js';\nimport {\n  TestQueryMultiCase,\n  TestQueryMultiFile,\n  TestQueryMultiTest,\n} from '../internal/query/query.js';\nimport { assert } from '../util/util.js';\n\nconst kMaxQueryLength = 184;\n\nfunction printUsageAndExit(rc: number): never {\n  console.error(`\\\nUsage (simple, for webgpu:* suite only):\n  tools/gen_wpt_cts_html OUTPUT_FILE TEMPLATE_FILE\n  tools/gen_wpt_cts_html out-wpt/cts.https.html templates/cts.https.html\n\nUsage (config file):\n  tools/gen_wpt_cts_html CONFIG_JSON_FILE\n\nwhere CONFIG_JSON_FILE is a JSON file in the format documented in the code of\ngen_wpt_cts_html.ts. Example:\n  {\n    \"suite\": \"webgpu\",\n    \"out\": \"path/to/output/cts.https.html\",\n    \"outJSON\": \"path/to/output/webgpu_variant_list.json\",\n    \"template\": \"path/to/template/cts.https.html\",\n    \"maxChunkTimeMS\": 2000\n  }\n\nUsage (advanced) (deprecated, use config file):\n  tools/gen_wpt_cts_html OUTPUT_FILE TEMPLATE_FILE ARGUMENTS_PREFIXES_FILE EXPECTATIONS_FILE EXPECTATIONS_PREFIX [SUITE]\n  tools/gen_wpt_cts_html my/path/to/cts.https.html templates/cts.https.html arguments.txt myexpectations.txt 'path/to/cts.https.html' cts\n\nwhere arguments.txt is a file containing a list of arguments prefixes to both generate and expect\nin the expectations. The entire variant list generation runs *once per prefix*, so this\nmultiplies the size of the variant list.\n\n  ?debug=0&q=\n  ?debug=1&q=\n\nand myexpectations.txt is a file containing a list of WPT paths to suppress, e.g.:\n\n  path/to/cts.https.html?debug=0&q=webgpu:a/foo:bar={\"x\":1}\n  path/to/cts.https.html?debug=1&q=webgpu:a/foo:bar={\"x\":1}\n\n  path/to/cts.https.html?debug=1&q=webgpu:a/foo:bar={\"x\":3}\n`);\n  process.exit(rc);\n}\n\ninterface ConfigJSON {\n  /** Test suite to generate from. */\n  suite: string;\n  /** Output path for HTML file, relative to config file. */\n  out: string;\n  /** Output path for JSON file containing the \"variant\" list, relative to config file. */\n  outVariantList?: string;\n  /** Input template filename, relative to config file. */\n  template: string;\n  /**\n   * Maximum time for a single WPT \"variant\" chunk, in milliseconds. Defaults to infinity.\n   *\n   * This data is typically captured by developers on higher-end computers, so typical test\n   * machines might execute more slowly. For this reason, use a time much less than 5 seconds\n   * (a typical default time limit in WPT test executors).\n   */\n  maxChunkTimeMS?: number;\n  /** List of argument prefixes (what comes before the test query). Defaults to `['?q=']`. */\n  argumentsPrefixes?: string[];\n  expectations?: {\n    /** File containing a list of WPT paths to suppress. */\n    file: string;\n    /** The prefix to trim from every line of the expectations_file. */\n    prefix: string;\n  };\n  /** Expend all subtrees for provided queries */\n  fullyExpandSubtrees?: {\n    file: string;\n    prefix: string;\n  };\n  /*No long path assert */\n  noLongPathAssert?: boolean;\n}\n\ninterface Config {\n  suite: string;\n  out: string;\n  outVariantList?: string;\n  template: string;\n  maxChunkTimeMS: number;\n  argumentsPrefixes: string[];\n  noLongPathAssert: boolean;\n  expectations?: {\n    file: string;\n    prefix: string;\n  };\n  fullyExpandSubtrees?: {\n    file: string;\n    prefix: string;\n  };\n}\n\nlet config: Config;\n\n(async () => {\n  // Load the config\n  switch (process.argv.length) {\n    case 3: {\n      const configFile = process.argv[2];\n      const configJSON: ConfigJSON = JSON.parse(await fs.readFile(configFile, 'utf8'));\n      const jsonFileDir = path.dirname(configFile);\n\n      config = {\n        suite: configJSON.suite,\n        out: path.resolve(jsonFileDir, configJSON.out),\n        template: path.resolve(jsonFileDir, configJSON.template),\n        maxChunkTimeMS: configJSON.maxChunkTimeMS ?? Infinity,\n        argumentsPrefixes: configJSON.argumentsPrefixes ?? ['?q='],\n        noLongPathAssert: configJSON.noLongPathAssert ?? false,\n      };\n      if (configJSON.outVariantList) {\n        config.outVariantList = path.resolve(jsonFileDir, configJSON.outVariantList);\n      }\n      if (configJSON.expectations) {\n        config.expectations = {\n          file: path.resolve(jsonFileDir, configJSON.expectations.file),\n          prefix: configJSON.expectations.prefix,\n        };\n      }\n      if (configJSON.fullyExpandSubtrees) {\n        config.fullyExpandSubtrees = {\n          file: path.resolve(jsonFileDir, configJSON.fullyExpandSubtrees.file),\n          prefix: configJSON.fullyExpandSubtrees.prefix,\n        };\n      }\n      break;\n    }\n    case 4:\n    case 7:\n    case 8: {\n      const [\n        _nodeBinary,\n        _thisScript,\n        outFile,\n        templateFile,\n        argsPrefixesFile,\n        expectationsFile,\n        expectationsPrefix,\n        suite = 'webgpu',\n      ] = process.argv;\n\n      config = {\n        out: outFile,\n        template: templateFile,\n        suite,\n        maxChunkTimeMS: Infinity,\n        argumentsPrefixes: ['?q='],\n        noLongPathAssert: false,\n      };\n      if (process.argv.length >= 7) {\n        config.argumentsPrefixes = (await fs.readFile(argsPrefixesFile, 'utf8'))\n          .split(/\\r?\\n/)\n          .filter(a => a.length);\n        config.expectations = {\n          file: expectationsFile,\n          prefix: expectationsPrefix,\n        };\n      }\n      break;\n    }\n    default:\n      console.error('incorrect number of arguments!');\n      printUsageAndExit(1);\n  }\n\n  const useChunking = Number.isFinite(config.maxChunkTimeMS);\n\n  // Sort prefixes from longest to shortest\n  config.argumentsPrefixes.sort((a, b) => b.length - a.length);\n\n  // Load expectations (if any)\n  const expectations: Map<string, string[]> = await loadQueryFile(\n    config.argumentsPrefixes,\n    config.expectations\n  );\n\n  // Load fullyExpandSubtrees queries (if any)\n  const fullyExpand: Map<string, string[]> = await loadQueryFile(\n    config.argumentsPrefixes,\n    config.fullyExpandSubtrees\n  );\n\n  const loader = new DefaultTestFileLoader();\n  const lines = [];\n  const tooLongQueries = [];\n  for (const prefix of config.argumentsPrefixes) {\n    const rootQuery = new TestQueryMultiFile(config.suite, []);\n    const tree = await loader.loadTree(rootQuery, {\n      subqueriesToExpand: expectations.get(prefix),\n      fullyExpandSubtrees: fullyExpand.get(prefix),\n      maxChunkTime: config.maxChunkTimeMS,\n    });\n\n    lines.push(undefined); // output blank line between prefixes\n    const prefixComment = { comment: `Prefix: \"${prefix}\"` }; // contents will be updated later\n    if (useChunking) lines.push(prefixComment);\n\n    const filesSeen = new Set<string>();\n    const testsSeen = new Set<string>();\n    let variantCount = 0;\n\n    const alwaysExpandThroughLevel = 2; // expand to, at minimum, every test.\n    for (const { query, subtreeCounts } of tree.iterateCollapsedNodes({\n      alwaysExpandThroughLevel,\n    })) {\n      assert(query instanceof TestQueryMultiCase);\n      if (!config.noLongPathAssert) {\n        const queryString = query.toString();\n        // Check for a safe-ish path length limit. Filename must be <= 255, and on Windows the whole\n        // path must be <= 259. Leave room for e.g.:\n        // 'c:\\b\\s\\w\\xxxxxxxx\\layout-test-results\\external\\wpt\\webgpu\\cts_worker=0_q=...-actual.txt'\n        if (queryString.length > kMaxQueryLength) {\n          tooLongQueries.push(queryString);\n        }\n      }\n\n      lines.push({\n        urlQueryString: prefix + query.toString(), // \"?debug=0&q=...\"\n        comment: useChunking ? `estimated: ${subtreeCounts?.totalTimeMS.toFixed(3)} ms` : undefined,\n      });\n\n      variantCount++;\n      filesSeen.add(new TestQueryMultiTest(query.suite, query.filePathParts, []).toString());\n      testsSeen.add(\n        new TestQueryMultiCase(query.suite, query.filePathParts, query.testPathParts, {}).toString()\n      );\n    }\n    prefixComment.comment += `; ${variantCount} variants generated from ${testsSeen.size} tests in ${filesSeen.size} files`;\n  }\n\n  if (tooLongQueries.length > 0) {\n    // Try to show some representation of failures. We show one entry from each\n    // test that is different length. Without this the logger cuts off the error\n    // messages and you end up not being told about which tests have issues.\n    const queryStrings = new Map<string, string>();\n    tooLongQueries.forEach(s => {\n      const colonNdx = s.lastIndexOf(':');\n      const prefix = s.substring(0, colonNdx + 1);\n      const id = `${prefix}:${s.length}`;\n      queryStrings.set(id, s);\n    });\n    throw new Error(\n      `Generated test variant would produce too-long -actual.txt filename. Possible solutions:\n  - Reduce the length of the parts of the test query\n  - Reduce the parameterization of the test\n  - Make the test function faster and regenerate the listing_meta entry\n  - Reduce the specificity of test expectations (if you're using them)\n|<${''.padEnd(kMaxQueryLength - 4, '-')}>|\n${[...queryStrings.values()].join('\\n')}`\n    );\n  }\n\n  await generateFile(lines);\n})().catch(ex => {\n  console.log(ex.stack ?? ex.toString());\n  process.exit(1);\n});\n\nasync function loadQueryFile(\n  argumentsPrefixes: string[],\n  queryFile?: {\n    file: string;\n    prefix: string;\n  }\n): Promise<Map<string, string[]>> {\n  let lines = new Set<string>();\n  if (queryFile) {\n    lines = new Set(\n      (await fs.readFile(queryFile.file, 'utf8')).split(/\\r?\\n/).filter(l => l.length)\n    );\n  }\n\n  const result: Map<string, string[]> = new Map();\n  for (const prefix of argumentsPrefixes) {\n    result.set(prefix, []);\n  }\n\n  expLoop: for (const exp of lines) {\n    // Take each expectation for the longest prefix it matches.\n    for (const argsPrefix of argumentsPrefixes) {\n      const prefix = queryFile!.prefix + argsPrefix;\n      if (exp.startsWith(prefix)) {\n        result.get(argsPrefix)!.push(exp.substring(prefix.length));\n        continue expLoop;\n      }\n    }\n    console.log('note: ignored expectation: ' + exp);\n  }\n  return result;\n}\n\nasync function generateFile(\n  lines: Array<{ urlQueryString?: string; comment?: string } | undefined>\n): Promise<void> {\n  let result = '';\n  result += '<!-- AUTO-GENERATED - DO NOT EDIT. See WebGPU CTS: tools/gen_wpt_cts_html. -->\\n';\n\n  result += await fs.readFile(config.template, 'utf8');\n\n  const variantList = [];\n  for (const line of lines) {\n    if (line !== undefined) {\n      if (line.urlQueryString) {\n        result += `<meta name=variant content='${line.urlQueryString}'>`;\n        variantList.push(line.urlQueryString);\n      }\n      if (line.comment) result += `<!-- ${line.comment} -->`;\n    }\n    result += '\\n';\n  }\n\n  await fs.writeFile(config.out, result);\n  if (config.outVariantList) {\n    await fs.writeFile(config.outVariantList, JSON.stringify(variantList, undefined, 2));\n  }\n}\n"],"mappings":"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"}