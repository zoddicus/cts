{"version":3,"file":"test_worker-worker.js","names":["setBaseResourcePath","DefaultTestFileLoader","Logger","parseQuery","setDefaultRequestAdapterOptions","assert","loader","self","onmessage","ev","query","data","expectations","defaultRequestAdapterOptions","debug","globalDebugMode","log","testcases","Array","from","loadCases","length","testcase","rec","result","record","toString","run","postMessage"],"sources":["../../../../src/common/runtime/helper/test_worker-worker.ts"],"sourcesContent":["import { setBaseResourcePath } from '../../framework/resources.js';\nimport { DefaultTestFileLoader } from '../../internal/file_loader.js';\nimport { Logger } from '../../internal/logging/logger.js';\nimport { parseQuery } from '../../internal/query/parseQuery.js';\nimport { TestQueryWithExpectation } from '../../internal/query/query.js';\nimport { setDefaultRequestAdapterOptions } from '../../util/navigator_gpu.js';\nimport { assert } from '../../util/util.js';\n\n// Should be DedicatedWorkerGlobalScope, but importing lib \"webworker\" conflicts with lib \"dom\".\n/* eslint-disable-next-line @typescript-eslint/no-explicit-any */\ndeclare const self: any;\n\nconst loader = new DefaultTestFileLoader();\n\nsetBaseResourcePath('../../../resources');\n\nself.onmessage = async (ev: MessageEvent) => {\n  const query: string = ev.data.query;\n  const expectations: TestQueryWithExpectation[] = ev.data.expectations;\n  const defaultRequestAdapterOptions: GPURequestAdapterOptions =\n    ev.data.defaultRequestAdapterOptions;\n  const debug: boolean = ev.data.debug;\n\n  setDefaultRequestAdapterOptions(defaultRequestAdapterOptions);\n\n  Logger.globalDebugMode = debug;\n  const log = new Logger();\n\n  const testcases = Array.from(await loader.loadCases(parseQuery(query)));\n  assert(testcases.length === 1, 'worker query resulted in != 1 cases');\n\n  const testcase = testcases[0];\n  const [rec, result] = log.record(testcase.query.toString());\n  await testcase.run(rec, expectations);\n\n  self.postMessage({ query, result });\n};\n"],"mappings":";AAAA;AAAA,GAAA,SAASA,mBAAmB,QAAQ,8BAA8B,CAClE,SAASC,qBAAqB,QAAQ,+BAA+B,CACrE,SAASC,MAAM,QAAQ,kCAAkC;AACzD,SAASC,UAAU,QAAQ,oCAAoC;;AAE/D,SAASC,+BAA+B,QAAQ,6BAA6B;AAC7E,SAASC,MAAM,QAAQ,oBAAoB;;AAE3C;;;;AAIA,MAAMC,MAAM,GAAG,IAAIL,qBAAqB,EAAE;;AAE1CD,mBAAmB,CAAC,oBAAoB,CAAC;;AAEzCO,IAAI,CAACC,SAAS,GAAG,OAAOC,EAAgB,KAAK;EAC3C,MAAMC,KAAa,GAAGD,EAAE,CAACE,IAAI,CAACD,KAAK;EACnC,MAAME,YAAwC,GAAGH,EAAE,CAACE,IAAI,CAACC,YAAY;EACrE,MAAMC,4BAAsD;EAC1DJ,EAAE,CAACE,IAAI,CAACE,4BAA4B;EACtC,MAAMC,KAAc,GAAGL,EAAE,CAACE,IAAI,CAACG,KAAK;;EAEpCV,+BAA+B,CAACS,4BAA4B,CAAC;;EAE7DX,MAAM,CAACa,eAAe,GAAGD,KAAK;EAC9B,MAAME,GAAG,GAAG,IAAId,MAAM,EAAE;;EAExB,MAAMe,SAAS,GAAGC,KAAK,CAACC,IAAI,CAAC,MAAMb,MAAM,CAACc,SAAS,CAACjB,UAAU,CAACO,KAAK,CAAC,CAAC,CAAC;EACvEL,MAAM,CAACY,SAAS,CAACI,MAAM,KAAK,CAAC,EAAE,qCAAqC,CAAC;;EAErE,MAAMC,QAAQ,GAAGL,SAAS,CAAC,CAAC,CAAC;EAC7B,MAAM,CAACM,GAAG,EAAEC,MAAM,CAAC,GAAGR,GAAG,CAACS,MAAM,CAACH,QAAQ,CAACZ,KAAK,CAACgB,QAAQ,EAAE,CAAC;EAC3D,MAAMJ,QAAQ,CAACK,GAAG,CAACJ,GAAG,EAAEX,YAAY,CAAC;;EAErCL,IAAI,CAACqB,WAAW,CAAC,EAAElB,KAAK,EAAEc,MAAM,CAAC,CAAC,CAAC;AACrC,CAAC"}