{"version":3,"file":"copyTextureToBuffer.spec.js","names":["description","makeTestGroup","ValidationTest","kCompressedTextureFormats","kTextureFormatInfo","align","g","test","desc","params","u","combine","beforeAllSubcases","t","format","selectDeviceOrSkipTestCase","feature","fn","blockWidth","blockHeight","bytesPerBlock","texture","device","createTexture","size","usage","GPUTextureUsage","COPY_SRC","trackForCleanup","bytesPerRow","buffer","createBuffer","GPUBufferUsage","COPY_DST","encoder","createCommandEncoder","copyTextureToBuffer","expectGPUError","finish"],"sources":["../../../../../../src/compat/api/validation/encoding/cmds/copyTextureToBuffer.spec.ts"],"sourcesContent":["export const description = `\nTests limitations of copyTextureToBuffer in compat mode.\n`;\n\nimport { makeTestGroup } from '../../../../../common/internal/test_group.js';\nimport { ValidationTest } from '../../../../../webgpu/api/validation/validation_test.js';\nimport {\n  kCompressedTextureFormats,\n  kTextureFormatInfo,\n} from '../../../../../webgpu/format_info.js';\nimport { align } from '../../../../../webgpu/util/math.js';\n\nexport const g = makeTestGroup(ValidationTest);\n\ng.test('compressed')\n  .desc(`Tests that you can not call copyTextureToBuffer with compressed textures in compat mode.`)\n  .params(u => u.combine('format', kCompressedTextureFormats))\n  .beforeAllSubcases(t => {\n    const { format } = t.params;\n    t.selectDeviceOrSkipTestCase([kTextureFormatInfo[format].feature]);\n  })\n  .fn(t => {\n    const { format } = t.params;\n\n    const { blockWidth, blockHeight, bytesPerBlock } = kTextureFormatInfo[format];\n\n    const texture = t.device.createTexture({\n      size: [blockWidth, blockHeight, 1],\n      format,\n      usage: GPUTextureUsage.COPY_SRC,\n    });\n    t.trackForCleanup(texture);\n\n    const bytesPerRow = align(bytesPerBlock, 256);\n\n    const buffer = t.device.createBuffer({\n      size: bytesPerRow,\n      usage: GPUBufferUsage.COPY_DST,\n    });\n    t.trackForCleanup(buffer);\n\n    const encoder = t.device.createCommandEncoder();\n    encoder.copyTextureToBuffer({ texture }, { buffer, bytesPerRow }, [blockWidth, blockHeight, 1]);\n    t.expectGPUError('validation', () => {\n      encoder.finish();\n    });\n  });\n"],"mappings":";AAAA;AAAA,GAAA,OAAO,MAAMA,WAAW,GAAI;AAC5B;AACA,CAAC,CAED,SAASC,aAAa,QAAQ,8CAA8C;AAC5E,SAASC,cAAc,QAAQ,yDAAyD;AACxF;AACEC,yBAAyB;AACzBC,kBAAkB;AACb,sCAAsC;AAC7C,SAASC,KAAK,QAAQ,oCAAoC;;AAE1D,OAAO,MAAMC,CAAC,GAAGL,aAAa,CAACC,cAAc,CAAC;;AAE9CI,CAAC,CAACC,IAAI,CAAC,YAAY,CAAC;AACjBC,IAAI,CAAE,0FAAyF,CAAC;AAChGC,MAAM,CAAC,CAAAC,CAAC,KAAIA,CAAC,CAACC,OAAO,CAAC,QAAQ,EAAER,yBAAyB,CAAC,CAAC;AAC3DS,iBAAiB,CAAC,CAAAC,CAAC,KAAI;EACtB,MAAM,EAAEC,MAAM,CAAC,CAAC,GAAGD,CAAC,CAACJ,MAAM;EAC3BI,CAAC,CAACE,0BAA0B,CAAC,CAACX,kBAAkB,CAACU,MAAM,CAAC,CAACE,OAAO,CAAC,CAAC;AACpE,CAAC,CAAC;AACDC,EAAE,CAAC,CAAAJ,CAAC,KAAI;EACP,MAAM,EAAEC,MAAM,CAAC,CAAC,GAAGD,CAAC,CAACJ,MAAM;;EAE3B,MAAM,EAAES,UAAU,EAAEC,WAAW,EAAEC,aAAa,CAAC,CAAC,GAAGhB,kBAAkB,CAACU,MAAM,CAAC;;EAE7E,MAAMO,OAAO,GAAGR,CAAC,CAACS,MAAM,CAACC,aAAa,CAAC;IACrCC,IAAI,EAAE,CAACN,UAAU,EAAEC,WAAW,EAAE,CAAC,CAAC;IAClCL,MAAM;IACNW,KAAK,EAAEC,eAAe,CAACC;EACzB,CAAC,CAAC;EACFd,CAAC,CAACe,eAAe,CAACP,OAAO,CAAC;;EAE1B,MAAMQ,WAAW,GAAGxB,KAAK,CAACe,aAAa,EAAE,GAAG,CAAC;;EAE7C,MAAMU,MAAM,GAAGjB,CAAC,CAACS,MAAM,CAACS,YAAY,CAAC;IACnCP,IAAI,EAAEK,WAAW;IACjBJ,KAAK,EAAEO,cAAc,CAACC;EACxB,CAAC,CAAC;EACFpB,CAAC,CAACe,eAAe,CAACE,MAAM,CAAC;;EAEzB,MAAMI,OAAO,GAAGrB,CAAC,CAACS,MAAM,CAACa,oBAAoB,EAAE;EAC/CD,OAAO,CAACE,mBAAmB,CAAC,EAAEf,OAAO,CAAC,CAAC,EAAE,EAAES,MAAM,EAAED,WAAW,CAAC,CAAC,EAAE,CAACX,UAAU,EAAEC,WAAW,EAAE,CAAC,CAAC,CAAC;EAC/FN,CAAC,CAACwB,cAAc,CAAC,YAAY,EAAE,MAAM;IACnCH,OAAO,CAACI,MAAM,EAAE;EAClB,CAAC,CAAC;AACJ,CAAC,CAAC"}