{"version":3,"file":"logger.spec.js","names":["description","SkipTestCase","makeTestGroup","Logger","assert","UnitTest","g","test","fn","t","mylog","overrideDebugMode","res1","record","res2","expect","results","get","logs","undefined","status","timems","rec","res","start","finish","debug","Error","skipped","warn","expectationFailed","validationFailed","threw","paramsSimple","_logsCount","params","length"],"sources":["../../src/unittests/logger.spec.ts"],"sourcesContent":["export const description = `\nUnit tests for namespaced logging system.\n\nAlso serves as a larger test of async test functions, and of the logging system.\n`;\n\nimport { SkipTestCase } from '../common/framework/fixture.js';\nimport { makeTestGroup } from '../common/framework/test_group.js';\nimport { Logger } from '../common/internal/logging/logger.js';\nimport { assert } from '../common/util/util.js';\n\nimport { UnitTest } from './unit_test.js';\n\nexport const g = makeTestGroup(UnitTest);\n\ng.test('construct').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [, res1] = mylog.record('one');\n  const [, res2] = mylog.record('two');\n\n  t.expect(mylog.results.get('one') === res1);\n  t.expect(mylog.results.get('two') === res2);\n  t.expect(res1.logs === undefined);\n  t.expect(res1.status === 'running');\n  t.expect(res1.timems < 0);\n  t.expect(res2.logs === undefined);\n  t.expect(res2.status === 'running');\n  t.expect(res2.timems < 0);\n});\n\ng.test('empty').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  t.expect(res.status === 'running');\n  rec.finish();\n\n  t.expect(res.status === 'pass');\n  t.expect(res.timems >= 0);\n});\n\ng.test('pass').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.debug(new Error('hello'));\n  t.expect(res.status === 'running');\n  rec.finish();\n\n  t.expect(res.status === 'pass');\n  t.expect(res.timems >= 0);\n});\n\ng.test('skip').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.skipped(new SkipTestCase());\n  rec.debug(new Error('hello'));\n  rec.finish();\n\n  t.expect(res.status === 'skip');\n  t.expect(res.timems >= 0);\n});\n\ng.test('warn').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.warn(new Error('hello'));\n  rec.skipped(new SkipTestCase());\n  rec.finish();\n\n  t.expect(res.status === 'warn');\n  t.expect(res.timems >= 0);\n});\n\ng.test('fail,expectationFailed').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.expectationFailed(new Error('bye'));\n  rec.warn(new Error());\n  rec.skipped(new SkipTestCase());\n  rec.finish();\n\n  t.expect(res.status === 'fail');\n  t.expect(res.timems >= 0);\n});\n\ng.test('fail,validationFailed').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.validationFailed(new Error('bye'));\n  rec.warn(new Error());\n  rec.skipped(new SkipTestCase());\n  rec.finish();\n\n  t.expect(res.status === 'fail');\n  t.expect(res.timems >= 0);\n});\n\ng.test('fail,threw').fn(t => {\n  const mylog = new Logger({ overrideDebugMode: true });\n  const [rec, res] = mylog.record('one');\n\n  rec.start();\n  rec.threw(new Error('bye'));\n  rec.warn(new Error());\n  rec.skipped(new SkipTestCase());\n  rec.finish();\n\n  t.expect(res.status === 'fail');\n  t.expect(res.timems >= 0);\n});\n\ng.test('debug')\n  .paramsSimple([\n    { debug: true, _logsCount: 5 }, //\n    { debug: false, _logsCount: 3 },\n  ])\n  .fn(t => {\n    const { debug, _logsCount } = t.params;\n\n    const mylog = new Logger({ overrideDebugMode: debug });\n    const [rec, res] = mylog.record('one');\n\n    rec.start();\n    rec.debug(new Error('hello'));\n    rec.expectationFailed(new Error('bye'));\n    rec.warn(new Error());\n    rec.skipped(new SkipTestCase());\n    rec.debug(new Error('foo'));\n    rec.finish();\n\n    t.expect(res.status === 'fail');\n    t.expect(res.timems >= 0);\n    assert(res.logs !== undefined);\n    t.expect(res.logs.length === _logsCount);\n  });\n"],"mappings":"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"}