{"version":3,"file":"preprocessor.spec.js","names":["description","makeTestGroup","pp","UnitTest","F","test","act","exp","expect","replace","g","fn","t","_if","_endif","_else","_elif","__if","__endif","__elif","__else","e","shouldThrow"],"sources":["../../src/unittests/preprocessor.spec.ts"],"sourcesContent":["export const description = `\nTest for \"pp\" preprocessor.\n`;\n\nimport { makeTestGroup } from '../common/framework/test_group.js';\nimport { pp } from '../common/util/preprocessor.js';\n\nimport { UnitTest } from './unit_test.js';\n\nclass F extends UnitTest {\n  test(act: string, exp: string): void {\n    this.expect(act === exp, 'got: ' + act.replace('\\n', '⏎'));\n  }\n}\n\nexport const g = makeTestGroup(F);\n\ng.test('empty').fn(t => {\n  t.test(pp``, '');\n  t.test(pp`\\n`, '\\n');\n  t.test(pp`\\n\\n`, '\\n\\n');\n});\n\ng.test('plain').fn(t => {\n  t.test(pp`a`, 'a');\n  t.test(pp`\\na`, '\\na');\n  t.test(pp`\\n\\na`, '\\n\\na');\n  t.test(pp`\\na\\n`, '\\na\\n');\n  t.test(pp`a\\n\\n`, 'a\\n\\n');\n});\n\ng.test('substitutions,1').fn(t => {\n  const act = pp`a ${3} b`;\n  const exp = 'a 3 b';\n  t.test(act, exp);\n});\n\ng.test('substitutions,2').fn(t => {\n  const act = pp`a ${'x'}`;\n  const exp = 'a x';\n  t.test(act, exp);\n});\n\ng.test('substitutions,3').fn(t => {\n  const act = pp`a ${'x'} b`;\n  const exp = 'a x b';\n  t.test(act, exp);\n});\n\ng.test('substitutions,4').fn(t => {\n  const act = pp`\na\n${pp._if(false)}\n${'x'}\n${pp._endif}\nb`;\n  const exp = '\\na\\n\\nb';\n  t.test(act, exp);\n});\n\ng.test('if,true').fn(t => {\n  const act = pp`\na\n${pp._if(true)}c${pp._endif}\nd\n`;\n  const exp = '\\na\\nc\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('if,false').fn(t => {\n  const act = pp`\na\n${pp._if(false)}c${pp._endif}\nd\n`;\n  const exp = '\\na\\n\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('else,1').fn(t => {\n  const act = pp`\na\n${pp._if(true)}\nb\n${pp._else}\nc\n${pp._endif}\nd\n`;\n  const exp = '\\na\\n\\nb\\n\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('else,2').fn(t => {\n  const act = pp`\na\n${pp._if(false)}\nb\n${pp._else}\nc\n${pp._endif}\nd\n`;\n  const exp = '\\na\\n\\nc\\n\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('elif,1').fn(t => {\n  const act = pp`\na\n${pp._if(false)}\nb\n${pp._elif(true)}\ne\n${pp._else}\nc\n${pp._endif}\nd\n`;\n  const exp = '\\na\\n\\ne\\n\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('elif,2').fn(t => {\n  const act = pp`\na\n${pp._if(true)}\nb\n${pp._elif(true)}\ne\n${pp._else}\nc\n${pp._endif}\nd\n`;\n  const exp = '\\na\\n\\nb\\n\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('nested,1').fn(t => {\n  const act = pp`\na\n${pp._if(false)}\nb\n${pp.__if(true)}\ne\n${pp.__endif}\nc\n${pp._endif}\nd\n`;\n  const exp = '\\na\\n\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('nested,2').fn(t => {\n  const act = pp`\na\n${pp._if(false)}\nb\n${pp._else}\nh\n${pp.__if(false)}\ne\n${pp.__elif(true)}\nf\n${pp.__else}\ng\n${pp.__endif}\nc\n${pp._endif}\nd\n`;\n  const exp = '\\na\\n\\nh\\n\\nf\\n\\nc\\n\\nd\\n';\n  t.test(act, exp);\n});\n\ng.test('errors,pass').fn(() => {\n  pp`${pp._if(true)}${pp._endif}`;\n  pp`${pp._if(true)}${pp._else}${pp._endif}`;\n  pp`${pp._if(true)}${pp.__if(true)}${pp.__endif}${pp._endif}`;\n});\n\ng.test('errors,fail').fn(t => {\n  const e = (fn: () => void) => t.shouldThrow('Error', fn);\n  e(() => pp`${pp._if(true)}`);\n  e(() => pp`${pp._elif(true)}`);\n  e(() => pp`${pp._else}`);\n  e(() => pp`${pp._endif}`);\n  e(() => pp`${pp.__if(true)}`);\n  e(() => pp`${pp.__elif(true)}`);\n  e(() => pp`${pp.__else}`);\n  e(() => pp`${pp.__endif}`);\n\n  e(() => pp`${pp._if(true)}${pp._elif(true)}`);\n  e(() => pp`${pp._if(true)}${pp._elif(true)}${pp._else}`);\n  e(() => pp`${pp._if(true)}${pp._else}`);\n  e(() => pp`${pp._else}${pp._endif}`);\n\n  e(() => pp`${pp._if(true)}${pp.__endif}`);\n  e(() => pp`${pp.__if(true)}${pp.__endif}`);\n  e(() => pp`${pp.__if(true)}${pp._endif}`);\n\n  e(() => pp`${pp._if(true)}${pp._else}${pp._else}${pp._endif}`);\n  e(() => pp`${pp._if(true)}${pp.__if(true)}${pp.__else}${pp.__else}${pp.__endif}${pp._endif}`);\n});\n"],"mappings":"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"}